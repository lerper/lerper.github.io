!function(){"use strict";var t,e,s;!function(t){t[t.Line=1]="Line",t[t.DownCurve=2]="DownCurve",t[t.UpCurve=3]="UpCurve"}(t||(t={})),function(t){t[t.Return=1]="Return",t[t.Repeat=2]="Repeat",t[t.Remove=3]="Remove"}(e||(e={})),function(t){t[t.Top=1]="Top",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Bottom=4]="Bottom"}(s||(s={}));class i{static setEnemys1(t,e){const s=this["enemys"+e];for(let e=1;e<t.length;e++){const i=t[e];let l=s[i[2]];l||(s[i[2]]=[],l=s[i[2]]),l.push({id:i[0],chapter:i[1],level:i[2],difficulty:i[3],type:i[4],direntry:i[5],entry:i[6],direxit:i[7],exit:i[8],distance:i[9],time:i[10],return:i[11],route:i[12],speed:i[13],att:i[14],hp:i[15],def:i[16],shooting:i[17],atttime:i[18],bulletsp:i[19],bulletstart:i[20],in:this.getPos(i[5],i[6]),out:this.getPos(i[7],i[8])})}}static getPos(t,e){if("number"!=typeof t||"number"!=typeof e)return null;const i=new Laya.Vector2;return t==s.Top?(i.x=e,i.y=0):t==s.Left?(i.x=0,i.y=e):t==s.Right?(i.x=720,i.y=e):t==s.Bottom&&(i.x=e,i.y=1280),i}}i.enemys1={},i.enemys2={},i.enemys3={},i.enemys4={},i.enemys5={};class l{static setExps(t){for(let e=1;e<t.length;e++){const s=t[e];1==s[1]?this.upLevExps[s[2]]=s[4]:2==s[1]&&(this.levelExps[s[3]]=s[4])}}}l.levelExps={},l.upLevExps={};const a=new class{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.speed=0,this.fspeed=0,this.eneHurtStr=0,this.bosHurtStr=0,this.hp=0,this.currHP=0,this.defense=0,this.subHurt=0,this.id=1,this.chapter=1,this.rate=1,this.exp=0,this.level=1,this.skills={},this.rewards={},this.track=!1,this.cross=!1,this.unlock=[]}setAttHp(t,e){this.attack=t,this.hp=e}setChapter(){let t=this.chapter;this.chapter<5&&this.chapter++,this.rate=1;const e=h.comChapters[t-1].unlockskill;for(let t=0;t<e.length;t++){const s=e[t];this.unlock.indexOf(s)<0&&this.unlock.push(s)}}};var n,o;!function(t){t[t.Common=1]="Common",t[t.Hard=2]="Hard",t[t.Hell=3]="Hell"}(n||(n={}));class h{static setChatpers(t){const e=t[1];this.basChapter={id:e[0],nameCN:e[1],name:e[2],chapter:e[3],level:e[4],maxair:e[5],fight:e[6],fightatt:e[7],fighthp:e[8],difficulty:e[9],drop:e[10],unlockskill:[]};for(let e=2;e<t.length;e+=2){const s=t[e];this.comChapters.push({id:s[0],nameCN:s[1],name:s[2],chapter:s[3],level:s[4],maxair:s[5],fight:s[6],fightatt:s[7],fighthp:s[8],difficulty:s[9],drop:s[10],unlockskill:[]})}a.unlock=h.basChapter.unlockskill}}h.basChapter=null,h.comChapters=[];class r{static setEnemys(t){const e=this.enemys;for(let s=1;s<t.length;s++){const i=t[s];e[i[0]]={id:i[0],nameCN:i[1],icon:i[2],shooting:i[3],bullettype:i[4],skill:i[5]}}}}r.enemys={},function(t){t[t.Once=1]="Once",t[t.Add=2]="Add",t[t.Always=3]="Always",t[t.Supply=4]="Supply"}(o||(o={}));class c{static setSkills(t){for(let e=1;e<t.length;e++){const s=t[e];this.skills[s[0]]={id:s[0],nameCN:s[1],name:s[2],describeCN:s[3],describe:s[4],skilltype:s[5],fightadd:s[6],value:s[7],bullettype:s[8],buff:s[9],bufftime:s[10],add:s[11],speed:"number"==typeof s[13]?s[13]:0,fspeed:"number"==typeof s[14]?s[14]:0,robotsp:"number"==typeof s[14]?s[15]:0,robotbullet:"number"==typeof s[14]?s[16]:0};const i=(s[12]+"").split("|"),l=i[0]?parseInt(i[0]):0,a=i[1]?parseInt(i[1]):0;l?h.comChapters[a-1].unlockskill.push(s[0]):s[11]!=o.Add&&1e3!=s[0]&&h.basChapter.unlockskill.push(s[0])}h.basChapter.unlockskill.push(1001,1005,1009,1016,1020)}}c.skills={};const p=new class{constructor(){this.level=1,this.planes=[1,2]}};class y{static setPlanes(t){for(let e=1;e<t.length;e++){const s=t[e];for(let t=1;t<5;t++){const e=this["plane"+t];e&&(e[s[1]]={id:t,att:s[3+2*t],hp:s[4+2*t],addAtt:s[3],addHp:s[4]})}}let e=a.id,s=p.level;const i=this.getAttHp(s,e);a.hp=i.hp,a.attack=i.att}static setGolds(t){for(let e=1;e<t.length;e++){const s=t[e];this.upPlaGold[s[1]]={gold:s[5],adgo:s[4]}}}static getAttHp(t,e){const s={att:0,hp:0},i=this["plane"+e];if(i){const e=i[t];if(e)s.att=e.att,s.hp=e.hp;else{const e=Object.keys(i).sort((t,e)=>{return parseInt(t)-parseInt(e)});for(let l=0;l<e.length;l++){const a=parseInt(e[l]),n=l+1>=e.length?9999:parseInt(e[l+1]);if(t>a&&t<n){let e=i[a];s.att=e.att+(t-a)*e.addAtt,s.hp=e.hp+(t-a)*e.addHp;break}}}}return s}static getGold(t){let e=0;const s=this.upPlaGold,i=s[t];if(i)e=i.gold;else{const i=Object.keys(s).sort((t,e)=>{return parseInt(t)-parseInt(e)});for(let l=0;l<i.length;l++){const a=parseInt(i[l]),n=l+1>=i.length?9999:parseInt(i[l+1]);if(t>a&&t<n){let i=s[a];e=i.gold+(t-a)*i.adgo;break}}}return e}}y.plane1={},y.plane2={},y.plane3={},y.plane4={},y.upPlaGold={};class d{static setPlanes(t){for(let e=1;e<t.length;e++){const s=t[e];this.planes[s[0]]={id:s[0],nameCN:s[1],name:s[2],att:s[3],hp:s[4],shooting:s[5],crit:s[6],range:s[7],unlocking:s[8],bullettype:s[9],weapon:s[10],sustain:s[11],bulletsp:s[12]}}const e=this.planes[a.id];a.crit=100*e.crit,a.critHurt=1.5,a.speed=e.shooting,a.fspeed=e.bulletsp}}d.planes={},d.planesUI={1:[2,3,4,5,6],2:[6,5,4,3,2],3:[5,5,5,5,5]};const u={lobby:{BattlePage:"prefab/lobby/BattlePage.json",HangarPage:"prefab/lobby/HangarPage.json",HangarPlaneItem:"prefab/lobby/HangarPlaneItem.json"},battle:{BgNode:"prefab/battle/bg/BgNode.json",Player:"prefab/battle/player/Player.json",PlayerHP:"prefab/battle/player/PlayerHP.json",Player1Bullet:"prefab/battle/skill/Player1Bullet.json",PlayerLaser:"prefab/battle/skill/PlayerLaser.json",PlayerShield:"prefab/battle/skill/PlayerShield.json",PlayerTimeShield:"prefab/battle/skill/PlayerTimeShield.json",PlayerDieShot:"prefab/battle/skill/PlayerDieShot.json",PlayerDieBoom:"prefab/battle/skill/PlayerDieBoom.json",PlayerSkill1:"prefab/battle/skill/PlayerSkill1.json",PlayerSkill2:"prefab/battle/skill/PlayerSkill2.json",PlayerSkill3:"prefab/battle/skill/PlayerSkill3.json",PlayerSkill4:"prefab/battle/skill/PlayerSkill4.json",PlayerSkill5:"prefab/battle/skill/PlayerSkill5.json",PlayerSkill6:"prefab/battle/skill/PlayerSkill6.json",PlayerSkill7:"prefab/battle/skill/PlayerSkill7.json",PlayerSkill8:"prefab/battle/skill/PlayerSkill8.json",PlayerSkill9:"prefab/battle/skill/PlayerSkill9.json",PlayerSkill10:"prefab/battle/skill/PlayerSkill10.json",PlayerWing1:"prefab/battle/wing/PlayerWing1.json",PlayerWing1b:"prefab/battle/wing/PlayerWing1b.json",PlayerWing2:"prefab/battle/wing/PlayerWing2.json",PlayerWing2b:"prefab/battle/wing/PlayerWing2b.json",PlayerWing3:"prefab/battle/wing/PlayerWing3.json",PlayerWing3b:"prefab/battle/wing/PlayerWing3b.json",PlayerWing4:"prefab/battle/wing/PlayerWing4.json",PlayerWing4b:"prefab/battle/wing/PlayerWing4b.json",PlayerWing5:"prefab/battle/wing/PlayerWing5.json",PlayerWing5b:"prefab/battle/wing/PlayerWing5b.json",PlayerWing6:"prefab/battle/wing/PlayerWing6.json",PlayerWing6b:"prefab/battle/wing/PlayerWing6b.json",PlayerRobot1:"prefab/battle/robot/PlayerRobot1.json",PlayerRobot1b:"prefab/battle/robot/PlayerRobot1b.json",PlayerRobot2:"prefab/battle/robot/PlayerRobot2.json",PlayerRobot3:"prefab/battle/robot/PlayerRobot3.json",Enemy1001:"prefab/battle/enemy/Enemy1001.json",Enemy1002:"prefab/battle/enemy/Enemy1002.json",Enemy1004:"prefab/battle/enemy/Enemy1004.json",Enemy1006:"prefab/battle/enemy/Enemy1006.json",Enemy1008:"prefab/battle/enemy/Enemy1008.json",Enemy1010:"prefab/battle/enemy/Enemy1010.json",Enemy1012:"prefab/battle/enemy/Enemy1012.json",Enemy1014:"prefab/battle/enemy/Enemy1014.json",Enemy1016:"prefab/battle/enemy/Enemy1016.json",Enemy1017:"prefab/battle/enemy/Enemy1017.json",Enemy1018:"prefab/battle/enemy/Enemy1018.json",Enemy1019:"prefab/battle/enemy/Enemy1019.json",Enemy1020:"prefab/battle/enemy/Enemy1020.json",Enemy1021:"prefab/battle/enemy/Enemy1021.json",Enemy1023:"prefab/battle/enemy/Enemy1023.json",Enemy1024:"prefab/battle/enemy/Enemy1024.json",Enemy1025:"prefab/battle/enemy/Enemy1025.json",Enemy1026:"prefab/battle/enemy/Enemy1026.json",Enemy2001:"prefab/battle/enemy/Enemy2001.json",Enemy3001:"prefab/battle/enemy/Enemy3001.json",Enemy3002:"prefab/battle/enemy/Enemy3002.json",EnemyHPTip:"prefab/battle/enemy/EnemyHPTip.json",EnemyLine:"prefab/battle/enemySkill/EnemyLine.json",EnemySkill1:"prefab/battle/enemySkill/EnemySkill1.json",EnemySkill3:"prefab/battle/enemySkill/EnemySkill3.json",EnemySkill5:"prefab/battle/enemySkill/EnemySkill5.json",EnemySkill9:"prefab/battle/enemySkill/EnemySkill9.json",EnemySkill10:"prefab/battle/enemySkill/EnemySkill10.json",EnemySkill11:"prefab/battle/enemySkill/EnemySkill11.json",EnemySkill13:"prefab/battle/enemySkill/EnemySkill13.json",EnemySkill2001:"prefab/battle/enemySkill/EnemySkill2001.json",EnemyBoom:"prefab/battle/effect/EnemyBoom.json",PlayerLaserHit:"prefab/battle/effect/PlayerLaserHit.json",PlayerBlast:"prefab/battle/effect/PlayerBlast.json",PlayerFireBuff:"prefab/battle/effect/PlayerFireBuff.json",PlayerPoisonBuff:"prefab/battle/effect/PlayerPoisonBuff.json"},battleUI:{ChooseSkillDialog:"prefab/battle/bg/ChooseSkillDialog.json",SupplySkillDialog:"prefab/battle/bg/SupplySkillDialog.json",GamePauseDialog:"prefab/battle/bg/GamePauseDialog.json",GameOverDialog:"prefab/battle/bg/GameOverDialog.json",PlayerSkillItem:"prefab/battle/bg/PlayerSkillItem.json"}},g={PlaneTrackModel:"unity/lizi/plane.lh",PlaneModel1:"unity/plane1/plane.lh",PlaneModel2:"unity/plane2/plane.lh",PlaneModel3:"unity/plane3/plane.lh",Coin:"unity/coin/plane.lh",Track:"unity/tuowei/plane.lh"},m={2001:"battle/enemy/plane/2001/boss01.sk",3001:"battle/enemy/plane/3001/foe3001.sk",3002:"battle/enemy/plane/3002/BuJi.sk",1002:"battle/enemy/plane/1002/foe1002.sk",1004:"battle/enemy/plane/1004/foe1004.sk",1006:"battle/enemy/plane/1006/foe1006.sk",1014:"battle/enemy/plane/1014/foe1014.sk"},b={1001:"prefab/battle/enemy/Enemy1001.json",1002:"prefab/battle/enemy/Enemy1002.json",1003:"prefab/battle/enemy/Enemy1002.json",1004:"prefab/battle/enemy/Enemy1004.json",1005:"prefab/battle/enemy/Enemy1004.json",1006:"prefab/battle/enemy/Enemy1006.json",1007:"prefab/battle/enemy/Enemy1006.json",1008:"prefab/battle/enemy/Enemy1008.json",1009:"prefab/battle/enemy/Enemy1008.json",1010:"prefab/battle/enemy/Enemy1010.json",1011:"prefab/battle/enemy/Enemy1010.json",1012:"prefab/battle/enemy/Enemy1012.json",1013:"prefab/battle/enemy/Enemy1012.json",1014:"prefab/battle/enemy/Enemy1014.json",1015:"prefab/battle/enemy/Enemy1014.json",1016:"prefab/battle/enemy/Enemy1016.json",1017:"prefab/battle/enemy/Enemy1017.json",1018:"prefab/battle/enemy/Enemy1018.json",1019:"prefab/battle/enemy/Enemy1019.json",1020:"prefab/battle/enemy/Enemy1020.json",1021:"prefab/battle/enemy/Enemy1021.json",1022:"prefab/battle/enemy/Enemy1021.json",1023:"prefab/battle/enemy/Enemy1023.json",1024:"prefab/battle/enemy/Enemy1024.json",1025:"prefab/battle/enemy/Enemy1025.json",1026:"prefab/battle/enemy/Enemy1026.json",2001:"prefab/battle/enemy/Enemy2001.json",3001:"prefab/battle/enemy/Enemy3001.json",3002:"prefab/battle/enemy/Enemy3002.json",3003:"prefab/battle/enemy/Enemy3002.json"},k={1:"unity/plane1/plane.lh",2:"unity/plane2/plane.lh",3:"unity/plane3/plane.lh"},f={BlackItalic:"font/DIN-BlackItalic.ttf"},S={Chapter:"json/battle/chapter.json",Skill:"json/battle/skill.json",Level1:"json/battle/level1.json",Level2:"json/battle/level2.json",Level3:"json/battle/level3.json",Level4:"json/battle/level4.json",Level5:"json/battle/level5.json",Enaircraft:"json/battle/enaircraft.json",Exp:"json/battle/exp.json",Upaircraft:"json/lobby/upaircraft.json",Upgold:"json/lobby/upgold.json",Aircraft:"json/lobby/aircraft.json"},C=new Laya.EventDispatcher;class x extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)})}loadRes(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}))})}getRes(t){return Laya.loader.getRes(t)}open(t,e){const s=Laya.Pool.getItemByCreateFun(t,e.create,e);return s.__sign__=t,s}recover(t){let e=t.__sign__;e&&Laya.Pool.recover(e,t);let s=window.__PoolSigns__;s&&s.indexOf&&s.indexOf(e)<0&&s.push(e)}openDialog(t,e,s,i){this.loadPrefab(t).then(l=>{const a=this.open(t,l);a.pos(360,640),i||a.scale(0,0),i||(a.alpha=0),e.addChild(a),s&&s(a),i||Laya.Tween.to(a,{scaleX:1,scaleY:1,alpha:1},200,Laya.Ease.quadInOut)})}setClick(t,e,s,i,l){t.on(Laya.Event.MOUSE_DOWN,s,()=>{l||Laya.Tween.to(t,{scaleX:.9,scaleY:.9},100)});const a=()=>{Laya.Tween.to(t,{scaleX:1,scaleY:1},100)};if(!l){const t=e;e=(()=>{a(),t.call(s,i)})}t.on(Laya.Event.MOUSE_OUT,s,a),t.on(Laya.Event.CLICK,s,e,i)}schedule(t,e,s,i,l,a,n){const o=e;let h=0;e=(()=>{if(h>=i)return Laya.timer.clear(s,e),void(n&&n.call(s));h++,o.call(s,l)}),a&&Laya.timer.clear(s,e),Laya.timer.loop(t,s,e,l)}getVec2(t=0,e=0){return new Laya.Vector2(t,e)}getVec3(t=0,e=0,s=0){return t instanceof Laya.Vector2&&(e=t.y,t=t.x),new Laya.Vector3(t,e,s)}getVec4(t=0,e=0,s=0,i=0){return new Laya.Vector4(t,e,s,i)}}var L,V,P;!function(t){t[t.READY=0]="READY",t[t.START=1]="START",t[t.PAUSE=2]="PAUSE",t[t.END=3]="END"}(L||(L={})),function(t){t.LASER="laser",t.POISON="poison",t.FIRE="fire",t.ICE="ice",t.MAGNET="magnet"}(V||(V={})),function(t){t.GameStateChange="gamestate_change",t.RateStart="battle_rate_start",t.RateEnd="battle_rate_end",t.GameOver="game_over",t.LevelEnemy="make_level_enemy",t.LevelEnemyEnd="make_level_enemy_end",t.PlayerBullet="player_main_bullet",t.PlayerHP="player_hp",t.PlayerMaxHP="player_max_hp",t.PlayerSpeed="player_speed",t.LaserHide="player_laser_hide",t.LaserCross="player_laser_cross",t.LaserTrack="player_laser_track",t.LaserTrackTar="player_laser_track_tar",t.BaseSkill1="player_1001_baseskill",t.BaseSkill1a="player_1002_baseskill",t.BaseSkill1b="player_1003_baseskill",t.BaseSkill2="player_1005_baseskill",t.BaseSkill2a="player_1006_baseskill",t.BaseSkill2b="player_1007_baseskill",t.BaseSkill3="player_1013_baseskill",t.BaseSkill4="player_1009_baseskill",t.BaseSkill4a="player_1010_baseskill",t.BaseSkill4b="player_1011_baseskill",t.BaseSkill5="player_1016_baseskill",t.BaseSkill5a="player_1017_baseskill",t.BaseSkill5b="player_1018_baseskill",t.BaseSkill6="player_1020_baseskill",t.BaseSkill6a="player_1021_baseskill",t.BaseSkill6b="player_1022_baseskill",t.BaseSkill7="player_1024_baseskill",t.BaseSkill9="player_1023_baseskill",t.Shield="player_1025_baseskill",t.TimeShield="player_1027_baseskill",t.DieShot="player_1028_baseskill",t.BaseSkill11="player_1029_baseskill",t.BaseSkill13="player_1030_baseskill",t.BaseSkill14="player_1031_baseskill",t.BaseSkill15="player_1032_baseskill",t.SuckBlood="player_1033_baseskill",t.DieBoom="player_1034_baseskill",t.BulSkill1="player_2004_bulskill",t.BulSkill1_Start="player_2004_bulskill_start",t.BulSkill2="player_2005_bulskill",t.BulSkill3="player_2003_bulskill",t.BulSkill4="player_2001_bulskill",t.BulSkill5="player_2006_bulskill",t.BulSkill6="player_2007_bulskill",t.BulSkill7="player_2010_bulskill",t.BulSkill7_Start="player_2010_bulskill_start",t.BulSkill8="player_2009_bulskill",t.BulSkill9="player_2011_bulskill",t.BulSkill10="player_2008_bulskill",t.WingSkill1="player_3005_wingskill",t.WingSkill2="player_3002_wingskill",t.WingSkill3="player_3003_wingskill",t.WingSkill4="player_3004_wingskill",t.WingSkill5="player_3001_wingskill",t.WingSkill6="player_3006_wingskill",t.RobSkill1="player_4001_robskill",t.RobSkill2="player_4003_robskill",t.RobSkill3="player_4002_robskill",t.Sup_HP="player_1004_supply",t.Sup_Att="player_1008_supply",t.Sup_Speed="player_1012_supply",t.Sup_HPRec1="player_1014_supply",t.Sup_HPRec2="player_1015_supply",t.Sup_Crit="player_1019_supply",t.EnemyDead="enemy_dead",t.EnemyPause="enemy_pause",t.EnemyHit="enemy_hit"}(P||(P={}));const w=[];var T;window.__PoolSigns__=w,function(t){t[t.HP1=1001]="HP1",t[t.Attack1=1005]="Attack1",t[t.HPRec1=1013]="HPRec1",t[t.Speed=1009]="Speed",t[t.Crit=1016]="Crit",t[t.MainStr=1020]="MainStr",t[t.MainCross=1024]="MainCross",t[t.MainTrack=1023]="MainTrack",t[t.Shield=1025]="Shield",t[t.TimeShield=1027]="TimeShield",t[t.DieShot=1028]="DieShot",t[t.Back=1029]="Back",t[t.Anger=1030]="Anger",t[t.Cri=1031]="Cri",t[t.Fearless=1032]="Fearless",t[t.SuckBlood=1033]="SuckBlood",t[t.DieBoom=1034]="DieBoom",t[t.Shotgun=2001]="Shotgun",t[t.Laser=2003]="Laser",t[t.SwimShell=2004]="SwimShell",t[t.ShockWave=2005]="ShockWave",t[t.RainbowMissile=2006]="RainbowMissile",t[t.RotatePoison=2007]="RotatePoison",t[t.RotateIce=2008]="RotateIce",t[t.RotateFire=2009]="RotateFire",t[t.NaughtyGhost=2010]="NaughtyGhost",t[t.Magnet=2011]="Magnet",t[t.ShotWing=3001]="ShotWing",t[t.MissileWing=3002]="MissileWing",t[t.LaserWing=3003]="LaserWing",t[t.AutoWing=3004]="AutoWing",t[t.BlastWing=3005]="BlastWing",t[t.ShieldWing=3006]="ShieldWing",t[t.BlastRobot=4001]="BlastRobot",t[t.LaserRobot=4002]="LaserRobot",t[t.ShieldRobot=4003]="ShieldRobot",t[t.Sup_HP=1004]="Sup_HP",t[t.Sup_Att=1008]="Sup_Att",t[t.Sup_Speed=1012]="Sup_Speed",t[t.Sup_HPRec1=1014]="Sup_HPRec1",t[t.Sup_HPRec2=1015]="Sup_HPRec2",t[t.Sup_Crit=1019]="Sup_Crit"}(T||(T={}));const E={1:[[0],[-30,-10,10,30],[-60,-40,-20,0,20,40,60],[-90,-70,-50,-30,-10,10,30,50,70,90]],2:[[0],[-30,30],[-5,0,5],[-20,-10,10,20]]},v=[[{dx:-80,dy:40,v:-1},{dx:80,dy:40,v:1}],[{dx:-160,dy:40,v:-1},{dx:160,dy:40,v:1}],[{dx:-240,dy:40,v:-1},{dx:240,dy:40,v:1}]],D={2001:{self:{x:50,y:75},b1:[{x:-221,y:261},{x:221,y:261}],b2:[{x:-130,y:240},{x:130,y:240}],b3:[{x:-83,y:195},{x:83,y:195}]},3001:{self:{x:33,y:45.5}},3002:{self:{x:312,y:908}},1002:{self:{x:43.5,y:64}},1004:{self:{x:65,y:82}},1006:{self:{x:51.5,y:80}},1014:{self:{x:43.5,y:83}}};class B extends x{constructor(){super(),this.width2=50,this.height2=50,this.deltaY=0,this.aabb=null,this.bid=null,this.bids=[],B.__bid__++,this.bid=B.__bid__}onEnable(){this.aabb={x:0,y:0,width:this.width2,height:this.height2}}onDisable(){this.bids.length=0}onLateUpdate(){const t=this.owner;t&&(this.aabb.x=t.x-this.width2/2,this.aabb.y=t.y-this.height2/2+this.deltaY)}}B.__bid__=0;class R extends x{constructor(){super(),this.delta=250}onEnable(){let t={1001:2,1002:2,1003:2,1004:3,1005:3,1006:2,1007:2,1008:2,1009:2,1010:1.5,1011:1.5,1012:2,1013:2,1014:2,1015:2,1016:1.5,2001:6,3001:1.5,3002:1.5,hit:.8}[this.owner.__$type$__]||2;const e=this.owner.getChildByName("boom");e.scale(t,t),e.blendMode=Laya.BlendMode.LIGHTER,Laya.timer.once(this.delta,this,()=>{this.owner.removeSelf()})}onDisable(){Laya.timer.clearAll(this),this.recover(this.owner)}}class _ extends x{constructor(){super(),this.ins=K.instance,this.move=!0}onEnable(){this.move=!0}onDisable(){}moveCoin(){const t=this.owner,e=this.ins.playerPosV3;Laya.Tween.to(t.transform,{localPositionX:e.x,localPositionY:e.y,localPositionZ:e.z,localScaleX:3,localScaleY:3,localScaleZ:3},300,null,Laya.Handler.create(this,()=>{t.removeSelf()}))}onUpdate(){const t=this.ins;if(t.gameState!=L.START)return;const e=this.owner;e.transform.rotate(this.getVec3(0,.1,0)),this.move&&(e.transform.translate(this.getVec3(0,-.04,0)),Math.abs(e.transform.position.z-t.playerPosV3.z)<=2&&(this.move=!1,this.moveCoin()))}}class A extends x{constructor(){super(),this.xp=null,this.yp=null}onEnable(){this.owner.blendMode=Laya.BlendMode.LIGHTER}onDisable(){this.xp=null,this.yp=null,this.recover(this.owner)}onLateUpdate(){if(this.xp&&this.yp){const t=this.owner;t.x=this.xp.x,t.y=this.yp.y}}}class H{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.eneHurtStr=0,this.bosHurtStr=0}}class M extends x{constructor(){super(),this.data=new H}onEnable(){}onDisable(){}setData(t,e,s,i,l){this.data.attack=t,this.data.crit=e,this.data.critHurt=s,this.data.eneHurtStr=i,this.data.bosHurtStr=l}}class N{constructor(t){this._tree=new Quadtree(t)}check(t,e){let s=[];if(this._tree){this._tree.clear();for(let e=0,s=t.length;e<s;e++){const s=t[e],i=s.aabb,l={x:i.x,y:i.y,height:i.height,width:i.width,collider:s};this._tree.insert(l)}if(this._tree.retrieve(e.aabb).forEach(t=>{(function(t,e){const s=t.owner,i=e.owner,l=s.y+t.deltaY,a=i.y+e.deltaY;return Math.abs(s.x-i.x)<=(t.width2+e.width2)/2&&Math.abs(l-a)<=(t.height2+e.height2)/2})(t.collider,e)&&s.push(t.collider)}),this._collisions)for(let t=0;t<this._collisions.length;t++){const i=this._collisions[t];if(s.indexOf(i)<0){let t=i.bids.indexOf(e.bid);if(t>-1&&(i.bids.splice(t,1),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionExit){l.onCollisionExit(e,i);break}}}let s=e.bids.indexOf(i.bid);if(s>-1&&(e.bids.splice(s,1),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionExit){l.onCollisionExit(i,e);break}}}}}for(let t=0;t<s.length;t++){const i=s[t];if(i.bids.indexOf(e.bid)<0&&(i.bids.push(e.bid),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionEnter){l.onCollisionEnter(e,i);break}}}if(e.bids.indexOf(i.bid)<0&&(e.bids.push(i.bid),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionEnter){l.onCollisionEnter(i,e);break}}}}this._collisions=s}}}function Quadtree(t,e,s,i){this.max_objects=e||10,this.max_levels=s||4,this.level=i||0,this.bounds=t,this.objects=[],this.nodes=[]}Quadtree.prototype.split=function(){var t=this.level+1,e=this.bounds.width/2,s=this.bounds.height/2,i=this.bounds.x,l=this.bounds.y;this.nodes[0]=new Quadtree({x:i+e,y:l,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[1]=new Quadtree({x:i,y:l,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[2]=new Quadtree({x:i,y:l+s,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[3]=new Quadtree({x:i+e,y:l+s,width:e,height:s},this.max_objects,this.max_levels,t)},Quadtree.prototype.getIndex=function(t){var e=[],s=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,l=t.y<i,a=t.x<s,n=t.x+t.width>s,o=t.y+t.height>i;return l&&n&&e.push(0),a&&l&&e.push(1),a&&o&&e.push(2),n&&o&&e.push(3),e},Quadtree.prototype.insert=function(t){var e,s=0;if(this.nodes.length)for(e=this.getIndex(t),s=0;s<e.length;s++)this.nodes[e[s]].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){for(this.nodes.length||this.split(),s=0;s<this.objects.length;s++){e=this.getIndex(this.objects[s]);for(var i=0;i<e.length;i++)this.nodes[e[i]].insert(this.objects[s])}this.objects=[]}},Quadtree.prototype.retrieve=function(t){var e=this.getIndex(t),s=this.objects;if(this.nodes.length)for(var i=0;i<e.length;i++)s=s.concat(this.nodes[e[i]].retrieve(t));return s=s.filter(function(t,e){return s.indexOf(t)>=e})},Quadtree.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]};class j extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=L.READY,this.tar=null,this.speed=1.5,this.cross=!1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),C.on(P.BulSkill1_Start,this,()=>{this.state=L.START})}onDisable(){C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.cross||this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;if(this.tar&&!this.tar.parent&&(this.tar=null),this.tar&&this.tar.parent)if(t.y<=this.tar.y||this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.tar=null;else{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class I extends x{constructor(){super(),this.ins=K.instance,this.tar=null}onEnable(){}onDisable(){const t=this.owner;t.height=0,t.rotation=0,this.recover(this.owner)}onLateUpdate(){if(this.ins.gameState!=L.START)return;const t=this.owner,e=this.tar;t.pos(e.x,e.y);let s=this.ins.playerV2,i=e.x-s.x,l=e.y-s.y;t.height=Math.sqrt(i*i+l*l),t.rotation=Math.atan2(i,-l)/Math.PI*180}}class W extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=L.READY,this.speed=.5}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280}))}onDisable(){C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class U extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.circle=!0,this.state=L.READY,this.tar=null,this.angle=0,this.xv=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.state=L.START,this.circle=!0;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(g.Track),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s}onDisable(){this.s3d.removeSelf(),C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=.5*Laya.timer.delta,s=this.ins.ratio3D;if(this.tar&&this.circle){let s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x)-Math.atan2(-this.norV3.y,this.norV3.x);if(l<0&&(l+=2*Math.PI),l<=.2){this.circle=!1;let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3),this.tar=null}else{this.angle-=this.xv*e/2;let t=Math.tan(this.angle/180*Math.PI),s=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-t,0),s),(this.angle>90&&this.angle<270||this.angle<-90&&this.angle>-270)&&(s.x=-s.x,s.y=-s.y),this.norV3.x=s.x,this.norV3.y=s.y}}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class O extends x{constructor(){super(),this.ins=K.instance,this.enemyCom=null,this.skill1Pre=null,this.skill3Pre=null,this.skill5Pre=null,this.skillLinePre=null,this.skillRotatePre=null,this.skill10Pre=null,this.skill11Pre=null,this.skill13Pre=null,this.lines=[],this.skill1Pre=this.getRes(u.battle.EnemySkill1),this.skill3Pre=this.getRes(u.battle.EnemySkill3),this.skill5Pre=this.getRes(u.battle.EnemySkill5),this.skillLinePre=this.getRes(u.battle.EnemyLine),this.skillRotatePre=this.getRes(u.battle.EnemySkill9),this.skill10Pre=this.getRes(u.battle.EnemySkill10),this.skill11Pre=this.getRes(u.battle.EnemySkill11),this.skill13Pre=this.getRes(u.battle.EnemySkill13)}onEnable(){this.enemyCom=this.owner.getComponent(Y),this.enemyCom&&this.enemyCom.edata}initSkill(){const t=this.enemyCom.edata,e=r.enemys[t.type];if(e.skill){const s=e.skill,i=t.shooting,l=t.bulletstart;if("number"==typeof s)if(7==s&&(this.enemyCom.isRotate=!0),12==s)this.enemyCom.isRotSelf=!0,this.enemyCom.isPauseSelf=!0,C.on(P.EnemyPause,this,this.skill12);else{const e=()=>{if(this.ins.gameState==L.START)if(C.event(P.EnemyHit,[t.type,this.enemyCom.eid]),t.type>2e3);else{this["skill"+s]&&this["skill"+s]()}};Laya.timer.once(1e3*l,this,e),Laya.timer.loop(1e3*i,this,()=>{e()})}else if("string"==typeof s){const i=s.split("|"),a=e.shooting.split("|"),n=t.att.split("|");let o=0;const h=()=>{if(this.ins.gameState==L.START){if(C.event(P.EnemyHit,[t.type,this.enemyCom.eid,i[o]]),t.type>2e3);else{this["skill"+i[o]]&&this["skill"+i[o]](parseInt(n[o]))}++o>=i.length&&(o=0)}},r=()=>{Laya.timer.once(1e3*parseInt(a[o]),this,()=>{h(),r()})};r(),Laya.timer.once(1e3*l,this,h)}}}onDisable(){for(let t=0;t<this.lines.length;t++){this.lines[t].removeSelf()}this.lines.length=0,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}skill1(t){const e=this.owner,s=this.enemyCom.edata,i=[-10,10];for(let l=0;l<i.length;l++){const a=this.open(u.battle.EnemySkill1,this.skill1Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(t||s.att,0,0,0,0);const o=a.getComponent(W);o.norV3=this.getVec3(0,1),o.state=L.START,a.pos(e.x+i[l],e.y),this.ins.eneBulNode.addChild(a)}}skill2(t){this.ins;const e=this.enemyCom.edata,s=this.owner,i=[-20,20];let l=0;this.schedule(50,()=>{const a=this.open(u.battle.EnemySkill1,this.skill1Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(t||e.att,0,0,0,0);const o=a.getComponent(W);o.norV3=this.getVec3(0,1),o.state=L.START,a.pos(s.x+i[l],s.y),this.ins.eneBulNode.addChild(a),++l>1&&(l=0)},this,10)}skill3(t){const e=this.ins,s=this.enemyCom.edata,i=this.owner,l=[110,70,100,80];let a=0;this.schedule(200,()=>{const n=this.open(u.battle.EnemySkill3,this.skill3Pre);let o=n.getComponent(M);o||(o=n.addComponent(M)),o.setData(t||s.att,0,0,0,0);const h=n.getComponent(U);h.norV3=this.getVec3(0,-1),h.angle=l[a],h.xv=l[a]>90?-1:1,h.tar=this.getVec2(e.playerV2.x,e.playerV2.y),n.pos(i.x,i.y),this.ins.eneBulNode.addChild(n),a++},this,4)}skill4(t){this.ins;const e=this.enemyCom.edata,s=this.owner,i=[this.getVec3(-.34,.94),this.getVec3(-.17,.98),this.getVec3(.17,.98),this.getVec3(.34,.94)];let l=0;this.schedule(200,()=>{const a=this.open(u.battle.EnemySkill3,this.skill3Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(t||e.att,0,0,0,0);const o=a.getComponent(U);o.norV3=i[l].clone(),o.angle=0,o.xv=1,o.tar=null,a.pos(s.x,s.y),this.ins.eneBulNode.addChild(a),l++},this,4)}skill5(t){const e=this.owner,s=this.enemyCom.edata,i=[-40,-20,20,40];for(let l=0;l<i.length;l++){const a=this.open(u.battle.EnemySkill5,this.skill5Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(t||s.att,0,0,0,0);const o=a.getComponent(W);o.norV3=this.getVec3(0,1),o.state=L.READY,a.pos(e.x+i[l],e.y),this.ins.eneBulNode.addChild(a),Laya.Tween.to(a,{y:e.y+100},500,null,Laya.Handler.create(this,()=>{const t=this.ins.playerV2;Laya.timer.once(1e3,this,()=>{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(t.x+i[l],t.y),this.getVec3(a.x,a.y),e),Laya.Vector3.normalize(e,o.norV3),o.state=L.START})}))}}skill6(t){const e=this.owner,s=this.enemyCom.edata,i=[this.getVec3(-.17,.98),this.getVec3(0,1),this.getVec3(.17,.98)];this.schedule(100,()=>{for(let l=0;l<i.length;l++){const a=this.open(u.battle.EnemySkill1,this.skill1Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(t||s.att,0,0,0,0);const o=a.getComponent(W);o.norV3=i[l].clone(),o.state=L.START,a.pos(e.x,e.y+20),this.ins.eneBulNode.addChild(a)}},this,5)}skill7(t){const e=this.owner,s=this.enemyCom.edata,i=[[0,0],[-1,1],[1,1],[-2,2],[0,2],[2,2]],l=this.open(u.battle.EnemyLine,this.skillLinePre);l.getComponent(I).tar=e,l.pos(e.x,e.y),this.ins.bgTopNode.addChild(l),this.lines.push(l),Laya.timer.once(1e3,this,()=>{if(l.removeSelf(),this.lines.splice(this.lines.indexOf(l),1),this.ins.gameState==L.START)for(let l=0;l<i.length;l++){const a=this.open(u.battle.EnemySkill1,this.skill1Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(t||s.att,0,0,0,0);const o=a.getComponent(W);o.norV3=this.getVec3(0,1);let h=this.getVec3();const r=this.ins.playerV2;let c=10*i[l][0],p=20*i[l][1];a.pos(e.x+c,e.y+p),Laya.Vector3.subtract(this.getVec3(r.x+c,r.y+p),this.getVec3(a.x,a.y),h),Laya.Vector3.normalize(h,o.norV3),o.state=L.START,this.ins.eneBulNode.addChild(a)}})}skill8(t){const e=this.owner,s=this.enemyCom.edata,i=[[0,0],[-1,1],[1,1],[-2,2],[2,2],[-3,3],[3,3],[-2,4],[2,4],[-1,5],[1,5],[0,6]];for(let l=0;l<i.length;l++){const a=this.open(u.battle.EnemySkill1,this.skill1Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(t||s.att,0,0,0,0);const o=a.getComponent(W);o.norV3=this.getVec3(0,1);let h=20*i[l][0],r=20*i[l][1];a.pos(e.x+h,e.y+r),o.state=L.START,this.ins.eneBulNode.addChild(a)}}skill9(t){const e=this.owner,s=this.enemyCom.edata,i=[this.getVec3(0,-1),this.getVec3(.03,-1),this.getVec3(.07,-1),this.getVec3(.1,-.99),this.getVec3(.14,-.99),this.getVec3(.17,-.98),this.getVec3(.98,-.17),this.getVec3(.99,-.14),this.getVec3(.99,-.1),this.getVec3(.99,-.07),this.getVec3(1,-.03),this.getVec3(1,0),this.getVec3(.5,.87),this.getVec3(.47,.88),this.getVec3(.44,.9),this.getVec3(.41,.91),this.getVec3(.37,.93),this.getVec3(.34,.94),this.getVec3(-.5,.87),this.getVec3(-.53,.85),this.getVec3(-.56,.83),this.getVec3(-.59,.81),this.getVec3(-.62,.79),this.getVec3(-.64,.77),this.getVec3(-.98,-.17),this.getVec3(-.98,-.21),this.getVec3(-.97,-.24),this.getVec3(-.96,-.28),this.getVec3(-.95,-.31),this.getVec3(-.94,-.34)],l=this.open(u.battle.EnemySkill9,this.skillRotatePre);l.pos(e.x,e.y+30),this.ins.eneBulNode.addChild(l),Laya.Tween.to(l,{y:e.y+230},3e3),this.lines.push(l),Laya.timer.once(4e3,this,()=>{if(l.removeSelf(),this.lines.splice(this.lines.indexOf(l),1),this.ins.gameState==L.START)for(let e=0;e<i.length;e++){const a=this.open(u.battle.EnemySkill1,this.skill1Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(t||s.att,0,0,0,0);const o=a.getComponent(W);let h,r;if(o.norV3=i[e],e<=5){let t=25*i[0].x,s=25*i[0].y;h=t+=10*(e-0),r=s-=10*(e-0)}else if(e>5&&e<=11){let t=25*i[6].x,s=25*i[6].y;h=t+=10*(e-6),r=s+=5*(e-6)}else if(e>11&&e<=17){let t=25*i[12].x,s=25*i[12].y;h=t-=5*(e-12),r=s+=10*(e-12)}else if(e>17&&e<=23){let t=25*i[18].x,s=25*i[18].y;h=t-=10*(e-18),r=s-=2*(e-18)}else if(e>23&&e<=29){let t=25*i[24].x,s=25*i[24].y;h=t-=5*(e-24),r=s-=10*(e-24)}a.pos(l.x+h,l.y+r),o.state=L.START,this.ins.eneBulNode.addChild(a)}})}skill10(t){const e=this.owner,s=this.enemyCom.edata,i=[[-100,50],[-50,75],[0,100],[50,75],[100,50]];for(let l=0;l<i.length;l++){const a=this.open(u.battle.EnemySkill10,this.skill10Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(t||s.att,0,0,0,0);const o=a.getComponent(W);o.norV3=this.getVec3(0,1),o.state=L.READY,a.pos(e.x+i[l][0],e.y),this.ins.eneBulNode.addChild(a),Laya.Tween.to(a,{y:e.y+i[l][1]},500,null,Laya.Handler.create(this,()=>{this.ins.playerV2;Laya.timer.once(1e3,this,()=>{let t=this.getVec3(),e=this.ins.playerV2;Laya.Vector3.subtract(this.getVec3(e.x,e.y),this.getVec3(a.x,a.y),t),Laya.Vector3.normalize(t,o.norV3),o.state=L.START})}))}}skill11(t){const e=this.owner,s=this.enemyCom.edata,i=[this.getVec3(.87,-.5),this.getVec3(-.5,-.87),this.getVec3(-.87,.5),this.getVec3(.5,.87)],l=[-200,200];for(let a=0;a<l.length;a++){const n=this.open(u.battle.EnemySkill11,this.skill11Pre);n.pos(e.x,e.y+30),this.ins.eneBulNode.addChild(n),Laya.Tween.to(n,{x:e.x+l[a],y:e.y+230},3e3),this.lines.push(n),Laya.timer.once(6e3,this,()=>{n.removeSelf(),this.lines.splice(this.lines.indexOf(n),1)}),Laya.timer.once(3e3,this,()=>{let e=0;this.schedule(250,()=>{if(this.ins.gameState!=L.START)return;const l=this.open(u.battle.EnemySkill1,this.skill1Pre);let o=l.getComponent(M);o||(o=l.addComponent(M)),o.setData(t||s.att,0,0,0,0);const h=l.getComponent(W);h.norV3=i[e].clone(),a&&(h.norV3.x*=-1),l.pos(n.x,n.y),h.state=L.START,this.ins.eneBulNode.addChild(l),++e>=i.length&&(e=0)},this,12)})}}skill12(t){if(t!=this.enemyCom.eid)return;const e=this.owner,s=this.enemyCom.edata,i=this.enemyCom.norV3;let l=Math.atan2(-i.y,i.x);for(let t=0;t<2;t++){const i=this.open(u.battle.EnemySkill13,this.skill13Pre);let a=i.getComponent(M);a||(a=i.addComponent(M)),a.setData(s.att,0,0,0,0);let n=l+(t?Math.PI/2:-Math.PI/2),o=e.x+100*Math.cos(n),h=e.y-100*Math.sin(n);i.pos(o,h),this.ins.eneBulNode.addChild(i)}}}var q;!function(t){t[t.Move=0]="Move",t[t.Pause=1]="Pause",t[t.End=2]="End"}(q||(q={}));class Y extends x{constructor(){super(),this.ins=K.instance,this.timer=0,this._norV3=null,this.btimer=0,this.start=null,this.end=null,this.pt=null,this.bspeed=.02,this.endMsg=!1,this.moveTime=0,this.pauseTime=0,this.pauseMsg=!1,this.eskillCom=null,this.eid=null,this.state=L.START,this.moveState=q.Move,this.edata=null,this.isRotate=!1,this.isRotSelf=!1,this.isPauseSelf=!1,Y.__eid__++,this.eid=Y.__eid__}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&this.isRotSelf&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){if(this.state=L.START,this.moveState=q.Move,this.timer=0,this.btimer=0,this.moveTime=0,this.pauseTime=0,this.pauseMsg=!1,this.endMsg=!1,!this.edata)return;this.eskillCom=this.owner.getComponent(O);const e=this.edata,i=this.owner,l=r.enemys[e.type];if(l.skill){12==l.skill&&(this.isRotSelf=!0,this.isPauseSelf=!0)}this.start=e.in.clone(),e.direntry==s.Top?this.start.y-=i.height:e.direntry==s.Left?this.start.x-=i.width:e.direntry==s.Right?this.start.x+=i.width:e.direntry==s.Bottom&&(this.start.y+=i.height);const a=this.start;if(i.pos(a.x,a.y),e.out){this.end=e.out.clone(),e.direxit==s.Top?this.end.y-=i.height:e.direxit==s.Left?this.end.x-=i.width:e.direxit==s.Right?this.end.x+=i.width:e.direxit==s.Bottom&&(this.end.y+=i.height);const l=this.end;if(e.route==t.Line){let t=this.getVec3(),e=this.getVec3();Laya.Vector3.subtract(this.getVec3(l.x,l.y),this.getVec3(a.x,a.y),t),Laya.Vector3.normalize(t,e),this.norV3=e}else if(e.route==t.DownCurve){let t=this.getVec2(l.x-a.x,l.y-a.y),e=this.getVec2(a.x+t.x/2,a.y+t.y/2),s=this.getVec2(-t.y,t.x);t.x<0&&(s=this.getVec2(t.y,-t.x));let i=this.getVec2(e.x+s.x/2,e.y+s.y/2),n=2*i.x-(a.x+l.x)/2,o=2*i.y-(a.y+l.y)/2,h=this.getVec2(n,o);this.pt=h}else if(e.route==t.UpCurve){let t=this.getVec2(l.x-a.x,l.y-a.y),e=this.getVec2(a.x+t.x/2,a.y+t.y/2),s=this.getVec2(t.y,-t.x);t.x<0&&(s=this.getVec2(-t.y,t.x));let i=this.getVec2(e.x+s.x/2,e.y+s.y/2),n=2*i.x-(a.x+l.x)/2,o=2*i.y-(a.y+l.y)/2,h=this.getVec2(n,o);this.pt=h}}else{this.end=this.getVec2(a.x,e.in.y+e.distance);let t=this.end,s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(t.x,t.y),this.getVec3(a.x,a.y),s),Laya.Vector3.normalize(s,i),this.norV3=i}let n=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.end.x,this.end.y),this.getVec3(a.x,a.y),n);let o=Math.sqrt(n.x*n.x+n.y*n.y);this.bspeed=.02/(o/300)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.recover(this.owner)}bezier(t,e,s,i,l){l?(t.x=(1-e)*(1-e)*s.x+2*e*(1-e)*l.x+e*e*i.x,t.y=(1-e)*(1-e)*s.y+2*e*(1-e)*l.y+e*e*i.y):(t.x=s.x+(i.x-s.x)*e,t.y=s.y+(i.y-s.y)*e)}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;if(!this.edata)return;const s=this.owner,i=this.edata;let l=Laya.timer.delta;if(this.moveState==q.Move){if(this.btimer>=1){if(this.endMsg||(this.endMsg=!0,this.eskillCom&&this.eskillCom.initSkill(),this.edata.return==e.Remove&&(C.event(P.EnemyDead,s.getComponent(B)),s.removeSelf())),"number"==typeof i.return){const t=i.return;if(t==e.Return){const t=this.start.clone();this.start=this.end.clone(),this.end=t,this.norV3&&(this.norV3=this.getVec3(-this.norV3.x,-this.norV3.y))}else e.Repeat;this.btimer=0}else this.moveState=q.End;return}if(this.moveTime>=1e3)return this.moveState=q.Pause,void(this.moveTime=0);const a=this.start,n=this.end;i.route==t.Line?(this.btimer+=this.bspeed,s.x=a.x+(n.x-a.x)*this.btimer,s.y=a.y+(n.y-a.y)*this.btimer,this.isPauseSelf&&(this.moveTime+=l)):(this.btimer+=this.bspeed,this.bezier(s,this.btimer,this.start,this.end,this.pt))}if(this.moveState==q.Pause){if(this.pauseTime>=500)return this.moveState=q.Move,this.pauseTime=0,void(this.pauseMsg=!1);this.pauseMsg||(this.pauseMsg=!0,C.event(P.EnemyPause,this.eid)),this.pauseTime+=l}if(this.moveState==q.End){this.timer+=Laya.timer.delta/1e3;let t=Math.cos(this.timer);s.x+=t}if(this.isRotate){let t=this.ins.playerV2,e=s.x-t.x,i=s.y-t.y;s.rotation=Math.atan2(e,-i)/Math.PI*180}}}Y.__eid__=0;class X extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.enemyCom=null,this.buffNode=null,this.boomPre=null,this.hpBar=null,this.barPor=1,this.hp=0,this.timers={},this.boomPre=this.getRes(u.battle.EnemyBoom)}onEnable(){const t=this.owner;this.hpBar=t.getChildByName("hpBar"),this.selfCol=this.owner.getComponent(B),this.enemyCom=this.owner.getComponent(Y),this.hp=this.enemyCom.edata.hp,this.hpBar.value=1,this.barPor=1,C.on(P.LaserHide,this,t=>{let e=this.selfCol.bids.indexOf(t.bid);e>-1&&(this.selfCol.bids.splice(e,1),this.onCollisionExit(t,this.selfCol))}),C.on(P.GameStateChange,this,()=>{if(this.ins.gameState==L.PAUSE)for(const t in this.timers){const e=this.timers[t];e&&e.hit&&e.hit.removeSelf()}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this),this.buffNode&&this.buffNode.removeSelf(),this.buffNode=null;for(const t in this.timers){const e=this.timers[t];e&&e.timer&&clearInterval(e.timer),e&&e.hit&&e.hit.removeSelf()}this.timers={}}onCollision(t,e,s){if(this.ins.gameState!=L.START)return;const i=this.owner;if(!i||!i.parent)return void this.onDisable();if(i.x<=-10||i.x>=730||i.y<=-10||i.y>=1290)return;if(!e||!e.owner||!e.owner.getComponent(M))return;const l=e.owner.getComponent(M).data,a=this.ins.playerData.skills;if(a[T.Cri]){c.skills[T.Cri].value}if(this.hp-=Math.floor(l.attack),console.log("hp -> ",this.hp),this.barPor=this.hp/this.enemyCom.edata.hp,s&&this.makeBoom("hit",e.owner),a[T.SuckBlood]){c.skills[T.SuckBlood].value}const n=this.open(u.battle.EnemyHPTip,this.ins.eneHPTipPre);n.text=`-${Math.floor(l.attack)}`,n.pos(t.x,this.owner.y),this.ins.effectNode.addChild(n),this.hp<=0&&(this.onDisable(),this.owner.removeSelf(),C.event(P.EnemyDead,this.selfCol),this.makeBoom(this.enemyCom.edata.type),this.makeCoin(),a[T.DieBoom]&&this.makeDieBoom(),a[T.DieShot]&&this.makeDieShot())}makeBoom(t,e){const s=this.boomPre,i=this.open(u.battle.EnemyBoom,s);i.__$type$__=t;let l=this.owner;if(e){let t=l.x-e.x,s=l.y-e.y;i.x=e.x+t/2,i.y=e.y+s/2,i.getComponent(R).delta=100}else i.x=l.x,i.y=l.y;this.ins.effectNode.addChild(i)}makeCoin(){const t=this.getRes(g.Coin),e=Laya.Sprite3D.instantiate(t),s=this.ins,i=this.owner;let l=this.getVec3();s.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(i.x,i.y),l),e.transform.position=l,e.transform.localScale=this.getVec3(10,10,10),e.transform.rotationEuler=this.getVec3(-90,0,0),e.addComponent(_),s.modSceneV3.addChild(e)}makeDieBoom(){const t=this.ins.playerData,e=this.getRes(u.battle.PlayerDieBoom),s=this.open(u.battle.PlayerDieBoom,e),i=this.owner;s.x=i.x,s.y=i.y;let l=s.getComponent(M);l||(l=s.addComponent(M));const a=c.skills[T.DieBoom].value||1;l.setData(Math.floor(t.attack*a),t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr),this.ins.effectNode.addChild(s)}makeDieShot(){const t=this.owner,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(.71,-.71),this.getVec3(1,0),this.getVec3(.71,.71),this.getVec3(0,1),this.getVec3(-.71,.71),this.getVec3(-1,0),this.getVec3(-.71,-.71)],i=this.getRes(u.battle.PlayerDieShot),l=c.skills[T.DieShot];for(let a=0;a<8;a++){const n=this.open(u.battle.PlayerDieShot,i),o=n.getComponent(j);let h=n.getComponent(M);h||(h=n.addComponent(M));const r=c.skills[T.DieShot].value||1;h.setData(Math.floor(e.attack*r),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),o.speed=l.fspeed,o.norV3=s[a].clone(),o.state=L.START,o.tar=null,n.pos(t.x,t.y),this.ins.playerNode.addChild(n)}}onCollisionEnter(t,e,s){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;const i=this.owner;let l=t.owner.__type__,a=!0,n=t.owner;if((s||l&&l==V.MAGNET)&&(n=e.owner,a=!1),l&&(l==V.POISON||l==V.FIRE)&&(a=!1,this.schedule(1e3,()=>{this.onCollision(e.owner,t)},this,4,null,!0),!this.buffNode)){const t=l==V.POISON?u.battle.PlayerPoisonBuff:u.battle.PlayerFireBuff,e=this.getRes(t),s=this.open(t,e),a=i.getChildAt(0);s.pos(a.x,a.y),this.owner.addChild(s),this.buffNode=s,Laya.timer.once(4e3,this,()=>{s.removeSelf(),this.buffNode=null})}if(l&&l==V.ICE&&(a=!1,this.enemyCom.state=L.PAUSE,Laya.timer.once(3e3,this,()=>{this.enemyCom.state=L.START})),l&&l==V.LASER&&(a=!1),this.onCollision(n,t,a),this.timers&&l&&l==V.LASER){let e=setInterval(()=>{this.onCollision(n,t)},200);const s=()=>{if(this.ins.gameState!=L.START)return;const t=this.getRes(u.battle.PlayerLaserHit),e=this.open(u.battle.PlayerLaserHit,t);e.x=n.x,e.y=this.owner.y;const s=e.getComponent(A);return s.xp=n,s.yp=this.owner,this.ins.effectNode.addChild(e),e},i=this.timers[t.bid];if(i)if(i.timer&&clearInterval(i.timer),this.timers[t.bid].timer=e,i.hit){const t=i.hit.getComponent(A);t.xp=n,t.yp=this.owner}else{const e=s();this.timers[t.bid].hit=e}else{const i=s();this.timers[t.bid]={timer:e,hit:i}}}}onCollisionExit(t,e){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;let s=t.owner.__type__;if(s&&s==V.LASER){if(!this.timers)return;const e=this.timers[t.bid];e&&(e.timer&&clearInterval(e.timer),e&&e.hit&&e.hit.removeSelf(),this.timers[t.bid]=null)}}onLateUpdate(){let t=this.getVec3();Laya.Vector3.lerp(this.getVec3(this.hpBar.value),this.getVec3(this.barPor),.01*Laya.timer.delta,t),this.hpBar.value=t.x}}class z extends x{constructor(){super(),this.ins=K.instance,this.han1=null,this.han2=null,this.cloHan=null,this.tar=null,this.isClose=!1}onEnable(){this.isClose=!1;const t=this.owner,e=this.ins,s=t.getChildByName("s1"),i=t.getChildByName("s2"),l=e.playerData.supUnlock,a=l.length-1,n=[];for(;n.length<2;){let t=Math.floor(Math.random()*(a-0+1)+0);n.indexOf(t)<0&&n.push(t)}let o=l[n[0]],h=l[n[1]];this.setSkill(s,o,0),this.setSkill(i,h,1),this.setClick(s,()=>{this.han1&&this.han1(),this.onCloseClick()},this),this.setClick(i,()=>{this.han2&&this.han2(),this.onCloseClick()},this)}setSkill(t,e,s){const i=t.getChildByName("name"),l=t.getChildByName("desc"),a=c.skills[e];i.text=a.name,l.text=a.describe,s?this.han2=(()=>{C.event(`player_${a.id}_supply`)}):this.han1=(()=>{C.event(`player_${a.id}_supply`)})}onCloseClick(){this.owner.removeSelf();const t=this.ins,e=this.tar;Laya.Tween.to(e,{y:0-e.height/2},500,null,Laya.Handler.create(this,()=>{this.cloHan&&!this.isClose&&(this.isClose=!0,this.cloHan()),t.player2Node.alpha=1,t.playerNode.alpha=1,t.effectNode.alpha=1,t.bgTopNode.alpha=1,e.removeSelf()}))}onDisable(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}onUpdate(){this.ins.gameState,L.START}}class G extends x{constructor(){super(),this.ins=K.instance,this.skeCon=null,this.templet=null,this.ske=null,this.cloHan=null,this.edata=null}onEnable(){const t=this.owner,e=this.ins;e.playerNode.alpha=0;const s=e.player2Node;for(let t=s.numChildren-1;t>=0;t--){s.getChildAt(t).removeSelf()}e.player2Node.alpha=0,e.effectNode.alpha=0,e.bgTopNode.alpha=0;const i=new Laya.Templet;this.templet=i,i.on(Laya.Event.COMPLETE,this,this.parseComplete),i.loadAni(m[3002]);const l=e.playerV3;let a=this.getVec3();e.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,764),a),Laya.Tween.to(t,{y:640},500,null,Laya.Handler.create(this,()=>{Laya.Tween.to(l.transform,{localPositionX:a.x,localPositionZ:a.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{e.playerPosV3=a,e.playerPosV2=this.getVec3(360,764),Laya.timer.once(1e3,this,()=>{this.openDialog(u.battleUI.SupplySkillDialog,e.dialogNode,e=>{e.y=1140;const s=e.getComponent(z);s.cloHan=this.cloHan,s.tar=t},!0)})}))}))}parseComplete(){this.ske=this.templet.buildArmature(0);const t=this.ske,e=D[3002];t.pos(e.self.x,e.self.y),t.on(Laya.Event.STOPPED,this,this.completeHandler),t.play(0,!1),this.skeCon.addChild(t)}completeHandler(){this.ske.play(1,!0)}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop(),this.ske.removeSelf()),this.templet&&(this.templet.offAllCaller(this),this.templet.destroy()),Laya.Tween.clearAll(this),Laya.timer.clearAll(this),this.recover(this.owner)}onUpdate(){}}class F extends x{constructor(){super(),this.maskNode=null,this.skill1Tit=null,this.skill1Icon=null,this.skill1Desc=null,this.skill2Tit=null,this.skill2Icon=null,this.skill2Desc=null,this.skill3Tit=null,this.skill3Icon=null,this.skill3Desc=null,this.skills=[],this.handle=null}onEnable(){this.setClick(this.skill1Icon,()=>{const t=this.skills[0].han;t&&t(),this.hide(this.skills[0].id)},this),this.setClick(this.skill2Icon,()=>{const t=this.skills[1].han;t&&t(),this.hide(this.skills[1].id)},this),this.setClick(this.skill3Icon,()=>{const t=this.skills[2].han;t&&t(),this.hide(this.skills[2].id)},this),this.setClick(this.maskNode,()=>{},this,null,!0),this.skills.length||(this.skills.push({title:this.skill1Tit,icon:this.skill1Icon,desc:this.skill1Desc,han:null,id:null}),this.skills.push({title:this.skill2Tit,icon:this.skill2Icon,desc:this.skill2Desc,han:null,id:null}),this.skills.push({title:this.skill3Tit,icon:this.skill3Icon,desc:this.skill3Desc,han:null,id:null}))}setData(t){const e=this.skills;for(let s=0;s<t.length;s++){const i=t[s],l=e[s];if(!l)continue;const a=c.skills[i];l.title.text=a.name,l.desc.text=a.describe,l.han=(()=>{let t="";i<2e3?t=`player_${i}_baseskill`:i>2e3&&i<3e3?t=`player_${i}_bulskill`:i>3e3&&i<4e3?t=`player_${i}_wingskill`:i>4e3&&(t=`player_${i}_robskill`),C.event(t)}),l.id=i}}hide(t){this.handle&&t&&this.handle(t),Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{C.event(P.RateStart),this.owner.removeSelf()}))}onDisable(){}}class Q extends x{constructor(){super(),this.ins=K.instance,this.pauseBtn=null,this.lvPro=null,this.lvLab=null,this.rateLab=null,this.coinLab=null,this.rewardLab=null,this.rateTipLab=null,this.supplyData=null}onEnable(){const t=this.ins,e=t.playerData,s=h.comChapters[e.chapter-1];this.rateLab.text=`${e.rate}/${s.level}`,this.setClick(this.pauseBtn,()=>{let e=t.gameState;e==L.START&&(t.gameState=e==L.START?L.PAUSE:L.START,this.loadPrefab(u.battleUI.PlayerSkillItem).then(()=>{this.openDialog(u.battleUI.GamePauseDialog,t.dialogNode)}))},this),C.on(P.RateStart,this,()=>{t.gameState=L.START;let i=l.levelExps[e.level],a=e.exp/i,n=e.level,o=h.comChapters[e.chapter-1].maxair;e.level>=o+1&&(a=1,n=o),this.lvPro.value=a,this.lvLab.text=`LV. ${n}`,e.rate+=1,this.rateLab.text=`${e.rate}/${s.level}`;let r=this.rateTipLab;r.text=`第${e.rate}关`,r.x=1080,Laya.Tween.to(r,{x:340},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{Laya.Tween.to(r,{x:380},1e3,null,Laya.Handler.create(this,()=>{Laya.Tween.to(r,{x:-360},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{}))}))})),C.event(P.LevelEnemy)}),C.on(P.RateEnd,this,()=>{const s=()=>{const s=e.chapter;let a=e.rate;const n=e.rate+1;if(!i["enemys"+s][n])return t.playerNode.alpha=0,t.player2Node.alpha=0,t.eneBulNode.alpha=0,t.effectNode.alpha=0,t.bgTopNode.alpha=0,void(t.gameState=L.END);let o=l.upLevExps[a]||1,r=l.levelExps[e.level];e.exp+=o;let c=e.exp/r,p=h.comChapters[e.chapter-1].maxair;e.level>=p+1&&(c=1),Laya.Tween.to(this.lvPro,{value:c},1e3,Laya.Ease.cubicIn,Laya.Handler.create(this,()=>{e.level<p+1&&e.exp>=r?(e.level+=1,e.exp=0,this.getRandomSkill()):C.event(P.RateStart)}))};if(this.supplyData){t.gameState=L.PAUSE;const e=this.supplyData;this.supplyData=null;const i=this.open(b[e.type],t.eneMgr.enemyPres[e.type]),l=i.getComponent(G);i.pos(360,1280+i.height/2),l.edata=e,l.cloHan=s.bind(this),this.ins.bgSceneV2.addChild(i)}else s()});let n=!1;C.on(P.GameStateChange,this,()=>{this.ins.gameState!=L.END||n||(n=!0,t.playerV3&&t.playerV3.parent?(Laya.timer.once(3e3,this,()=>{const e=t.playerV3;let s=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,640),s),Laya.Tween.to(e.transform,{localPositionX:s.x,localPositionZ:s.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{Laya.timer.once(1e3,this,()=>{Laya.Tween.to(e.transform,{localPositionZ:s.z-8},300,null,Laya.Handler.create(this,()=>{this.loadPrefab(u.battleUI.PlayerSkillItem).then(()=>{this.openDialog(u.battleUI.GameOverDialog,t.dialogNode)})}))})}))}),a.setChapter()):Laya.timer.once(3e3,this,()=>{this.openDialog(u.battleUI.GameOverDialog,t.dialogNode)}))}),C.on(P.GameOver,this,()=>{t.gameState=L.END})}getRandomSkill(){const t=this.ins,e=t.playerData;t.gameState=L.PAUSE;const s=e.unlock,i=c.skills,l=(()=>{let l=s.concat();const a=l.indexOf(1013);if(e.currHP>=e.hp&&a>=0&&l.splice(a,1),t.plaWingsV2.length>=4)for(let t=l.length-1;t>=0;t--){const e=l[t];3==i[e].skilltype&&l.splice(t,1)}else{let t=null;for(const s in e.skills)3==i[s].skilltype&&(t=parseInt(s));if(t)for(let e=l.length-1;e>=0;e--){const s=l[e];3==i[s].skilltype&&s!=t&&l.splice(e,1)}}return l})();if(l.length<3)return void C.event(P.RateStart);const a=[],n=l.length-1;for(;a.length<3;){let t=Math.floor(Math.random()*(n-0+1)+0);a.indexOf(t)<0&&a.push(t)}let h=l[a[0]],r=l[a[1]],p=l[a[2]];this.openDialog(u.battleUI.ChooseSkillDialog,t.dialogNode,t=>{const e=t.getComponent(F);e.handle=(t=>{const e=i[t],l=s.indexOf(t);e.add==o.Once&&s.splice(l,1),e.add==o.Add&&(i[t+1]&&i[t+1].add==o.Add?s[l]=t+1:s.splice(l,1))}).bind(this),e.setData([h,r,p])})}onDisable(){C.offAllCaller(this),Laya.timer.clearAll(this),Laya.Tween.clearAll(this)}}class $ extends x{constructor(){super(),this.ins=null,this.timer=0,this.eneQue={},this.start=!1,this.insUI=null,this.enemyPres={};for(const t in b){const e=b[t];this.enemyPres[t]=this.getRes(e)}}onEnable(){this.ins=K.instance,this.insUI=this.ins.owner.getComponent(Q),C.on(P.LevelEnemy,this,this.makeLevelEnemy)}onDisable(){}makeLevelEnemy(){const t=this.ins,e=t.playerData,s=e.chapter,l=e.rate;t.isMakingEnemy=!0;const a=i["enemys"+s][l];for(let t=0;t<a.length;t++){const e=a[t];if(this.enemyPres[e.type])if(3002==e.type||3003==e.type)this.insUI.supplyData=e;else if(1001==e.type){const t=Math.floor(3*Math.random()+4),s=e.time;for(let i=0;i<t;i++){let t=s+.2*i;if(this.eneQue[1e3*t]){let s=.2;for(;this.eneQue[1e3*t+s];)s+=.2;this.eneQue[1e3*t+s]=e}else this.eneQue[1e3*t]=e}}else if(this.eneQue[1e3*e.time]){let t=1;for(;this.eneQue[1e3*e.time+t];)t++;this.eneQue[1e3*e.time+t]=e}else this.eneQue[1e3*e.time]=e}this.start=!0,this.timer=0}enemy(t){const e=this.open(b[t.type],this.enemyPres[t.type]),s=e.getComponent(Y);s.edata=t,s.isRotate=!1,s.isRotSelf=!1,s.isPauseSelf=!1,e.pos(0,-1e3),this.ins.enemyNode.addChild(e);const i=e.getComponent(B);this.ins.enemyCols.push(i),Object.keys(this.eneQue).length||(C.event(P.LevelEnemyEnd),this.ins.isMakingEnemy=!1)}onLateUpdate(){if(this.ins.gameState==L.START&&this.start){this.timer+=Laya.timer.delta;for(const t in this.eneQue)if(this.timer>=parseInt(t)){const e=this.eneQue[t];delete this.eneQue[t],this.enemy(e)}Object.keys(this.eneQue).length||(this.start=!1,this.timer=0)}}}class Z{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.speed=0,this.fspeed=0,this.eneHurtStr=0,this.bosHurtStr=0,this.planeData=null,this.hp=0,this.currHP=0,this.defense=0,this.subHurt=0,this.id=0,this.chapter=1,this.rate=1,this.exp=0,this.level=1,this.skills={},this.rewards={},this.track=!1,this.cross=!1,this.unlock=[],this.supUnlock=[],this.laserSta=0,this.trackTar=null,this.trackBox=null,this.trackCol=null,this.mainNum=0}init(){this.id=a.id,this.planeData=d.planes[this.id],this.attack=a.attack,this.crit=a.crit,this.critHurt=a.critHurt,this.speed=a.speed,this.fspeed=a.fspeed,this.eneHurtStr=a.eneHurtStr,this.bosHurtStr=a.bosHurtStr,this.hp=a.hp,this.currHP=a.hp,this.defense=a.defense,this.subHurt=a.subHurt,this.chapter=a.chapter,this.rate=a.rate,this.exp=0,this.level=1,this.skills={},this.rewards={};const t=a.unlock;for(let e=0;e<t.length;e++){c.skills[t[e]].add!=o.Supply?this.unlock.push(t[e]):this.supUnlock.push(t[e])}}setSkill(t){this.skills[t]?this.skills[t]++:this.skills[t]=1}setSkill2(t){const e=this.skills;let s=null;for(let i=0;i<5;i++){const l=t+i;if(e[l]){s=l;break}}s?(e[s+1]=1,delete e[s]):e[t]=1}}class J extends x{constructor(){super(),this.ins=K.instance}onEnable(){}onDisable(){}onLateUpdate(){const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),i=this.getVec3();Laya.Vector3.lerp(s,this.ins.playerPosV2,15*e,i),t.pos(i.x,i.y)}}class K extends x{constructor(){super(),this.bgPre=null,this.eneHPTipPre=null,this.enemyNode=null,this.bgTopNode=null,this.eneBulNode=null,this.playerNode=null,this.player2Node=null,this.effectNode=null,this.dialogNode=null,this.bgSceneV2=null,this.modSceneV3=null,this.modCameraV3=null,this.playerV3=null,this.playerV2=null,this.playerHPV2=null,this.plaLassV2=[],this.plaWingsV2=[],this.playerPosV3=new Laya.Vector3(0,0,0),this.playerPosV2=new Laya.Vector3(360,900,0),this.touchX=0,this.touchY=0,this.rotationZ=0,this.lastX=0,this.ratio3D=128,this.isMakingEnemy=!1,this.playerData=null,this._gameState=L.READY,this.eneMgr=null,this.enemyCols=[],this.playerCols=[],K.instance=this;const t=Laya.stage.addChild(new Laya.Scene);t.zOrder=-2,this.bgSceneV2=t;const e=Laya.stage.addChild(new Laya.Scene3D);e.zOrder=-1,this.modSceneV3=e;const s=e.addChild(new Laya.Camera(0,.1,1e3));this.modCameraV3=s,s.clearFlag=Laya.CameraClearFlags.Nothing,s.clearColor=new Laya.Vector4(0,0,0,0),s.transform.rotate(new Laya.Vector3(-90,0,0),!1,!1),s.orthographic=!0,s.orthographicVerticalSize=10;const i=e.addChild(new Laya.DirectionLight);i.color=new Laya.Vector3(1,1,1),i.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0)),this.bgPre=this.getRes(u.battle.BgNode),this.eneHPTipPre=this.getRes(u.battle.EnemyHPTip)}set gameState(t){this._gameState=t,C.event(P.GameStateChange)}get gameState(){return this._gameState}onEnable(){const t=this.open(u.battle.BgNode,this.bgPre);this.bgSceneV2.addChild(t),this.enemyNode=this.bgSceneV2.addChild(new Laya.Sprite),this.bgTopNode=this.bgSceneV2.addChild(new Laya.Sprite),this.eneMgr=this.owner.getChildByName("enemyManager").getComponent($),this.gameState=L.READY,this.playerData=new Z,this.playerData.init(),C.on(P.LaserTrack,this,this.getTrackEnemy),C.on(P.EnemyDead,this,t=>{this.enemyCols.splice(this.enemyCols.indexOf(t),1);this.playerData;this.isMakingEnemy||this.enemyCols.length||Laya.timer.once(2e3,this,()=>{C.event(P.RateEnd)}),2==this.playerData.laserSta&&this.playerData.trackBox&&t.bid==this.playerData.trackBox.bid&&this.getTrackEnemy()}),C.on(P.LevelEnemyEnd,this,()=>{2==this.playerData.laserSta&&this.getTrackEnemy()}),C.on(P.GameOver,this,()=>{this.playerV3.removeSelf(),this.playerV2.removeSelf(),this.playerHPV2.removeSelf();for(let t=0;t<this.plaLassV2.length;t++)this.plaLassV2[t].removeSelf();for(let t=0;t<this.plaWingsV2.length;t++)this.plaWingsV2[t].removeSelf()});const e=window.location.href,s=e.indexOf("?");if(s>-1){const t=e.slice(s+1).split("&"),i=[];for(let e=0;e<t.length;e++){const s=t[e];i[e]=parseFloat(s)}const l=c.skills;if(i[0]<1e3){const t=this.playerData;t.id=i[0],t.planeData=d.planes[t.id],t.planeData.att=i[1],t.speed=i[2],t.fspeed=i[3]}else{const t=l[i[0]];t&&(t.value=i[1],t.speed=i[2],t.fspeed=i[3],t.robotsp=i[4],t.robotbullet=i[5])}}}onDisable(){this.bgSceneV2.destroy(!0),this.modSceneV3.destroy(!0),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}getTrackEnemy(){let t=this.getMinEnemy(this.playerV2);t?(this.playerData.trackTar=t,this.playerData.trackBox=t.getComponent(B),this.playerData.trackCol=t.getComponent(X)):(this.playerData.trackTar=null,this.playerData.trackBox=null,this.playerData.trackCol=null),C.event(P.LaserTrackTar)}getMinEnemy(t){let e=null,s=null;for(let i=0;i<this.enemyCols.length;i++){const l=this.enemyCols[i].owner;if(!l||!l.parent)continue;let a=l.x-t.x,n=l.y-t.y,o=a*a+n*n;(!e||o<e)&&(e=o,s=l)}return s}onStageMouseDown(t){this.gameState==L.START&&(this.touchX=t.stageX,this.touchY=t.stageY)}onStageMouseMove(t){if(this.gameState!=L.START)return;let e=t.stageX-this.touchX,s=t.stageY-this.touchY;this.rotationZ-=e/8,Math.abs(this.rotationZ)>45&&(this.rotationZ*=.7),this.touchX=t.stageX,this.touchY=t.stageY;let i=this.playerPosV2.x+e,l=this.playerPosV2.y+s;i>=0&&i<=720&&(this.playerPosV2.x=i),l>=0&&l<=1280&&(this.playerPosV2.y=l),this.modCameraV3.convertScreenCoordToOrthographicCoord(this.playerPosV2,this.playerPosV3)}onStageMouseUp(t){this.gameState==L.START&&(this.touchX=0,this.touchY=0,this.rotationZ=0,this.playerV3.transform.localRotationEulerZ=0)}onLateUpdate(){if(this.gameState!=L.START)return;let t=Laya.timer.delta/1e3;if(this.playerV3){let e=this.playerV3.transform.position,s=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(e,this.playerPosV3,15*t,s),this.playerV3.transform.position=s,Math.abs(this.playerV3.transform.position.x-this.lastX)<=.02&&(this.rotationZ=0);let i=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(this.playerV3.transform.localRotationEuler,this.getVec3(0,0,this.rotationZ),15*t,i),this.playerV3.transform.localRotationEuler=i,this.lastX=this.playerV3.transform.position.x}}}class tt extends x{constructor(){super(),this.ins=K.instance,this.laser=null,this.laser2=null,this.deltaX=0,this.deltaY=0}onEnable(){this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER),this.laser2&&(this.laser2.blendMode=Laya.BlendMode.LIGHTER)}onDisable(){}onLateUpdate(){const t=this.owner;let e=this.ins.playerV2;t.pos(e.x+this.deltaX,e.y+this.deltaY)}}class et extends x{constructor(){super(),this.ins=K.instance,this._norV3=null,this.speed=.1}get norV3(){return this._norV3}set norV3(t){this._norV3=t}onEnable(){}onDisable(){}onLateUpdate(){if(this.ins.gameState!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class st extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this._norV3=null,this.state=L.READY,this.radius=100,this.angle=0,this.speed=1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner;this.selfCol=this.owner.getComponent(B),this.ins.playerCols.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol),this.state=L.START}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins,e=this.owner;let s=Laya.timer.delta/200*this.speed;this.angle+=s,e.rotation=-180-this.angle/Math.PI*180,e.x=t.playerV2.x+this.radius*Math.cos(this.angle),e.y=t.playerV2.y-this.radius*Math.sin(this.angle)}}class it extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=L.READY,this.speed=.8}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.state=L.START}onDisable(){C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(K.instance.enemyCols,this.selfCol)}}class lt extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.speed=2.5,this.state=L.READY,this.delta=0}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.state=L.START}onDisable(){C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0-this.delta||t.x>=720+this.delta||t.y<=0-this.delta||t.y>=1280+this.delta)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class at extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.angle=0,this.state=L.READY,this.js=!1,this.tar=null,this.pangle=0,this.speed=.5,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.angle=0,this.js=!1,this.state=L.START;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(g.Track),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s}onDisable(){this.s3d.removeSelf(),C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.js){if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i),Laya.Vector3.lerp(this.norV3,i,e/50,l),this.norV3=l,e*=2}}else{if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let a=Math.atan2(-i.y,i.x);Laya.Vector3.lerp(this.getVec3(this.pangle),this.getVec3(a),e/100,l),this.pangle=l.x;let n=this.tar.x-t.x,o=this.tar.y-t.y;n*n+o*o<=9e4&&(this.js=!0)}this.angle+=5;let s=Math.atan(Math.cos(this.angle/180*Math.PI)),i=.7*Math.tan(s),l=new Laya.Vector3(0,0,0),a=this.pangle,n=1*Math.cos(a)+i*Math.sin(a),o=i*Math.cos(a)-1*Math.sin(a);Laya.Vector3.normalize(this.getVec3(n,o),l),this.norV3=l}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class nt extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=L.READY,this.angle=0,this.type=null,this.speed=1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner.__type__=this.type?this.type:V.POISON,this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.state=L.START}onDisable(){C.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta/200*this.speed;this.angle+=e,t.rotation=-180-this.angle/Math.PI*180,t.x=this.ins.playerV2.x+200*Math.cos(this.angle),t.y=this.ins.playerV2.y-200*Math.sin(this.angle),this.quadTree.check(K.instance.enemyCols,this.selfCol)}}class ot extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=L.READY,this.move=!0,this.getTar=!1,this.timer=0,this.deltaY=0,this.startGet=0,this.speed=.5,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.move=!0,this.getTar=!1,this.timer=0,this.deltaY=0,this.startGet=0,this.state=L.READY,C.on(P.BulSkill7_Start,this,()=>{this.state=L.START})}onDisable(){C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;if(this.move)if(this.deltaY>=200)this.move=!1,this.deltaY=0,this.startGet++;else{t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180);let s=e*this.norV3.x;t.x+=s;let i=e*this.norV3.y;t.y+=i,this.deltaY+=Math.abs(i)}else if(this.timer>=300)this.move=!0,this.getTar=!1,this.timer=0;else{if(!this.getTar){this.getTar=!0;let e=this.ins.getMinEnemy(this.owner);if(this.startGet>=2&&e&&e.parent){let s=this.getVec3();Laya.Vector3.subtract(this.getVec3(e.x,e.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,this.norV3)}else this.norV3.x=-this.norV3.x}this.timer+=Laya.timer.delta}(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class ht extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.t=0,this.circle=!1,this.bezierd=!1,this.start=null,this.pt=null,this.state=L.START,this.tar=null,this.speed=1,this.cross=!1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.t=0,this.circle=!1,this.bezierd=!1}onDisable(){this.recover(this.owner)}bezier(t,e,s,i,l){t.x=(1-e)*(1-e)*s.x+2*e*(1-e)*l.x+e*e*i.x,t.y=(1-e)*(1-e)*s.y+2*e*(1-e)*l.y+e*e*i.y;let a=2*((1-e)*(l.x-s.x)+e*(i.x-l.x)),n=2*((1-e)*(l.y-s.y)+e*(i.y-l.y)),o=this.getVec3();Laya.Vector3.normalize(this.getVec3(a,n,0),o),this.norV3=o}onCollisionEnter(t,e){this.cross||this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;if(this.tar&&this.tar.parent)if(t.y<=this.tar.y||this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.t=1,this.tar=null;else if(Math.abs(t.y-this.tar.y)<=500&&!this.bezierd){this.bezierd=!0,this.start=this.getVec3(t.x,t.y);let e=this.start,s=this.tar,i=2*(e.x+(s.x-e.x)/4)-(e.x+s.x)/2,l=2*(e.y+(s.y-e.y)/4*3)-(e.y+s.y)/2;this.pt=this.getVec3(i,l),this.circle=!0}if(this.circle&&this.tar&&this.tar.parent){if(this.t>=1)return void(this.circle=!1);this.t+=.021,this.bezier(t,this.t,this.start,this.getVec3(this.tar.x,this.tar.y),this.pt)}this.circle&&this.tar&&this.tar.parent||(t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class rt extends x{constructor(){super(),this.ins=K.instance,this.deltaX=0,this.deltaY=0}onEnable(){}onDisable(){}onLateUpdate(){const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),i=this.getVec3(this.ins.playerPosV2.x+this.deltaX,this.ins.playerPosV2.y+this.deltaY),l=this.getVec3();Laya.Vector3.lerp(s,i,8*e,l),t.pos(l.x,l.y)}}class ct extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.circle=!0,this.state=L.READY,this.tar=null,this.angle=0,this.xv=1,this.speed=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.state=L.START,this.circle=!0;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(g.Track),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s}onDisable(){this.s3d.removeSelf(),C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.tar&&this.tar.parent)if(t.y<=this.tar.y||this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.tar=null;else if(this.circle){let s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x)-Math.atan2(-this.norV3.y,this.norV3.x);if(l<0&&(l+=2*Math.PI),l<=.2)this.circle=!1;else{this.angle+=this.xv*e/2;let t=Math.tan(this.angle/180*Math.PI),s=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-t,0),s),this.angle>90&&(s.x=-s.x,s.y=-s.y),this.norV3.x=s.x,this.norV3.y=s.y}}else{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class pt extends x{constructor(){super(),this.ins=K.instance,this.wing2BPre=null,this.xv=1,this.wing2BPre=this.getRes(u.battle.PlayerWing2b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=c.skills[T.MissileWing],i=s.speed||5,l=s.fspeed||.2;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=L.START)return;let i=0;for(let a=0;a<6;a++){let a=Math.floor(89*Math.random()+1),n=Math.tan(a/180*Math.PI),o=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,n,0),o),o.x*=this.xv,i+=Math.floor(251*Math.random()+50),Laya.timer.once(i,this,()=>{const i=this.open(u.battle.PlayerWing2b,this.wing2BPre);let n=i.getComponent(M);n||(n=i.addComponent(M));const h=s.value||1;let r=e.attack*h;e.skills[T.MissileWing]&&(r+=e.attack*h*(e.skills[T.MissileWing]-1)*2.4),n.setData(r,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const c=i.getComponent(ct);c.speed=l,c.norV3=o,c.angle=this.xv>0?-a:a+180,c.xv=this.xv,c.tar=this.ins.getMinEnemy(t),i.pos(t.x,t.y),this.ins.player2Node.addChild(i)})}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}onLateUpdate(){}}class yt extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this.bid=T.Laser}onEnable(){const t=this.owner;t.__type__=V.LASER,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),t.alpha=1;const e=c.skills[this.bid];let s=1e3*(e.fspeed+e.speed+1),i=1e3*e.speed+500;Laya.timer.loop(s,this,()=>{Laya.Tween.to(t,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids()})),Laya.timer.once(i,this,()=>{Laya.Tween.to(t,{alpha:1},500)})}),C.on(P.GameStateChange,this,()=>{this.ins.gameState==L.START?t.visible=!0:t.visible=!1})}onDisable(){this.clearBids(),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}clearBids(){this.selfCol.bids.length=0,C.event(P.LaserHide,this.selfCol)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;const t=this.owner;t.visible&&t.alpha>=.1&&this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class dt extends x{constructor(){super(),this.ins=K.instance,this.laser=null,this.tar=null,this.deltaX=0,this.deltaY=0}onEnable(){this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER)}onDisable(){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(!this.tar)return;const t=this.owner;let e=this.tar;t.pos(e.x+this.deltaX,e.y+this.deltaY)}}class ut extends x{constructor(){super(),this.ins=K.instance,this.wing3BPre=null,this.xv=1,this.wing3BPre=this.getRes(u.battle.PlayerWing3b)}onEnable(){const t=this.ins.playerData,e=this.open(u.battle.PlayerWing3b,this.wing3BPre);let s=e.getComponent(M);s||(s=e.addComponent(M));const i=c.skills[T.LaserWing].value||1;let l=t.attack*i;t.skills[T.LaserWing]&&(l+=t.attack*i*(t.skills[T.LaserWing]-1)*2.4),s.setData(l,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr);let a=this.owner;e.getComponent(dt).tar=a,e.getComponent(yt).bid=T.LaserWing,e.pos(a.x,a.y),this.ins.playerNode.addChild(e)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}onLateUpdate(){}}class gt extends x{constructor(){super(),this.ins=K.instance,this.wing5BPre=null,this.xv=1,this.wing5BPre=this.getRes(u.battle.PlayerWing5b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=c.skills[T.ShotWing],i=s.speed||.2,l=s.fspeed||.2,a=[this.getVec3(.03,-1),this.getVec3(.07,-1),this.getVec3(.1,-.99),this.getVec3(.14,-.99),this.getVec3(.17,-.98),this.getVec3(.21,-.98)];let n=0;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=L.START)return;n>=6&&(n=0);const i=this.open(u.battle.PlayerWing5b,this.wing5BPre);let o=i.getComponent(M);o||(o=i.addComponent(M));const h=s.value||1;let r=e.attack*h;e.skills[T.ShotWing]&&(r+=e.attack*h*(e.skills[T.ShotWing]-1)*2.4),o.setData(r,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const c=i.getComponent(lt);let p=a[n];c.norV3=this.getVec3(p.x*this.xv,p.y),c.speed=l,i.pos(t.x,t.y),this.ins.player2Node.addChild(i);const y=i.getChildByName("bi");y.height=0,Laya.Tween.clearAll(y),Laya.Tween.to(y,{height:66},100),n++})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}onLateUpdate(){}}class mt extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.state=L.READY,this._norV3=null,this.speed=.2}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner;this.state=L.START,this.selfCol=this.owner.getComponent(B),this.ins.playerCols.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class bt extends x{constructor(){super(),this.ins=K.instance,this.wing6BPre=null,this.wing6BPre=this.getRes(u.battle.PlayerWing6b)}onEnable(){const t=this.owner,e=c.skills[T.ShieldWing],s=e.speed||5,i=e.fspeed||.2;Laya.timer.loop(1e3*s,this,()=>{if(this.ins.gameState!=L.START)return;const e=this.open(u.battle.PlayerWing6b,this.wing6BPre),s=e.getComponent(mt);s.norV3=this.getVec3(0,-1),s.speed=i,e.pos(t.x,t.y),this.ins.player2Node.addChild(e)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}onLateUpdate(){}}class kt extends x{constructor(){super(),this.ins=null,this.plaBul1Pre=null,this.plaBulPre=null,this.skill1Pre=null,this.skill2Pre=null,this.skill3Pre=null,this.skill4Pre=null,this.skill5Pre=null,this.skill6Pre=null,this.skill7Pre=null,this.skill8Pre=null,this.skill9Pre=null,this.skill10Pre=null,this.plaWing1Pre=null,this.plaWing2Pre=null,this.plaWing3Pre=null,this.plaWing4Pre=null,this.plaWing5Pre=null,this.plaWing6Pre=null,this.plaRob1Pre=null,this.plaRob2Pre=null,this.plaRob3Pre=null,this.plaBul1Pre=this.getRes(u.battle.Player1Bullet),this.plaBulPre=this.getRes(u.battle.PlayerLaser),this.skill1Pre=this.getRes(u.battle.PlayerSkill1),this.skill2Pre=this.getRes(u.battle.PlayerSkill2),this.skill3Pre=this.getRes(u.battle.PlayerSkill3),this.skill4Pre=this.getRes(u.battle.PlayerSkill4),this.skill5Pre=this.getRes(u.battle.PlayerSkill5),this.skill6Pre=this.getRes(u.battle.PlayerSkill6),this.skill7Pre=this.getRes(u.battle.PlayerSkill7),this.skill8Pre=this.getRes(u.battle.PlayerSkill8),this.skill9Pre=this.getRes(u.battle.PlayerSkill9),this.skill10Pre=this.getRes(u.battle.PlayerSkill10),this.plaWing1Pre=this.getRes(u.battle.PlayerWing1),this.plaWing2Pre=this.getRes(u.battle.PlayerWing2),this.plaWing3Pre=this.getRes(u.battle.PlayerWing3),this.plaWing4Pre=this.getRes(u.battle.PlayerWing4),this.plaWing5Pre=this.getRes(u.battle.PlayerWing5),this.plaWing6Pre=this.getRes(u.battle.PlayerWing6),this.plaRob1Pre=this.getRes(u.battle.PlayerRobot1),this.plaRob2Pre=this.getRes(u.battle.PlayerRobot2),this.plaRob3Pre=this.getRes(u.battle.PlayerRobot3)}onEnable(){this.ins=K.instance,C.on(P.PlayerBullet,this,this.playerMainBullet),C.on(P.BaseSkill1,this,this.baseSkill1),C.on(P.BaseSkill1a,this,this.baseSkill1),C.on(P.BaseSkill1b,this,this.baseSkill1),C.on(P.BaseSkill2,this,this.baseSkill2),C.on(P.BaseSkill2a,this,this.baseSkill2),C.on(P.BaseSkill2b,this,this.baseSkill2),C.on(P.BaseSkill3,this,this.baseSkill3),C.on(P.BaseSkill4,this,this.baseSkill4),C.on(P.BaseSkill4a,this,this.baseSkill4),C.on(P.BaseSkill4b,this,this.baseSkill4),C.on(P.BaseSkill5,this,this.baseSkill5),C.on(P.BaseSkill5a,this,this.baseSkill5),C.on(P.BaseSkill5b,this,this.baseSkill5),C.on(P.BaseSkill6,this,this.baseSkill6),C.on(P.BaseSkill6a,this,this.baseSkill6),C.on(P.BaseSkill6b,this,this.baseSkill6),C.on(P.BaseSkill7,this,this.baseSkill7),C.on(P.BaseSkill9,this,this.baseSkill9),C.on(P.BaseSkill11,this,this.baseSkill11),C.on(P.BaseSkill13,this,this.baseSkill13),C.on(P.BaseSkill14,this,this.baseSkill14),C.on(P.BaseSkill15,this,this.baseSkill15),C.on(P.Shield,this,this.shield),C.on(P.TimeShield,this,this.timeShield),C.on(P.DieShot,this,this.dieShot),C.on(P.SuckBlood,this,this.suckBlood),C.on(P.DieBoom,this,this.dieBoom),C.on(P.BulSkill1,this,this.skill),C.on(P.BulSkill2,this,this.skill2),C.on(P.BulSkill3,this,this.skill3),C.on(P.BulSkill4,this,this.skill4),C.on(P.BulSkill5,this,this.skill5),C.on(P.BulSkill6,this,this.skill6),C.on(P.BulSkill7,this,this.skill7),C.on(P.BulSkill8,this,this.skill8),C.on(P.BulSkill9,this,this.skill9),C.on(P.BulSkill10,this,this.skill10),C.on(P.WingSkill1,this,this.wing1),C.on(P.WingSkill2,this,this.wing2),C.on(P.WingSkill3,this,this.wing3),C.on(P.WingSkill4,this,this.wing4),C.on(P.WingSkill5,this,this.wing5),C.on(P.WingSkill6,this,this.wing6),C.on(P.RobSkill1,this,this.robot1),C.on(P.RobSkill2,this,this.robot2),C.on(P.RobSkill3,this,this.robot3),C.on(P.Sup_HP,this,this.supSkill1),C.on(P.Sup_Att,this,this.supSkill2),C.on(P.Sup_HPRec1,this,this.supSkill3),C.on(P.Sup_HPRec2,this,this.supSkill4),C.on(P.Sup_Crit,this,this.supSkill5)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}playerMainBullet(t){switch(t){case 1:this.player1Bullet();break;case 2:this.player2Bullet()}}player1Bullet(){const t=1e3*this.ins.playerData.speed;Laya.timer.clear(this,this.player1BulletCall),Laya.timer.loop(t,this,this.player1BulletCall)}player1BulletCall(){const t=this.ins,e=t.playerV2;if(t.gameState!=L.START)return;const s=t.playerData;let i=1,l=s.mainNum*s.planeData.weapon,a=E[s.id][s.mainNum];l&&(i+=l);for(let l=0;l<i;l++){const n=this.open(u.battle.Player1Bullet,this.plaBul1Pre);n.getChildByName("boom").blendMode=Laya.BlendMode.LIGHTER;let o=n.getComponent(M);o||(o=n.addComponent(M));let h=s.attack*s.planeData.att/i;o.setData(Math.floor(h),s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);let r=n.getComponent(ht);r||(r=n.addComponent(ht)),r.norV3=this.getVec3(0,-1),r.state=L.START,r.tar=null,r.speed=s.fspeed,r.cross=s.cross,s.track&&(r.cross=!1,r.tar=t.getMinEnemy(e)),n.pos(e.x+a[l],e.y),this.ins.player2Node.addChild(n)}}player2Bullet(){const t=this.ins,e=t.playerData,s=this.open(u.battle.PlayerLaser,this.plaBulPre);let i=s.getComponent(M);i||(i=s.addComponent(M));let l=e.attack*e.planeData.att/(e.mainNum+1)/9;i.setData(Math.floor(l),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),s.pos(360,900),t.playerNode.addChild(s),t.plaLassV2.push(s)}baseSkill1(){const t=K.instance.playerData;let e=c.skills[T.HP1].value+1;t.hp=Math.floor(t.hp*e),t.currHP=Math.floor(t.currHP*e),t.setSkill2(T.HP1),C.event(P.PlayerMaxHP)}supSkill1(){const t=K.instance.playerData;let e=c.skills[T.Sup_HP].value+1;t.hp=Math.floor(t.hp*e),t.currHP=Math.floor(t.currHP*e),C.event(P.PlayerMaxHP)}baseSkill2(){const t=K.instance.playerData;let e=c.skills[T.Attack1].value+1;t.attack*=e,t.attack=Math.floor(t.attack),t.setSkill2(T.Attack1)}supSkill2(){const t=K.instance.playerData;let e=c.skills[T.Sup_Att].value+1;t.attack*=e,t.attack=Math.floor(t.attack)}baseSkill3(){const t=K.instance.playerData;let e=c.skills[T.HPRec1].value||.1,s=Math.floor(t.hp*e);t.currHP+s>t.hp?t.currHP=t.hp:t.currHP+=s,t.setSkill(T.HPRec1),C.event(P.PlayerHP)}supSkill3(){const t=K.instance.playerData;let e=c.skills[T.Sup_HPRec1].value||.1,s=Math.floor(t.hp*e);t.currHP+s>t.hp?t.currHP=t.hp:t.currHP+=s,C.event(P.PlayerHP)}supSkill4(){const t=K.instance.playerData;let e=c.skills[T.Sup_HPRec2].value||.1,s=Math.floor(t.hp*e);t.currHP+s>t.hp?t.currHP=t.hp:t.currHP+=s,C.event(P.PlayerHP)}baseSkill4(){const t=K.instance,e=t.playerData;let s=c.skills[T.Speed].value+1;if(e.speed/=s,e.setSkill2(T.Speed),1==e.id&&this.playerMainBullet(e.id),2==e.id){let s=t.plaLassV2.length,i=t.playerPosV2;for(let e=0;e<t.plaLassV2.length;e++){t.plaLassV2[e].removeSelf()}t.plaLassV2.length=0;let l=E[2][s-1];for(let a=0;a<s;a++){const s=this.open(u.battle.PlayerLaser,this.plaBulPre);let n=s.getComponent(M);n||(n=s.addComponent(M));let o=e.attack*e.planeData.att/(e.mainNum+1)/9;n.setData(Math.floor(o),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),s.getComponent(tt).deltaX=l[a],s.pos(i.x+l[a],i.y),t.playerNode.addChild(s),t.plaLassV2.push(s)}}}baseSkill5(){const t=K.instance.playerData;let e=c.skills[T.Crit].value+1;t.crit*=e,t.critHurt*=e,t.setSkill2(T.Crit)}supSkill5(){const t=K.instance.playerData;let e=c.skills[T.Sup_Crit].value+1;t.crit*=e,t.critHurt*=e}baseSkill6(){const t=K.instance,e=t.playerData;switch(e.mainNum++,e.attack*=1.4,e.attack=Math.floor(e.attack),e.id){case 1:break;case 2:let s=t.plaLassV2.length;if(s>=4)return;let i=t.playerPosV2;for(let e=0;e<t.plaLassV2.length;e++){t.plaLassV2[e].removeSelf()}t.plaLassV2.length=0;let l=E[2][s];for(let a=0;a<s+1;a++){const s=this.open(u.battle.PlayerLaser,this.plaBulPre);let n=s.getComponent(M);n||(n=s.addComponent(M));let o=e.attack*e.planeData.att/(e.mainNum+1)/9;n.setData(Math.floor(o),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),s.getComponent(tt).deltaX=l[a],s.pos(i.x+l[a],i.y),t.playerNode.addChild(s),t.plaLassV2.push(s)}}e.setSkill2(T.MainStr)}baseSkill7(){const t=K.instance,e=t.playerData;switch(t.playerData.id){case 1:t.playerData.cross=!0;break;case 2:t.playerData.laserSta||(t.playerData.laserSta=1,C.event(P.LaserCross))}e.setSkill(T.MainCross)}baseSkill9(){const t=K.instance,e=t.playerData;switch(t.playerData.id){case 1:t.playerData.track=!0;break;case 2:2!=t.playerData.laserSta&&(t.playerData.laserSta=2,C.event(P.LaserTrack))}e.setSkill(T.MainTrack)}shield(){const t=this.ins.playerV2,e=[this.getVec3(1,0),this.getVec3(-1,0)],s=this.getRes(u.battle.PlayerShield),i=c.skills[T.Shield];Laya.timer.once(1e3*i.speed,this,()=>{for(let l=0;l<2;l++){const a=this.open(u.battle.PlayerShield,s),n=a.getComponent(st);n.norV3=e[l].clone(),n.angle=l*Math.PI,n.speed=i.fspeed,a.rotation=-180-n.angle/Math.PI*180,a.pos(t.x+100*e[l].x,t.y+100*e[l].y),this.ins.playerNode.addChild(a)}}),this.ins.playerData.setSkill(T.Shield)}timeShield(){const t=this.getRes(u.battle.PlayerTimeShield),e=this.open(u.battle.PlayerTimeShield,t);let s=this.ins.playerV2;e.pos(s.x,s.y),this.ins.playerNode.addChild(e),this.ins.playerData.setSkill(T.TimeShield)}dieShot(){K.instance.playerData.setSkill(T.DieShot)}baseSkill11(){K.instance.playerData.setSkill(T.Back)}baseSkill13(){const t=K.instance,e=t.playerData;c.skills[T.Anger].value;let s=e.hp/e.currHP;s>1.5&&(s=1.5),e.attack*=s,e.attack=Math.floor(e.attack),t.playerData.setSkill(T.Anger)}baseSkill14(){K.instance.playerData.setSkill(T.Cri)}baseSkill15(){const t=K.instance.playerData;let e=t.hp/t.currHP;e>1.5&&(e=1.5),t.crit*=e,t.critHurt*=e,t.setSkill(T.Fearless)}suckBlood(){K.instance.playerData.setSkill(T.SuckBlood)}dieBoom(){K.instance.playerData.setSkill(T.DieBoom)}skill(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(.71,-.71),this.getVec3(1,0),this.getVec3(.71,.71),this.getVec3(0,1),this.getVec3(-.71,.71),this.getVec3(-1,0),this.getVec3(-.71,-.71)],i=c.skills[T.SwimShell];Laya.timer.loop(1e3*i.speed,this,()=>{if(this.ins.gameState==L.START)for(let l=0;l<8;l++){const a=this.open(u.battle.PlayerSkill1,this.skill1Pre);let n=a.getComponent(M);n||(n=a.addComponent(M));const o=c.skills[T.SwimShell].value||1;n.setData(Math.floor(e.attack*o),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=a.getComponent(j);h.speed=i.fspeed,h.norV3=s[l].clone(),h.state=L.READY,h.tar=null,a.pos(t.x,t.y),this.ins.player2Node.addChild(a),Laya.Tween.to(a,{x:t.x+150*s[l].x,y:t.y+150*s[l].y},100,null,Laya.Handler.create(this,()=>{const t=this.ins.getMinEnemy(a);h.tar=t,7==l&&Laya.timer.once(1e3,this,()=>{C.event(P.BulSkill1_Start)})}))}}),this.ins.playerData.setSkill(T.SwimShell)}skill2(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(.17,-.98),this.getVec3(.34,-.94),this.getVec3(.5,-.87),this.getVec3(-.17,-.98),this.getVec3(-.34,-.94),this.getVec3(-.5,-.87)],i=c.skills[T.ShockWave];Laya.timer.loop(1e3*i.speed,this,()=>{if(this.ins.gameState==L.START)for(let l=0;l<7;l++){const a=this.open(u.battle.PlayerSkill2,this.skill2Pre);let n=a.getComponent(M);n||(n=a.addComponent(M));const o=c.skills[T.ShockWave].value||1;n.setData(Math.floor(e.attack*o),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=a.getComponent(it);h.speed=i.fspeed,h.norV3=s[l].clone(),a.pos(t.x+200*s[l].x,t.y+200*s[l].y),this.ins.player2Node.addChild(a)}}),this.ins.playerData.setSkill(T.ShockWave)}skill3(){const t=this.ins.playerData,e=this.open(u.battle.PlayerSkill3,this.skill3Pre);let s=e.getComponent(M);s||(s=e.addComponent(M));const i=c.skills[T.Laser].value||1;s.setData(t.attack*i,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr);let l=this.ins.playerV2;e.pos(l.x,l.y),this.ins.playerNode.addChild(e),this.ins.playerData.setSkill(T.Laser)}skill4(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(.05,-1),this.getVec3(.16,-.99),this.getVec3(.26,-.97),this.getVec3(-.05,-1),this.getVec3(-.16,-.99),this.getVec3(-.26,-.97)],i=c.skills[T.Shotgun];Laya.timer.loop(1e3*i.speed,this,()=>{this.ins.gameState==L.START&&this.schedule(200,()=>{for(let l=0;l<6;l++){const a=this.open(u.battle.PlayerSkill4,this.skill4Pre);let n=a.getComponent(M);n||(n=a.addComponent(M));const o=c.skills[T.Shotgun].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=a.getComponent(lt);h.speed=i.fspeed,h.norV3=s[l].clone(),a.pos(t.x+0*s[l].x,t.y+0*s[l].y),this.ins.player2Node.addChild(a)}},this,3)}),this.ins.playerData.setSkill(T.Shotgun)}skill5(){const t=this.ins.playerV2,e=this.ins.playerData,s=c.skills[T.RainbowMissile];Laya.timer.loop(1e3*s.speed,this,()=>{if(this.ins.gameState!=L.START)return;let i=Math.floor(2*Math.random()+3),l=[];l.push(Math.floor(26*Math.random()+20)/180*Math.PI),l.push(Math.floor(91*Math.random()+45)/180*Math.PI),4==i&&l.push(Math.floor(91*Math.random()+45)/180*Math.PI),l.push(Math.floor(26*Math.random()+135)/180*Math.PI);let a=0;this.schedule(200,()=>{const i=this.open(u.battle.PlayerSkill5,this.skill5Pre);let n=i.getComponent(M);n||(n=i.addComponent(M));const o=c.skills[T.RainbowMissile].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=i.getComponent(at);i.pos(t.x,t.y),h.speed=s.fspeed,h.pangle=l[a],h.tar=null,this.ins.player2Node.addChild(i),Laya.timer.once(500,this,()=>{const t=this.ins.getMinEnemy(i);h.tar=t}),a++},this,i)}),this.ins.playerData.setSkill(T.RainbowMissile)}skill6(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(1,0),this.getVec3(-1,0)],i=c.skills[T.RotatePoison];Laya.timer.once(1e3*i.speed,this,()=>{for(let l=0;l<2;l++){const a=this.open(u.battle.PlayerSkill6,this.skill6Pre);let n=a.getComponent(M);n||(n=a.addComponent(M));const o=c.skills[T.RotatePoison].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=a.getComponent(nt);h.speed=i.fspeed,h.norV3=s[l].clone(),h.angle=l*Math.PI,h.type=V.POISON,a.pos(t.x+200*s[l].x,t.y+200*s[l].y),this.ins.playerNode.addChild(a)}}),this.ins.playerData.setSkill(T.RotatePoison)}skill7(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(-.71,-.71),this.getVec3(.71,-.71)],i=c.skills[T.NaughtyGhost];Laya.timer.loop(1e3*i.speed,this,()=>{if(this.ins.gameState==L.START)for(let l=0;l<3;l++){const a=this.open(u.battle.PlayerSkill7,this.skill7Pre);let n=a.getComponent(M);n||(n=a.addComponent(M));const o=c.skills[T.NaughtyGhost].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=a.getComponent(ot);h.speed=i.fspeed,h.norV3=s[l].clone(),a.pos(t.x,t.y),this.ins.player2Node.addChild(a),Laya.Tween.to(a,{x:t.x+200*s[l].x,y:t.y+200*s[l].y},300,null,Laya.Handler.create(this,()=>{h.norV3.x=-h.norV3.x,2==l&&Laya.timer.once(300,this,()=>{C.event(P.BulSkill7_Start)})}))}}),this.ins.playerData.setSkill(T.NaughtyGhost)}skill8(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(1,0),this.getVec3(-1,0)],i=c.skills[T.RotateFire];Laya.timer.once(1e3*i.speed,this,()=>{for(let l=0;l<2;l++){const a=this.open(u.battle.PlayerSkill8,this.skill8Pre);let n=a.getComponent(M);n||(n=a.addComponent(M));const o=c.skills[T.RotateFire].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=a.getComponent(nt);h.speed=i.fspeed,h.norV3=s[l].clone(),h.angle=l*Math.PI,h.type=V.FIRE,a.pos(t.x+200*s[l].x,t.y+200*s[l].y),this.ins.playerNode.addChild(a)}}),this.ins.playerData.setSkill(T.RotateFire)}skill9(){const t=this.ins.playerData,e=this.open(u.battle.PlayerSkill9,this.skill9Pre);let s=e.getComponent(M);s||(s=e.addComponent(M));const i=c.skills[T.Magnet].value||1;s.setData(t.attack*i,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr);let l=this.ins.playerV2;e.pos(l.x,l.y),this.ins.bgTopNode.addChild(e),this.ins.playerData.setSkill(T.Magnet)}skill10(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(1,0),this.getVec3(-1,0)],i=c.skills[T.RotateIce];Laya.timer.once(1e3*i.speed,this,()=>{for(let l=0;l<2;l++){const a=this.open(u.battle.PlayerSkill10,this.skill10Pre);let n=a.getComponent(M);n||(n=a.addComponent(M));const o=c.skills[T.RotateIce].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=a.getComponent(nt);h.speed=i.fspeed,h.norV3=s[l].clone(),h.angle=l*Math.PI,h.type=V.ICE,a.pos(t.x+200*s[l].x,t.y+200*s[l].y),this.ins.playerNode.addChild(a)}}),this.ins.playerData.setSkill(T.RotateIce)}wing1(){const t=this.ins;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=v[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing1,this.plaWing1Pre),a=l.getComponent(rt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(T.BlastWing)}wing2(){const t=K.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=v[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing2,this.plaWing2Pre),a=l.getComponent(rt),n=l.getComponent(pt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,n.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(T.MissileWing)}wing3(){const t=K.instance;let e=t.plaWingsV2.length;if(e>=6)return;let s=t.playerV2,i=v[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing3,this.plaWing3Pre),a=l.getComponent(rt),n=l.getComponent(ut);a.deltaX=i[e].dx,a.deltaY=i[e].dy,n.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(T.LaserWing)}wing4(){const t=K.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=v[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing4,this.plaWing4Pre),a=l.getComponent(rt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(T.AutoWing)}wing5(){const t=K.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=v[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing5,this.plaWing5Pre),a=l.getComponent(rt),n=l.getComponent(gt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,n.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(T.ShotWing)}wing6(){const t=K.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=v[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing6,this.plaWing6Pre),a=l.getComponent(rt);l.getComponent(bt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(T.ShieldWing)}robot1(){const t=c.skills[T.BlastRobot],e=t.speed||5,s=t.robotsp||.2;Laya.timer.loop(1e3*e,this,()=>{if(this.ins.gameState!=L.START)return;const t=this.open(u.battle.PlayerRobot1,this.plaRob1Pre),e=t.getComponent(et);e.norV3=this.getVec3(0,-1),e.speed=s,t.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(t)}),this.ins.playerData.setSkill(T.BlastRobot)}robot2(){const t=c.skills[T.ShieldRobot],e=t.speed||5,s=t.robotsp||.2;Laya.timer.loop(1e3*e,this,()=>{if(this.ins.gameState!=L.START)return;const t=this.open(u.battle.PlayerRobot2,this.plaRob2Pre),e=t.getComponent(et);e.norV3=this.getVec3(0,-1),e.speed=s,t.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(t)}),this.ins.playerData.setSkill(T.ShieldRobot)}robot3(){const t=c.skills[T.LaserRobot],e=this.ins.playerData,s=t.speed||5,i=t.robotsp||.2;Laya.timer.loop(1e3*s,this,()=>{if(this.ins.gameState!=L.START)return;const s=this.open(u.battle.PlayerRobot3,this.plaRob3Pre);let l=s.getComponent(M);l||(l=s.addComponent(M));const a=t.value||1;l.setData(e.attack*a,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const n=s.getComponent(et);n.norV3=this.getVec3(0,-1),n.speed=i,s.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(s)}),this.ins.playerData.setSkill(T.LaserRobot)}}class ft extends x{constructor(){super(),this.ins=null,this.playerPre=null,this.plaHPPre=null,this.playerMods={},this.playerPre=this.getRes(u.battle.Player),this.plaHPPre=this.getRes(u.battle.PlayerHP);for(const t in k){const e=k[t];this.playerMods[t]=this.getRes(e)}}onEnable(){this.ins=K.instance,this.initPlayerModel()}initPlayerModel(){const t=this.ins,e=t.playerData.id;let s=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,1280),s);const i=Laya.Sprite3D.instantiate(this.playerMods[e]);i.transform.position=s,i.transform.localScale=this.getVec3(2,2,2),t.playerV3=i,t.modSceneV3.addChild(i);const l=this.getRes(g.PlaneTrackModel);l.transform.position=this.getVec3(0,0,.05),i.addChild(l);const a=this.open(u.battle.Player,this.playerPre);a.pos(360,1280),t.playerNode.addChild(a),t.playerV2=a,t.playerCols.push(a.getComponent(B));const n=this.open(u.battle.PlayerHP,this.plaHPPre);n.pos(400,1240),t.effectNode.addChild(n),t.playerHPV2=n,t.modCameraV3.convertScreenCoordToOrthographicCoord(t.playerPosV2,s),t.playerPosV3=s,Laya.Tween.to(a,{y:t.playerPosV2.y},500,Laya.Ease.cubicOut),Laya.Tween.to(n,{y:t.playerPosV2.y-40},500,Laya.Ease.cubicOut),Laya.Tween.to(i.transform,{localPositionZ:s.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{t.gameState=L.START,C.event(P.LevelEnemy),C.event(P.PlayerBullet,e)}));let o=this.getVec3(),h=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,640),o),t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,641),h),t.ratio3D=1/(h.z-o.z)}onDisable(){}}class St extends x{constructor(){super(),this.qhBtn=null,this.gcBtn=null,this.zzBtn=null,this.fypBtn=null,this.cjbBtn=null,this.jgBtn=null,this.sdBtn=null,this.chddBtn=null,this.ddgBtn=null,this.xzdqBtn=null,this.xzhqBtn=null,this.cbdcBtn=null,this.xzbqBtn=null,this.sdljBtn=null,this.ddljBtn=null,this.jgljBtn=null,this.bpljBtn=null,this.hdljBtn=null,this.zzpljBtn=null,this.bpjqrBtn=null,this.hdjqrBtn=null,this.jgjqrBtn=null}onEnable(){this.setClick(this.qhBtn,this.baseSkill6.bind(this),this),this.setClick(this.gcBtn,this.baseSkill7.bind(this),this),this.setClick(this.zzBtn,this.baseSkill9.bind(this),this),this.setClick(this.fypBtn,this.skill1.bind(this),this),this.setClick(this.cjbBtn,this.skill2.bind(this),this),this.setClick(this.jgBtn,this.skill3.bind(this),this),this.setClick(this.sdBtn,this.skill4.bind(this),this),this.setClick(this.chddBtn,this.skill5.bind(this),this),this.setClick(this.xzdqBtn,this.skill6.bind(this),this),this.setClick(this.ddgBtn,this.skill7.bind(this),this),this.setClick(this.xzhqBtn,this.skill8.bind(this),this),this.setClick(this.cbdcBtn,this.skill9.bind(this),this),this.setClick(this.xzbqBtn,this.skill10.bind(this),this),this.setClick(this.sdljBtn,this.wing5.bind(this),this),this.setClick(this.ddljBtn,this.wing2.bind(this),this),this.setClick(this.jgljBtn,this.wing3.bind(this),this),this.setClick(this.bpljBtn,this.wing1.bind(this),this),this.setClick(this.hdljBtn,this.wing6.bind(this),this),this.setClick(this.zzpljBtn,this.wing4.bind(this),this),this.setClick(this.bpjqrBtn,this.robot1.bind(this),this),this.setClick(this.hdjqrBtn,this.robot2.bind(this),this),this.setClick(this.jgjqrBtn,this.robot3.bind(this),this)}baseSkill6(){C.event(P.BaseSkill6),C.event(P.DieBoom),C.event(P.DieShot),C.event(P.TimeShield),C.event(P.Shield)}baseSkill7(){C.event(P.BaseSkill7)}baseSkill9(){C.event(P.BaseSkill9)}skill1(){C.event(P.BulSkill1)}skill2(){C.event(P.BulSkill2)}skill3(){C.event(P.BulSkill3)}skill4(){C.event(P.BulSkill4)}skill5(){C.event(P.BulSkill5)}skill6(){C.event(P.BulSkill6)}skill7(){C.event(P.BulSkill7)}skill8(){C.event(P.BulSkill8)}skill9(){C.event(P.BulSkill9)}skill10(){C.event(P.BulSkill10)}wing1(){C.event(P.WingSkill1)}wing2(){C.event(P.WingSkill2)}wing3(){C.event(P.WingSkill3)}wing4(){C.event(P.WingSkill4)}wing5(){C.event(P.WingSkill5)}wing6(){C.event(P.WingSkill6)}robot1(){C.event(P.RobSkill1)}robot2(){C.event(P.RobSkill2)}robot3(){C.event(P.RobSkill3)}onDisable(){}}var Ct,xt=Laya.Scene,Lt=Laya.ClassUtils.regClass;!function(t){class e extends xt{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("BattleScene")}}t.BattleSceneUI=e,Lt("ui.BattleSceneUI",e);class s extends xt{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("LobbyScene")}}t.LobbySceneUI=s,Lt("ui.LobbySceneUI",s)}(Ct||(Ct={}));class Vt extends Ct.LobbySceneUI{constructor(){super(),Vt.instance=this}onEnable(){}onDisable(){}}Vt.instance=null;class Pt extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}}class wt extends Laya.Script{constructor(){super(),this.interactable=!0,this.isChecked=!0,this.checkMark=null,this.clickHandle=null,this.cantHandle=null}onClick(){if(this.interactable){if(this.isChecked=!this.isChecked,this.checkMark&&(this.checkMark.visible=this.isChecked),this.clickHandle&&this.clickHandle(this.isChecked),this.owner&&this.owner.parent&&this.owner.parent.getComponent(Pt)){let t=this.owner.parent.numChildren,e=this.owner.parent.getChildIndex(this.owner);for(let s=0;s<t;s++){const t=this.owner.parent.getChildAt(s).getComponent(wt);if(!t)return;s==e?t.isChecked||(t.isChecked=!0):t.isChecked=!1,t.checkMark&&(t.checkMark.visible=t.isChecked)}}}else this.cantHandle&&this.cantHandle()}onEnable(){this.checkMark&&(this.checkMark.visible=this.isChecked)}onDisable(){}}class Tt extends x{constructor(){super(),this.startBtn=null,this.chaHorSel=null,this.midNode=null,this.tabIndex=0}onEnable(){let t=!1;this.setClick(this.startBtn,()=>{t||(t=!0,this.loadBatPre().then(()=>{Laya.Scene.open("BattleScene.scene")}))},this),C.on(Rt.OpenPage,this,this.onOpen)}onDisable(){C.offAllCaller(this)}onOpen(t){const e=this.owner;t==this.tabIndex?(e.visible=!0,this.midNode.x=-360,Laya.Tween.to(this.midNode,{x:360},300)):e.visible=!1}loadBatPre(){const t=[],e=u.battle;for(const s in e){const i=e[s];t.push(i)}const s=[];for(const t in g){const e=g[t];this.getRes(e)||s.push(e)}return new Promise((e,i)=>{let l=0,a=0;s.length&&a++,t.length&&a++,Laya.loader.create(s,Laya.Handler.create(this,()=>{console.log("load model complete..."),++l==a&&e()}),Laya.Handler.create(this,t=>{})),Laya.loader.create(t,Laya.Handler.create(this,()=>{console.log("load prefab complete..."),++l==a&&e()}),Laya.Handler.create(this,t=>{}),Laya.Loader.PREFAB)})}onDestroy(){}}class Et extends Laya.Image{constructor(){super(),this.size(203,143)}onEnable(){}onDisable(){}}const vt={1:"lobby/planes/Plane1.png",2:"lobby/planes/Plane2.png",3:"lobby/planes/Plane3.png"};class Dt extends x{constructor(){super(),this.newNode=null,this.planeSpr=null,this.selNode=null,this.lockNode=null,this.pid=0,this.cid=1}onEnable(){this.setClick(this.owner,()=>{this.pid!=this.cid&&C.event(Rt.HangarItemSel,this.pid)},this,null,!0),C.on(Rt.HangarItemSel,this,t=>{this.selNode.visible=t==this.pid,this.cid=t})}setData(t,e){this.pid=t,this.cid=e,this.newNode.visible=!1,this.planeSpr.skin=vt[t],this.selNode.visible=t==e;const s=p.planes.indexOf(t);this.lockNode.visible=s<0}onDisable(){C.offAllCaller(this)}}class Bt extends x{constructor(){super(),this.levLab=null,this.powLab=null,this.plaNameLab=null,this.propNode=null,this.attLab=null,this.hpLab=null,this.upLevelBtn=null,this.goldLab=null,this.chooseBtn=null,this.planeSpr=null,this.planeList=null,this.tabIndex=0,this.selid=0}onEnable(){let t=a.id;this.selid=t,this.setPlane(t),C.on(Rt.OpenPage,this,this.onOpen);const e=[1,2,3];this.planeList.itemRender=Et,this.planeList.vScrollBarSkin="",this.planeList.renderHandler=Laya.Handler.create(this,(s,i)=>{const l=s.getChildAt(0);if(l){l.getComponent(Dt).setData(e[i],t)}else this.loadPrefab(u.lobby.HangarPlaneItem).then(l=>{const a=this.open(u.lobby.HangarPlaneItem,l);s.addChild(a),a.getComponent(Dt).setData(e[i],t)})},null,!1),this.planeList.array=e,C.on(Rt.HangarItemSel,this,t=>{this.selid=t,this.setPlane(t)}),this.setClick(this.upLevelBtn,()=>{if(p.level++,this.setPlane(this.selid),t==this.selid){const e=y.getAttHp(p.level,t);a.setAttHp(e.att,e.hp)}},this),this.setClick(this.chooseBtn,()=>{const t=y.getAttHp(p.level,this.selid);a.setAttHp(t.att,t.hp),a.id=this.selid,this.setPlane(this.selid)},this)}onDisable(){C.offAllCaller(this)}setPlane(t){const e=d.planes[t],s=d.planesUI[t],i=a.id,l=p.planes.indexOf(t);if(l<0)this.plaNameLab.text="???",this.powLab.text="???",this.attLab.text="???",this.hpLab.text="???",this.levLab.text="LV.???";else{this.plaNameLab.text=e.name,this.powLab.text="19.05M";let s=p.level||1;const i=y.getAttHp(s,t);this.attLab.text=i.att+"",this.hpLab.text=i.hp+"",this.goldLab.text=y.getGold(s)+"",this.levLab.text=`LV.${s}`}this.upLevelBtn.visible=l>-1,this.chooseBtn.visible=l>-1&&i!=t;let n=this.propNode.numChildren;for(let t=0;t<n;t++){const e=this.propNode.getChildAt(t),i=e.getChildAt(2);let l=s[t]/10,a=27+203*l;Laya.Tween.to(e,{value:l},200),Laya.Tween.to(i,{x:a},200)}C.event(Rt.HangarPage,[t,this.planeSpr])}onOpen(t){const e=this.owner;t==this.tabIndex?e.visible=!0:e.visible=!1}onDestroy(){}}var Rt;!function(t){t.OpenPage="lobby.openpage",t.HangarPage="lobby.hangar",t.HangarItemSel="lobby.hangar.item.sel"}(Rt||(Rt={}));class _t extends x{constructor(){super(),this.ins=null,this.scene3D=null,this.camera=null,this.battlePage=null,this.batTog=null,this.hangarPage=null,this.hanTog=null,this.planes3D={};const t=Laya.stage.addChild(new Laya.Scene3D);t.zOrder=-1,this.scene3D=t;const e=t.addChild(new Laya.Camera(0,.1,1e3));e.clearFlag=Laya.CameraClearFlags.DepthOnly,e.clearColor=new Laya.Vector4(0,0,0,0),e.transform.translate(this.getVec3(-1.8,2,2)),e.transform.rotate(new Laya.Vector3(-45,-45,0),!1,!1),this.camera=e,e.renderTarget=new Laya.RenderTexture(720,600,Laya.RenderTextureFormat.R16G16B16A16,Laya.RenderTextureDepthFormat.DEPTH_16),e.renderingOrder=-1,e.clearFlag=Laya.CameraClearFlags.SolidColor,e.clearColor=this.getVec4(0,0,0,0);const s=t.addChild(new Laya.DirectionLight);s.color=new Laya.Vector3(1,1,1),s.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0))}onEnable(){this.clearBattlePool(),this.ins=Vt.instance,console.log("stage -> ",Laya.stage);const t=this.ins;this.loadPrefab(u.lobby.BattlePage).then(e=>{const s=this.open(u.lobby.BattlePage,e);t.content.addChild(s),this.battlePage=s.getComponent(Tt),this.battlePage.tabIndex=3}),this.loadPrefab(u.lobby.HangarPage).then(e=>{const s=this.open(u.lobby.HangarPage,e);s.visible=!1,t.content.addChild(s),this.hangarPage=s.getComponent(Bt),this.hangarPage.tabIndex=2}),this.batTog=t.batTog.getComponent(wt),this.batTog.clickHandle=(()=>{this.battlePage&&(C.event(Rt.OpenPage,this.battlePage.tabIndex),this.clickAnim())}),this.hanTog=t.hanTog.getComponent(wt),this.hanTog.clickHandle=(()=>{this.hangarPage&&(C.event(Rt.OpenPage,this.hangarPage.tabIndex),this.clickAnim())}),C.on(Rt.HangarPage,this,this.onHangarPage)}onDisable(){this.scene3D.destroy(!0),Laya.timer.clearAll(this),C.offAllCaller(this)}clickAnim(){const t=this.ins;t.bottom.y=1178+t.bottom.height,Laya.Tween.to(t.bottom,{y:1178},500,Laya.Ease.quadInOut),t.top.y=0-t.top.height,Laya.Tween.to(t.top,{y:0},500,Laya.Ease.quadInOut)}clearBattlePool(){for(let t=0;t<w.length;t++){const e=w[t];Laya.Pool.clearBySign(e)}w.length=0}onHangarPage(t,e){const s=this.planes3D;for(const t in s){s[t].active=!1}const i=s[t];if(e.graphics.clear(),i){i.active=!0;let t=new Laya.Texture(this.camera.renderTarget,Laya.Texture.DEF_UV);e.graphics.drawTexture(t)}else this.loadRes(g["PlaneModel"+t]).then(i=>{const l=Laya.Sprite3D.instantiate(i);l.transform.localScale=new Laya.Vector3(3.5,3.5,3.5),this.scene3D.addChild(l),Laya.timer.frameLoop(1,this,()=>{l.transform.rotate(this.getVec3(0,.005,0))}),s[t]=l;let a=new Laya.Texture(this.camera.renderTarget,Laya.Texture.DEF_UV);e.graphics.drawTexture(a)})}}class At extends x{constructor(){super()}onEnable(){const t=this.owner,e=t.getChildAt(0),s=t.getChildAt(1),i=Laya.LocalStorage.getItem("test_rate");i&&(e.text=i);const l=Laya.LocalStorage.getItem("test_chap");l&&(s.text=l);(t=>{const e=t.getChildAt(0),s=Laya.LocalStorage.getItem("test_php");s&&(e.text=s)})(t.getChildAt(3));(t=>{const e=t.getChildAt(0),s=t.getChildAt(1),i=t.getChildAt(2),l=t.getChildAt(3),a=Laya.LocalStorage.getItem("test_eid");a&&(e.text=a);const n=Laya.LocalStorage.getItem("test_ehp");n&&(s.text=n);const o=Laya.LocalStorage.getItem("test_eat");o&&(i.text=o);const h=Laya.LocalStorage.getItem("test_esp");h&&(l.text=h)})(t.getChildAt(2))}onDisable(){}}class Ht extends Laya.Script{constructor(){super(),this.speed=.1,this.bg1=null,this.bg2=null}onEnable(){}onDisable(){}onUpdate(){let t=Laya.timer.delta;if(this.bg1&&this.bg2){this.bg1.y>=1920&&(this.bg1.y=this.bg1.y-1920-640),this.bg2.y>=1920&&(this.bg2.y=this.bg2.y-1920-640);let e=t*this.speed;this.bg1.y+=e,this.bg2.y+=e}}}class Mt extends Laya.Image{constructor(){super(),this.size(128,150),this.loadPrefab(u.battleUI.PlayerSkillItem).then(t=>{const e=Laya.Pool.getItemByCreateFun(u.battleUI.PlayerSkillItem,t.create,t);this.addChild(e)})}onEnable(){}onDisable(){}loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)})}}class Nt extends x{constructor(){super(),this.ins=K.instance,this.sucNode=null,this.failNode=null,this.levelLab=null,this.rewList=null,this.unLockNode=null,this.lockList=null,this.closeBtn=null,this.rewBtn=null}onEnable(){this.setClick(this.closeBtn,this.onCloseClick,this);const t=this.ins.playerData;let e=!!t.currHP;this.sucNode.visible=e,this.rewBtn.visible=e,this.unLockNode.visible=e,this.failNode.visible=!e,this.levelLab.text=t.level+" ";if(e){const e=h.comChapters[t.chapter-1].unlockskill;this.lockList.itemRender=Mt,this.lockList.hScrollBarSkin="",this.lockList.renderHandler=Laya.Handler.create(this,(t,s)=>{const i=t.getChildAt(0);if(!i)return;const l=i.getChildByName("desc"),a=(i.getChildByName("icon"),e[s]),n=c.skills[a];n&&(l.text=n.nameCN)},null,!1),this.lockList.array=e}else this.closeBtn.x=360}onCloseClick(){this.owner.removeSelf(),Laya.Scene.open("LobbyScene.scene")}onDisable(){}}class jt extends x{constructor(){super(),this.ins=K.instance,this.closeBtn=null,this.returnBtn=null,this.contBtn=null,this.currAtt=null,this.currHp=null,this.skills=null}onEnable(){this.setClick(this.closeBtn,this.onCloseClick,this),this.setClick(this.contBtn,this.onCloseClick,this),this.setClick(this.returnBtn,this.onReturnClick,this);const t=this.ins.playerData;this.currAtt.text=t.attack+" ",this.currHp.text=t.currHP+" ";const e=[];for(const s in t.skills)e.push(parseInt(s));this.skills.itemRender=Mt,this.skills.vScrollBarSkin="",this.skills.renderHandler=Laya.Handler.create(this,(t,s)=>{const i=t.getChildAt(0);if(!i)return;const l=i.getChildByName("desc"),a=(i.getChildByName("icon"),e[s]),n=c.skills[a];n&&(l.text=n.nameCN)},null,!1),this.skills.array=e}onCloseClick(){Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{this.ins.gameState==L.PAUSE&&(this.ins.gameState=L.START),this.owner.removeSelf()}))}onReturnClick(){Laya.Scene.open("LobbyScene.scene")}onDisable(){}}class It extends x{constructor(){super(),this.lighter1=null,this.lighter2=null}onEnable(){for(let t=1;t<3;t++){const e=this["lighter"+t];e&&(e.blendMode=Laya.BlendMode.LIGHTER)}}onDisable(){}}class Wt extends x{constructor(){super()}onEnable(){const t=this.owner;t.alpha=1,Laya.timer.once(300,this,()=>{Laya.Tween.to(t,{alpha:0},100,null,Laya.Handler.create(this,()=>{this.owner.removeSelf()}))})}onDisable(){Laya.timer.clearAll(this),this.recover(this.owner)}}class Ut extends x{constructor(){super(),this.ins=K.instance,this.skin=null}onEnable(){}onUpdate(){this.ins.gameState==L.START&&this.skin&&(this.skin.rotation+=5)}}class Ot extends x{constructor(){super(),this.ins=K.instance,this.enemyCom=null,this.eskillCom=null,this.skePath="",this.skeCon=null,this.templet=null,this.ske=null}onEnable(){if(this.enemyCom=this.owner.getComponent(Y),this.eskillCom=this.owner.getComponent(O),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata,e=new Laya.Templet;this.templet=e,e.on(Laya.Event.COMPLETE,this,this.parseComplete),e.loadAni(m[this.skePath]),C.on(P.EnemyHit,this,(e,s,i)=>{s==this.enemyCom.eid&&e==t.type&&this.ske&&this.ske.play(0,!1)})}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop(),this.ske.removeSelf()),this.templet&&(this.templet.offAllCaller(this),this.templet.destroy())}parseComplete(){this.ske=this.templet.buildArmature(0);const t=this.ske,e=D[this.skePath];t.pos(e.self.x,e.self.y),t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t.play(1,!0),this.skeCon.addChild(t)}completeHandler(){this.ske.play(1,!0)}onEvent(t){this.ins.gameState,L.START}onUpdate(){}}class qt extends x{constructor(){super(),this.ins=K.instance,this.enemyCom=null,this.currSkill=null,this.eskillCom=null,this.skeCon=null,this.templet=null,this.ske=null,this.skill2001Pre=null,this.currAtt=0,this.skill2001Pre=this.getRes(u.battle.EnemySkill2001)}onEnable(){if(this.enemyCom=this.owner.getComponent(Y),this.eskillCom=this.owner.getComponent(O),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata,e=new Laya.Templet;this.templet=e,e.on(Laya.Event.COMPLETE,this,this.parseComplete),e.loadAni(m[2001]);const s=t.att.split("|");C.on(P.EnemyHit,this,(e,i,l)=>{if(i==this.enemyCom.eid&&e==t.type){if(this.ske){let t=0;1001==l&&(t=1),1002==l&&(t=0),1003==l&&(t=2),this.ske.play(t,!1)}this.currSkill=l,this.currAtt=parseInt(s[l-1001])}})}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop(),this.ske.removeSelf()),this.templet&&(this.templet.offAllCaller(this),this.templet.destroy())}parseComplete(){this.ske=this.templet.buildArmature(0);const t=this.ske,e=D[2001];t.pos(e.self.x,e.self.y),t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t.play(3,!0),this.skeCon.addChild(t)}completeHandler(){this.ske.play(3,!0)}onEvent(t){this.ins.gameState==L.START&&("b2"==t.stringValue?this.skill1001():"b1"==t.stringValue?this.skill1002():"b3"==t.stringValue&&this.skill1003())}skill1001(){const t=this.owner,e=(this.enemyCom.edata,[-30,-20,-10,0,10,20,30]),s=D[2001].b1,i=i=>{for(let l=0;l<e.length;l++){const a=this.open(u.battle.EnemySkill1,this.eskillCom.skill1Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(this.currAtt,0,0,0,0);const o=a.getComponent(W);o.norV3=this.getVec3(0,1),o.state=L.START,a.pos(t.x+s[i].x+e[l],t.y+s[i].y),this.ins.eneBulNode.addChild(a)}};for(let t=0;t<2;t++)i(t),this.schedule(100,()=>{i(t)},this,3)}skill1002(){const t=this.owner,e=(this.enemyCom.edata,D[2001].b2),s=[this.getVec3(-.34,.94),this.getVec3(-.17,.98),this.getVec3(0,1),this.getVec3(.17,.98),this.getVec3(.34,.94)],i=i=>{for(let l=0;l<s.length;l++)for(let l=0;l<s.length;l++){const a=this.open(u.battle.EnemySkill2001,this.skill2001Pre);let n=a.getComponent(M);n||(n=a.addComponent(M)),n.setData(this.currAtt,0,0,0,0);const o=a.getComponent(W);o.norV3=s[l].clone(),o.state=L.START,a.pos(t.x+e[i].x,t.y+e[i].y),this.ins.eneBulNode.addChild(a)}};for(let t=0;t<2;t++)i(t),this.schedule(100,()=>{i(t)},this,5)}skill1003(){const t=this.owner,e=(this.enemyCom.edata,[-60,-30,0,30,60]),s=[-10,-5,0,-5,-10],i=D[2001].b3,l=l=>{for(let a=0;a<e.length;a++){const n=this.open(u.battle.EnemySkill2001,this.skill2001Pre);let o=n.getComponent(M);o||(o=n.addComponent(M)),o.setData(this.currAtt,0,0,0,0);const h=n.getComponent(W);h.norV3=this.getVec3(0,1),h.state=L.START,n.pos(t.x+i[l].x+e[a],t.y+i[l].y+s[a]),this.ins.eneBulNode.addChild(n)}};for(let t=0;t<2;t++)l(t),this.schedule(100,()=>{l(t)},this,5)}onUpdate(){}}class Yt extends x{constructor(){super()}onEnable(){const t=this.owner;let e=Math.floor(151*Math.random()+50);t.color=e>=1e3?"#ff0300":"#ffffff",t.scale(0,0);let s=Math.floor(6*Math.random()+15),i=Math.floor(16*Math.random()+45),l=Math.floor(6*Math.random()+5),a=Math.floor(6*Math.random()+5);Laya.Tween.to(t,{x:t.x+s,y:t.y-i,scaleX:1,scaleY:1},300,Laya.Ease.quintOut,Laya.Handler.create(this,()=>{Laya.timer.once(100,this,()=>{Laya.Tween.to(t,{x:t.x-l,y:t.y-a,scaleX:0,scaleY:0},100,null,Laya.Handler.create(this,()=>{t.removeSelf()}))})}))}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this),this.recover(this.owner)}onUpdate(){}}class Xt extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this.timer=0}onEnable(){this.timer=0,this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280}))}onDisable(){C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){this.ins.gameState==L.START&&(this.quadTree.check(this.ins.playerCols,this.selfCol),this.timer+=Laya.timer.delta,this.timer>=2e3&&this.owner.removeSelf())}}class zt extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null}onEnable(){this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280}))}onCollisionEnter(t,e){const s=t.owner;if(!s||!s.parent)return;const i=s.getComponent(M);if(!i||!i.data)return;const l=this.ins.playerData;l.currHP-=i.data.attack,C.event(P.PlayerHP),l.currHP<=0&&(this.makeBoom(1004),C.event(P.GameOver))}onCollisionExit(t,e){}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}makeBoom(t){const e=this.getRes(u.battle.EnemyBoom),s=this.open(u.battle.EnemyBoom,e);s.__$type$__=t;const i=this.owner;s.x=i.x,s.y=i.y,this.ins.effectNode.addChild(s)}onLateUpdate(){this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class Gt extends x{constructor(){super(),this.ins=K.instance,this.line=null,this.bgBar=null,this.bar=null,this.hpLab=null,this.baseWidth=12,this.currBarWidth=60,this.currBaseNum=5}onEnable(){const t=this.ins.playerData;let e=this.currBaseNum*this.baseWidth;this.bgBar.width=e,this.currBarWidth=e,C.on(P.PlayerHP,this,()=>{let s=t.currHP/t.hp*e;this.currBarWidth=s,this.hpLab.text=Math.round(t.currHP/t.hp*100)+"%"}),C.on(P.PlayerMaxHP,this,()=>{this.currBaseNum++,e=this.currBaseNum*this.baseWidth,this.bgBar.width=e;let s=t.currHP/t.hp*e;this.currBarWidth=s,this.hpLab.text=Math.round(t.currHP/t.hp*100)+"%"})}onDisable(){C.offAllCaller(this)}onLateUpdate(){const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),i=this.getVec3(this.ins.playerPosV2.x+40,this.ins.playerPosV2.y-40),l=this.getVec3();Laya.Vector3.lerp(s,i,8*e,l),t.pos(l.x,l.y);let a=this.ins.playerV2,n=l.x-a.x,o=l.y-a.y;this.line.height=Math.sqrt(n*n+o*o),this.line.rotation=Math.atan2(n,-o)/Math.PI*180;let h=this.getVec3();Laya.Vector3.lerp(this.getVec3(this.bar.width),this.getVec3(this.currBarWidth),.01*Laya.timer.delta,h),this.bar.width=h.x}}class Ft extends x{constructor(){super(),this.ins=K.instance,this.robot1BPre=null,this.robot1BPre=this.getRes(u.battle.PlayerRobot1b)}onEnable(){const t=this.owner,e=[this.getVec3(.87,-.5),this.getVec3(.98,-.17),this.getVec3(.98,.17),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-.98,-.17),this.getVec3(-.98,.17),this.getVec3(-.87,.5)],s=this.ins.playerData,i=c.skills[T.BlastRobot],l=i.robotbullet||5,a=i.fspeed||.2;Laya.timer.loop(1e3*l,this,()=>{if(this.ins.gameState==L.START)for(let l=0;l<8;l++){const n=this.open(u.battle.PlayerRobot1b,this.robot1BPre);let o=n.getComponent(M);o||(o=n.addComponent(M));const h=i.value||1;o.setData(s.attack*h,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);let r=n.getComponent(lt);r||(r=n.addComponent(lt)),r.speed=a,r.delta=294,r.norV3=e[l].clone(),n.pos(t.x,t.y),this.ins.player2Node.addChild(n);const c=n.getChildByName("bi");c.height=0,Laya.Tween.clearAll(c),Laya.Tween.to(c,{height:294},300)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){}}class Qt extends x{constructor(){super(),this.ins=K.instance,this.robot2BPre=null,this.robot2BPre=this.getRes(u.battle.PlayerWing6b)}onEnable(){const t=this.owner,e=[this.getVec3(.87,-.5),this.getVec3(1,0),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-1,0),this.getVec3(-.87,.5)],s=c.skills[T.ShieldRobot],i=s.robotbullet||5,l=s.fspeed||.2;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState==L.START)for(let s=0;s<6;s++){const i=this.open(u.battle.PlayerWing6b,this.robot2BPre),a=i.getComponent(mt);a.speed=l,a.norV3=e[s].clone(),i.pos(t.x,t.y),this.ins.player2Node.addChild(i)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){}}class $t extends x{constructor(){super(),this.ins=K.instance,this.left=null,this.right=null,this.vec=0,this.tar=null,this.im=null,this.point=null}onEnable(){const t=this.owner,e=c.skills[T.LaserRobot],s=e.robotbullet||5;e.fspeed;this.left.alpha=0,this.right.alpha=0;const i=[this.right,this.left],l=this.ins;Laya.timer.loop(1e3*s,this,()=>{if(l.gameState!=L.START)return;const e=i[this.vec],s=e.getChildByName("point");if(e){let l=this.ins.getMinEnemy(t),a=this.vec?90:-90,n=730;if(l&&l.parent){let s=t.x+(e.x-25)-l.x,i=t.y-l.y;n=Math.sqrt(s*s+i*i),a=Math.atan2(s,-i)/Math.PI*180;const o=l.getComponent(X);o.onCollisionEnter(this,o,!0)}e.height=n,e.rotation=a,s.y=n/730*713,Laya.Tween.to(e,{alpha:1},100,null,Laya.Handler.create(this,()=>{if(l&&l.parent){const t=l.getComponent(X);t.onCollisionEnter(this,t,!0)}})),Laya.timer.once(200,this,()=>{Laya.Tween.to(e,{alpha:0},100)}),this.tar=l,this.im=e,this.point=s,this.vec++,this.vec>=i.length&&(this.vec=0)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){if(this.ins.gameState==L.START&&this.im&&this.point){const t=this.owner;let e=1500,s=this.vec?90:-90,i=this.tar;if(i&&i.parent){let l=t.x+(this.im.x-25)-i.x,a=t.y-i.y;e=Math.sqrt(l*l+a*a),s=Math.atan2(l,-a)/Math.PI*180}this.im.height=e,this.im.rotation=s,this.point.y=e/730*713}}}class Zt extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this.boomSke=null}onEnable(){const t=this.owner;this.ins;this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.boomSke&&(this.boomSke.blendMode=Laya.BlendMode.LIGHTER),Laya.timer.once(265,this,()=>{this.quadTree.check(this.ins.enemyCols,this.selfCol),t.removeSelf()})}onDisable(){this.selfCol.bids=[],C.event(P.LaserHide,this.selfCol),C.offAllCaller(this),Laya.timer.clearAll(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){}}class Jt extends x{constructor(){super(),this.laser=null,this.ins=K.instance,this.selfCol=null,this.quadTree=null,this.target=null,this.startH=1500}set currH(t){this.laser.scaleY=t/1e3}onEnable(){const t=K.instance,e=this.owner;e.__type__=V.LASER,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(B),this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.target=null,this.currH=this.startH,e.alpha=1;let s=t.playerData,i=1e3*(s.fspeed+s.speed+1),l=1e3*s.speed+500;Laya.timer.loop(i,this,()=>{Laya.Tween.to(e,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids()})),Laya.timer.once(l,this,()=>{if(2==t.playerData.laserSta&&t.playerData.trackBox&&t.playerData.trackBox.owner&&t.playerData.trackBox.owner.parent){const e=t.playerData.trackBox;e.bids.indexOf(this.selfCol.bid)<0&&(e.bids.push(this.selfCol.bid),t.playerData.trackCol.onCollisionEnter(this.selfCol,t.playerData.trackBox,!0))}Laya.Tween.to(e,{alpha:1},500,null,Laya.Handler.create(this,()=>{}))})}),C.on(P.GameStateChange,this,()=>{t.gameState==L.START?e.visible=!0:e.visible=!1}),C.on(P.LaserCross,this,()=>{this.target=null,this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2}),C.on(P.LaserTrack,this,()=>{this.selfCol.bids=[],this.target=null}),C.on(P.LaserTrackTar,this,()=>{if(C.event(P.LaserHide,this.selfCol),t.playerData.trackTar&&t.playerData.trackBox&&t.playerData.trackCol&&e.visible&&1==e.alpha){const e=t.playerData.trackBox;e.bids.indexOf(this.selfCol.bid)<0&&(e.bids.push(this.selfCol.bid),t.playerData.trackCol.onCollisionEnter(this.selfCol,t.playerData.trackBox,!0))}})}onDisable(){this.clearBids(),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}clearBids(){this.owner;this.selfCol.bids=[],this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null,this.currH=this.startH,C.event(P.LaserHide,this.selfCol)}onCollisionEnter(t,e){const s=t.owner,i=e.owner;if(s&&i&&!K.instance.playerData.laserSta){let t=Math.abs(s.y-i.y);this.selfCol.height2>t&&(this.currH=t,this.selfCol.height2=t,this.selfCol.deltaY=-t/2,this.target=s)}}onCollisionExit(t,e){const s=t.owner,i=e.owner;s&&i&&!K.instance.playerData.laserSta&&(this.selfCol.bids.length||(this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null))}onLateUpdate(){const t=this.owner,e=K.instance;if(2==e.playerData.laserSta)if(e.playerData.trackTar){const s=e.playerData.trackTar;if(s.x>=0&&s.x<=720&&s.y>=0&&s.y<=1280){let s=e.playerData.trackTar.x-t.x,i=e.playerData.trackTar.y-t.y,l=Math.sqrt(s*s+i*i);this.currH=l,t.rotation=Math.atan2(s,-i)/Math.PI*180}}else t.rotation=0,this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2;if(2!=e.playerData.laserSta&&t.visible&&t.alpha>=.1&&this.quadTree.check(K.instance.enemyCols,this.selfCol),!e.playerData.laserSta&&this.target){const t=this.owner;let e=Math.abs(this.target.y-t.y);this.currH=e,this.selfCol.height2=e,this.selfCol.deltaY=-e/2}}}class Kt extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this.skeNode=null,this.state=L.READY}onEnable(){const t=this.owner;t.__type__=V.MAGNET,this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),t.visible=!1,this.skeNode&&(this.skeNode.blendMode=Laya.BlendMode.LIGHTER),this.state=L.START;const e=c.skills[T.Magnet];Laya.timer.loop(1e3*e.speed,this,()=>{this.ins.gameState==L.START&&(t.visible=!0,this.schedule(200,()=>{this.quadTree.check(K.instance.enemyCols,this.selfCol),this.selfCol.bids=[],C.event(P.LaserHide,this.selfCol)},this,2,null,!0,()=>{t.visible=!1}))})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;t.x=this.ins.playerV2.x,t.y=this.ins.playerV2.y}}class te extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.state=L.READY}onEnable(){const t=this.owner;this.state=L.START,this.selfCol=this.owner.getComponent(B);const e=this.ins.playerCols;t.alpha=0;const s=c.skills[T.TimeShield];let i=1e3*(s.fspeed+s.speed+1),l=1e3*s.fspeed;Laya.timer.loop(i,this,()=>{Laya.Tween.to(t,{alpha:1},500,null,Laya.Handler.create(this,()=>{e.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol)})),Laya.timer.once(l,this,()=>{let s=e.indexOf(this.selfCol);s>-1&&e.splice(s,1),Laya.Tween.to(t,{alpha:0},500)})})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins;this.owner.pos(t.playerV2.x,t.playerV2.y)}}class ee extends x{constructor(){super(),this.ins=K.instance,this.selfCol=null,this.quadTree=null,this.state=L.READY,this._norV3=null,this.speed=.6}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){const t=this.owner,e=this.ins;t.__type__=V.MAGNET,this.selfCol=this.owner.getComponent(B),this.quadTree||(this.quadTree=new N({x:0,y:0,width:720,height:1280})),this.state=L.START;const s=this.getRes(u.battle.PlayerBlast);Laya.timer.loop(500,this,()=>{if(this.ins.gameState!=L.START)return;this.quadTree.check(this.ins.enemyCols,this.selfCol);const i=this.open(u.battle.PlayerBlast,s);i.pos(t.x,t.y),e.effectNode.addChild(i),this.selfCol.bids=[],C.event(P.LaserHide,this.selfCol)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=L.START)return;if(this.state!=L.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class se extends x{constructor(){super(),this.ins=K.instance,this.wing1BPre=null,this.wing1BPre=this.getRes(u.battle.PlayerWing1b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=c.skills[T.BlastWing],i=s.speed||5,l=s.fspeed||.2;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=L.START)return;const i=this.open(u.battle.PlayerWing1b,this.wing1BPre);let a=i.getComponent(M);a||(a=i.addComponent(M));const n=s.value||1;let o=e.attack*n;e.skills[T.BlastWing]&&(o+=e.attack*n*(e.skills[T.BlastWing]-1)*2.4),a.setData(o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=i.getComponent(ee);h.speed=l,h.norV3=this.getVec3(0,-1),i.pos(t.x,t.y),this.ins.player2Node.addChild(i)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}onLateUpdate(){}}class ie extends x{constructor(){super(),this.ins=K.instance,this.wing4BPre=null,this.wing4BPre=this.getRes(u.battle.PlayerWing4b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=c.skills[T.AutoWing],i=s.speed||.2,l=s.fspeed||.2;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=L.START)return;const i=this.open(u.battle.PlayerWing4b,this.wing4BPre);let a=i.getComponent(M);a||(a=i.addComponent(M));const n=s.value||1;let o=e.attack*n;e.skills[T.AutoWing]&&(o+=e.attack*n*(e.skills[T.AutoWing]-1)*2.4),a.setData(o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=i.getComponent(j);h.speed=l,h.state=L.START,h.norV3=this.getVec3(0,-1);let r=this.ins.getMinEnemy(t),c=180;if(r&&r.parent){h.tar=r;let e=this.getVec3(0,-1),s=this.getVec3();Laya.Vector3.subtract(this.getVec3(r.x,r.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,e),h.norV3=e,c=i.rotation}t.rotation=c,i.pos(t.x,t.y-50),this.ins.player2Node.addChild(i)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),C.offAllCaller(this)}onLateUpdate(){}}class le extends Laya.Script{constructor(){super(),this.selectIndex=0,this.itemScale=1,this.space=25,this.startY=0,this.selectDistance=0,this.itemX=[],this.dragRegion=null}onEnable(){const t=this.owner;this.startY=t.y;const e=t.getChildAt(0),s=t.x,i=this.space,l=e.width,a=e.x;this.selectDistance=(l+i)/2;let n=this.owner.numChildren;const o=l*n+i*(n-1);t.width=o;for(let e=0;e<n;e++){let n=-e*(l+i)+s;this.itemX[e]=n;const o=t.getChildAt(e);o.x=a+e*(l+i);let h=e==this.selectIndex?1:this.itemScale;o.scaleX=h,o.scaleY=h}this.dragRegion=new Laya.Rectangle(t.x-o+l,t.y,o-l,0),t.on(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.on(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.on(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.on(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd),t.x=this.itemX[this.selectIndex]}onBoxMove(){this.owner.startDrag(this.dragRegion,!1,100)}onBoxMoving(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);let s=1-Math.abs(t.x-this.itemX[0])/100*.15;return e.scaleX=s,void(e.scaleY=s)}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);let s=1-Math.abs(this.itemX[this.itemX.length-1]-t.x)/100*.15;return e.scaleX=s,void(e.scaleY=s)}for(let e=0;e<this.itemX.length;e++){let s=t.getChildAt(e),i=t.getChildAt(e+1),l=this.itemX[e],a=this.itemX[e+1];if(t.x>=a&&t.x<=l){let n=1-Math.abs(t.x-l)/Math.abs(l-a)*(1-this.itemScale),o=this.itemScale+1-n;s.scaleX=n,s.scaleY=n,i.scaleX=o,i.scaleY=o,e++}else s.scaleX=this.itemScale,s.scaleY=this.itemScale}}onBoxMoveEnd(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);return void Laya.Tween.to(e,{scaleX:1,scaleY:1},100)}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);return void Laya.Tween.to(e,{scaleX:1,scaleY:1},100)}t.stopDrag();for(let e=0;e<this.itemX.length;e++){const s=this.itemX[e];if(t.x!=s&&Math.abs(t.x-s)<=this.selectDistance){Laya.Tween.to(t,{x:s},100),this.selectIndex=e;break}}let e=this.owner.numChildren;for(let s=0;s<e;s++){const e=t.getChildAt(s);let i=s==this.selectIndex?1:this.itemScale;Laya.Tween.to(e,{scaleX:i,scaleY:i},100)}}onDisable(){const t=this.owner;t.off(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.off(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.off(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.off(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd)}onUpdate(){const t=this.owner;t.y!=this.startY&&(t.y=this.startY)}}class ae{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("app/battle/SkillManager.ts",kt),t("app/battle/EnemyManager.ts",$),t("app/battle/PlayerManager.ts",ft),t("app/battle/SkillDialog.ts",St),t("app/battle/BattleScene.ts",K),t("app/battle/bg/BattleSceneUI.ts",Q),t("app/lobby/LobbySceneUI.ts",Vt),t("core/component/Toggle.ts",wt),t("core/component/ToggleContainer.ts",Pt),t("app/lobby/LobbyScene.ts",_t),t("app/lobby/TestUI.ts",At),t("app/battle/bg/BgNode.ts",Ht),t("app/battle/bg/ChooseSkillDialog.ts",F),t("app/battle/bg/GameOverDialog.ts",Nt),t("app/battle/bg/GamePauseDialog.ts",jt),t("app/battle/bg/SupplySkillDialog.ts",z),t("app/battle/effect/EnemyBoom.ts",R),t("app/battle/effect/LighterSkeleton.ts",It),t("app/battle/effect/PlayerBlast.ts",Wt),t("app/battle/effect/PlayerLaserHit.ts",A),t("core/utils/BoxCollision.ts",B),t("app/battle/enemy/Enemy.ts",Y),t("app/battle/enemy/EnemyCollision.ts",X),t("app/battle/enemy/EnemySkill.ts",O),t("app/battle/enemy/Enemy1001.ts",Ut),t("app/battle/enemy/Enemy1002.ts",Ot),t("app/battle/enemy/Enemy2001.ts",qt),t("app/battle/enemy/Enemy3002.ts",G),t("app/battle/enemy/EnemyHPTip.ts",Yt),t("app/battle/enemySkill/EnemyLine.ts",I),t("app/battle/enemySkill/EnemySkill1.ts",W),t("app/battle/enemySkill/EnemySkill13.ts",Xt),t("app/battle/enemySkill/EnemySkill3.ts",U),t("app/battle/player/Player.ts",J),t("app/battle/player/PlayerCollision.ts",zt),t("app/battle/player/PlayerHP.ts",Gt),t("app/battle/robot/PlayerRobot.ts",et),t("app/battle/robot/PlayerRobot1.ts",Ft),t("app/battle/robot/PlayerRobot2.ts",Qt),t("app/battle/robot/PlayerRobot3.ts",$t),t("app/battle/skill/PlayerDieBoom.ts",Zt),t("app/battle/skill/PlayerSkill1.ts",j),t("app/battle/player/PlayerLaser.ts",tt),t("app/battle/player/PlayerLaserCollision.ts",Jt),t("app/battle/skill/PlayerShield.ts",st),t("app/battle/skill/PlayerSkill6.ts",nt),t("app/battle/skill/PlayerSkill2.ts",it),t("app/battle/skill/PlayerSkill3.ts",yt),t("app/battle/skill/PlayerSkill4.ts",lt),t("app/battle/skill/PlayerSkill5.ts",at),t("app/battle/skill/PlayerSkill7.ts",ot),t("app/battle/skill/PlayerSkill9.ts",Kt),t("app/battle/skill/PlayerTimeShield.ts",te),t("app/battle/wing/PlayerWing.ts",rt),t("app/battle/wing/PlayerWing1.ts",se),t("app/battle/skill/PlayerSkill11.ts",ee),t("app/battle/wing/PlayerWing2.ts",pt),t("app/battle/skill/PlayerSkill10.ts",ct),t("app/battle/wing/PlayerWing3.ts",ut),t("app/battle/wing/PlayerWingLaser.ts",dt),t("app/battle/wing/PlayerWing4.ts",ie),t("app/battle/wing/PlayerWing5.ts",gt),t("app/battle/wing/PlayerWing6.ts",bt),t("app/battle/skill/PlayerSkill12.ts",mt),t("core/component/HorizontalSelect.ts",le),t("app/lobby/BattlePage.ts",Tt),t("app/lobby/hangar/HangarPage.ts",Bt),t("app/lobby/hangar/HangarPlaneItem2.ts",Dt)}}ae.width=720,ae.height=1280,ae.scaleMode="fixedwidth",ae.screenMode="none",ae.alignV="top",ae.alignH="center",ae.startScene="LobbyScene.scene",ae.sceneRoot="",ae.debug=!1,ae.stat=!1,ae.physicsDebug=!1,ae.exportSceneToJson=!0,ae.init();new class{constructor(){window.Laya3D?Laya3D.init(ae.width,ae.height):Laya.init(ae.width,ae.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=ae.scaleMode,Laya.stage.screenMode=ae.screenMode,Laya.stage.alignV=ae.alignV,Laya.stage.alignH=ae.alignH,Laya.URL.exportSceneToJson=ae.exportSceneToJson,(ae.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),ae.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),ae.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.ClassUtils.regClass("laya.effect.ColorFilterSetter",Laya.ColorFilterSetter),Laya.ClassUtils.regClass("laya.effect.GlowFilterSetter",Laya.GlowFilterSetter),Laya.ClassUtils.regClass("laya.effect.BlurFilterSetter",Laya.BlurFilterSetter)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){const t=()=>{ae.startScene&&Laya.Scene.open(ae.startScene)},e=[];for(const t in f){const s=f[t];e.push(s)}const s=[];for(const t in S){const e=S[t];s.push(e)}let a=0;Laya.loader.load(e,Laya.Handler.create(this,()=>{2==++a&&t()})),Laya.loader.load(s,Laya.Handler.create(this,()=>{a++;const e=Laya.loader.getRes(S.Chapter);h.setChatpers(e);const s=Laya.loader.getRes(S.Skill);c.setSkills(s);const n=Laya.loader.getRes(S.Enaircraft);r.setEnemys(n);for(let t=1;t<6;t++){const e=Laya.loader.getRes(S["Level"+t]);i.setEnemys1(e,t)}const o=Laya.loader.getRes(S.Exp);l.setExps(o);const p=Laya.loader.getRes(S.Upaircraft);y.setPlanes(p);const u=Laya.loader.getRes(S.Upgold);y.setGolds(u);const g=Laya.loader.getRes(S.Aircraft);d.setPlanes(g),2==a&&t()}),null,Laya.Loader.JSON)}}}();