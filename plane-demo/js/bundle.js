!function(){"use strict";const t=new Laya.EventDispatcher;class e extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}open(t,e){return Laya.Pool.getItemByCreateFun(t,e.create,e)}setClick(t,e,s,i,l){t.on(Laya.Event.MOUSE_DOWN,s,()=>{l||Laya.Tween.to(t,{scaleX:.9,scaleY:.9},100)});const n=()=>{Laya.Tween.to(t,{scaleX:1,scaleY:1},100)};if(!l){const t=e;e=(()=>{n(),t.call(s,i)})}t.on(Laya.Event.MOUSE_OUT,s,n),t.on(Laya.Event.CLICK,s,e,i)}schedule(t,e,s,i,l,n,a){const o=e;let h=0;e=(()=>{if(h>=i)return Laya.timer.clear(s,e),void(a&&a.call(s));h++,o.call(s,l)}),n&&Laya.timer.clear(s,e),Laya.timer.loop(t,s,e,l)}getVec2(t=0,e=0){return new Laya.Vector2(t,e)}getVec3(t=0,e=0,s=0){return t instanceof Laya.Vector2&&(e=t.y,t=t.x),new Laya.Vector3(t,e,s)}getVec4(t=0,e=0,s=0,i=0){return new Laya.Vector4(t,e,s,i)}}class s extends e{constructor(){super(),this.width2=50,this.height2=50,this.deltaY=0,this.aabb=null,this.bid=null,this.bids=[],s.__bid__++,this.bid=s.__bid__}onEnable(){this.aabb={x:0,y:0,width:this.width2,height:this.height2}}onDisable(){}onLateUpdate(){const t=this.owner;t&&(this.aabb.x=t.x-this.width2/2,this.aabb.y=t.y-this.height2/2+this.deltaY)}}var i,l;s.__bid__=0,function(t){t[t.READY=0]="READY",t[t.START=1]="START",t[t.PAUSE=2]="PAUSE",t[t.END=3]="END"}(i||(i={})),function(t){t.LASER="laser",t.POISON="poison",t.ICE="ice",t.MAGNET="magnet"}(l||(l={}));class n{constructor(){this.laserSta=0,this.trackTar=null,this.trackBox=null,this.trackCol=null}}class a extends e{constructor(){super(),this.ins=o.instance,this.selfCol=null,this.state=i.START,this.colFil=null,this.timer=0,this.hp=30,this.timers={}}onEnable(){const e=this.owner;this.selfCol=this.owner.getComponent(s),this.hp=30,Laya.timer.frameOnce(1,this,()=>{e.filters&&e.filters[0]&&(this.colFil=e.filters[0])}),t.on("Laser_Hide",this,t=>{let e=this.selfCol.bids.indexOf(t.bid);e>-1&&(this.selfCol.bids.splice(e,1),this.onCollisionExit(t,this.selfCol))})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this);for(const t in this.timers){const e=this.timers[t];e&&e.timer&&clearInterval(e.timer)}this.timers=null}onCollision(e){if(!this.owner||!this.owner.parent)return void this.onDisable();this.hp--,console.log("hp -> ",this.hp);const s=this.open("player_hp_tip",this.ins.plaHPTipPre);s.pos(e.x,this.owner.y),this.ins.effectNode.addChild(s),this.hp<=0&&(this.onDisable(),this.owner.removeSelf(),t.event("Enemy_Dead",this.selfCol))}onCollisionEnter(t,e,s){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;let n=t.owner.__type__,a=t.owner;if((s||n&&n==l.MAGNET||2==this.ins.playerData.laserSta)&&(a=e.owner),this.onCollision(a),n&&n==l.POISON&&this.schedule(1e3,()=>{this.onCollision(e.owner)},this,4,null,!0),n&&n==l.ICE&&(this.state=i.PAUSE,Laya.timer.once(3e3,this,()=>{this.state=i.START})),this.timers&&n&&n==l.LASER){let e=setInterval(()=>{this.onCollision(a)},200);const s=this.timers[t.bid];s?(s.timer&&clearInterval(s.timer),this.timers[t.bid].timer=e):this.timers[t.bid]={timer:e}}}onCollisionExit(t,e){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;let s=t.owner.__type__;if(s&&s==l.LASER){if(!this.timers)return;const e=this.timers[t.bid];e&&(e.timer&&clearInterval(e.timer),this.timers[t.bid]=null)}}onLateUpdate(){if(this.ins.gameState!=i.START)return;if(this.state!=i.START)return;const t=this.owner,e=Laya.timer.delta/1e3;if(t){this.timer+=e;let s=Math.sin(this.timer);t.x+=s,this.colFil&&this.colFil.adjustHue(90*s/50)}}}class o extends e{constructor(){super(),this.bgPre=null,this.playerPre=null,this.enemyPre=null,this.plaLasPre=null,this.plaHPPre=null,this.plaHPTipPre=null,this.plaWing5Pre=null,this.plaWing2Pre=null,this.plaWing3Pre=null,this.plaWing1Pre=null,this.plaWing6Pre=null,this.plaWing4Pre=null,this.plaRob1Pre=null,this.plaRob2Pre=null,this.plaRob3Pre=null,this.enemyNode=null,this.bgTopNode=null,this.eneBulNode=null,this.playerNode=null,this.effectNode=null,this.returnBtn=null,this.bgSceneV2=null,this.modSceneV3=null,this.modCameraV3=null,this.playerV3=null,this.playerV2=null,this.plaLassV2=[],this.plaWingsV2=[],this.playerPosV3=new Laya.Vector3(0,0,0),this.playerPosV2=new Laya.Vector3(360,900,0),this.touchX=0,this.touchY=0,this.rotationZ=0,this.lastX=0,this.playerData=null,this.gameState=i.READY,this.enemyCols=[],o.instance=this;const t=Laya.stage.addChild(new Laya.Scene);t.zOrder=-2,this.bgSceneV2=t;const e=Laya.stage.addChild(new Laya.Scene3D);e.zOrder=-1,this.modSceneV3=e;const s=e.addChild(new Laya.Camera(0,.1,1e3));this.modCameraV3=s,s.clearFlag=Laya.CameraClearFlags.Nothing,s.clearColor=new Laya.Vector4(0,0,0,0),s.transform.rotate(new Laya.Vector3(-90,0,0),!1,!1),s.orthographic=!0,s.orthographicVerticalSize=10;const l=e.addChild(new Laya.DirectionLight);l.color=new Laya.Vector3(1.5,1.5,1.5),l.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0))}onEnable(){this.gameState=i.READY,this.playerData=new n;const e=this.open("bg_node",this.bgPre);this.bgSceneV2.addChild(e),this.enemyNode=this.bgSceneV2.addChild(new Laya.Sprite),this.bgTopNode=this.bgSceneV2.addChild(new Laya.Sprite);Laya.loader.create(["unity/plane1/plane.lh","unity/tuowei/plane.lh","unity/lizi/plane.lh"],Laya.Handler.create(this,this.onPlaneCreate)),this.setClick(this.returnBtn,()=>{Laya.Scene.open("lobby/LobbyScene.scene",!0)},this),t.on("Laser_Track",this,this.getTrackEnemy),t.on("Enemy_Dead",this,t=>{this.enemyCols.splice(this.enemyCols.indexOf(t),1);const e=this.open("enemy1",this.enemyPre);let i=Math.floor(701*Math.random()+10),l=Math.floor(631*Math.random()+10),n=Math.floor(2*Math.random()+1);e.pos(i,l),e.scale(n,n),this.enemyNode.addChild(e),this.enemyCols.push(e.getComponent(s)),2==this.playerData.laserSta&&this.playerData.trackBox&&t.bid==this.playerData.trackBox.bid&&this.getTrackEnemy()})}onDisable(){this.bgSceneV2.destroy(!0),this.modSceneV3.destroy(!0),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}getTrackEnemy(){let e=null,i=null;for(let t=0;t<this.enemyCols.length;t++){const e=this.enemyCols[t].owner;(!i||e.y>i.y)&&(i=e)}(e=i)?(this.playerData.trackTar=e,this.playerData.trackBox=e.getComponent(s),this.playerData.trackCol=e.getComponent(a)):(this.playerData.trackTar=null,this.playerData.trackBox=null,this.playerData.trackCol=null),t.event("Track_Target")}getMinEnemy(t){let e=null,s=null;for(let i=0;i<this.enemyCols.length;i++){const l=this.enemyCols[i].owner;if(!l)continue;let n=l.x-t.x,a=l.y-t.y,o=n*n+a*a;(!e||o<e)&&(e=o,s=l)}return s}onPlaneCreate(){let t=this.getVec3();this.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,1280),t);const e=Laya.loader.getRes("unity/plane1/plane.lh");e.transform.position=t,this.playerV3=e,e.transform.localScale=new Laya.Vector3(3e-4,3e-4,3e-4),this.modSceneV3.addChild(e);const l=Laya.loader.getRes("unity/lizi/plane.lh");l.transform.position=this.getVec3(100,-1e3,1e3),e.addChild(l);const n=this.open("player_collision",this.playerPre);n.pos(360,1280),this.playerNode.addChild(n),this.playerV2=n;const a=this.open("player_hp",this.plaHPPre);a.pos(440,1200),this.bgTopNode.addChild(a),this.modCameraV3.convertScreenCoordToOrthographicCoord(this.playerPosV2,t),this.playerPosV3=t,Laya.Tween.to(n,{y:this.playerPosV2.y},500,Laya.Ease.cubicOut),Laya.Tween.to(a,{y:this.playerPosV2.y-80},500,Laya.Ease.cubicOut),Laya.Tween.to(e.transform,{localPositionZ:t.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{this.gameState=i.START;const t=this.open("player_laser_collision",this.plaLasPre);t.pos(360,900),this.playerNode.addChild(t),this.plaLassV2.push(t);let e=0;Laya.timer.loop(200,this,()=>{if(e>4)return;const t=this.open("enemy1",this.enemyPre);let i=Math.floor(701*Math.random()+10),l=Math.floor(631*Math.random()+10),n=Math.floor(2*Math.random()+1);t.pos(i,l),t.scale(n,n),this.enemyNode.addChild(t),this.enemyCols.push(t.getComponent(s)),e++})}))}onStageMouseDown(t){this.gameState==i.START&&(this.touchX=t.stageX,this.touchY=t.stageY)}onStageMouseMove(t){if(this.gameState!=i.START)return;let e=t.stageX-this.touchX,s=t.stageY-this.touchY;this.rotationZ-=e/8,Math.abs(this.rotationZ)>45&&(this.rotationZ*=.7),this.touchX=t.stageX,this.touchY=t.stageY;let l=this.playerPosV2.x+e,n=this.playerPosV2.y+s;l>=0&&l<=720&&(this.playerPosV2.x=l),n>=0&&n<=1280&&(this.playerPosV2.y=n),this.modCameraV3.convertScreenCoordToOrthographicCoord(this.playerPosV2,this.playerPosV3)}onStageMouseUp(t){this.gameState==i.START&&(this.touchX=0,this.touchY=0,this.rotationZ=0,this.playerV3.transform.localRotationEulerZ=0)}onLateUpdate(){if(this.gameState!=i.START)return;let t=Laya.timer.delta/1e3;if(this.playerV3){let e=this.playerV3.transform.position,s=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(e,this.playerPosV3,15*t,s),this.playerV3.transform.position=s,Math.abs(this.playerV3.transform.position.x-this.lastX)<=.02&&(this.rotationZ=0);let i=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(this.playerV3.transform.localRotationEuler,this.getVec3(0,0,this.rotationZ),15*t,i),this.playerV3.transform.localRotationEuler=i,this.lastX=this.playerV3.transform.position.x}}}const h=[[0],[-30,30],[-5,0,5]],r=[[{dx:-80,dy:40,v:-1},{dx:80,dy:40,v:1}],[{dx:-160,dy:40,v:-1},{dx:160,dy:40,v:1}],[{dx:-240,dy:40,v:-1},{dx:240,dy:40,v:1}]];class c extends e{constructor(){super(),this.ins=o.instance,this.laser=null,this.deltaX=0,this.deltaY=0}onEnable(){this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER)}onDisable(){}onLateUpdate(){if(this.ins.gameState!=i.START)return;const t=this.owner;let e=this.ins.playerV2;t.pos(e.x+this.deltaX,e.y+this.deltaY)}}class y extends e{constructor(){super(),this.ins=o.instance,this.deltaX=0,this.deltaY=0}onEnable(){}onDisable(){}onLateUpdate(){if(this.ins.gameState!=i.START)return;const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),l=this.getVec3(this.ins.playerPosV2.x+this.deltaX,this.ins.playerPosV2.y+this.deltaY),n=this.getVec3();Laya.Vector3.lerp(s,l,8*e,n),t.pos(n.x,n.y)}}class d{constructor(t){this._tree=new Quadtree(t)}check(t,e){let s=[];if(this._tree){this._tree.clear();for(let e=0,s=t.length;e<s;e++){const s=t[e],i=s.aabb,l={x:i.x,y:i.y,height:i.height,width:i.width,collider:s};this._tree.insert(l)}if(this._tree.retrieve(e.aabb).forEach(t=>{(function(t,e){const s=t.owner,i=e.owner,l=s.y+t.deltaY,n=i.y+e.deltaY;return Math.abs(s.x-i.x)<=(t.width2+e.width2)/2&&Math.abs(l-n)<=(t.height2+e.height2)/2})(t.collider,e)&&s.push(t.collider)}),this._collisions)for(let t=0;t<this._collisions.length;t++){const i=this._collisions[t];if(s.indexOf(i)<0){let t=i.bids.indexOf(e.bid);if(t>-1&&(i.bids.splice(t,1),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionExit){l.onCollisionExit(e,i);break}}}let s=e.bids.indexOf(i.bid);if(s>-1&&(e.bids.splice(s,1),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionExit){l.onCollisionExit(i,e);break}}}}}for(let t=0;t<s.length;t++){const i=s[t];if(i.bids.indexOf(e.bid)<0&&(i.bids.push(e.bid),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionEnter){l.onCollisionEnter(e,i);break}}}if(e.bids.indexOf(i.bid)<0&&(e.bids.push(i.bid),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionEnter){l.onCollisionEnter(i,e);break}}}}this._collisions=s}}}function Quadtree(t,e,s,i){this.max_objects=e||10,this.max_levels=s||4,this.level=i||0,this.bounds=t,this.objects=[],this.nodes=[]}Quadtree.prototype.split=function(){var t=this.level+1,e=this.bounds.width/2,s=this.bounds.height/2,i=this.bounds.x,l=this.bounds.y;this.nodes[0]=new Quadtree({x:i+e,y:l,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[1]=new Quadtree({x:i,y:l,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[2]=new Quadtree({x:i,y:l+s,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[3]=new Quadtree({x:i+e,y:l+s,width:e,height:s},this.max_objects,this.max_levels,t)},Quadtree.prototype.getIndex=function(t){var e=[],s=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,l=t.y<i,n=t.x<s,a=t.x+t.width>s,o=t.y+t.height>i;return l&&a&&e.push(0),n&&l&&e.push(1),n&&o&&e.push(2),a&&o&&e.push(3),e},Quadtree.prototype.insert=function(t){var e,s=0;if(this.nodes.length)for(e=this.getIndex(t),s=0;s<e.length;s++)this.nodes[e[s]].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){for(this.nodes.length||this.split(),s=0;s<this.objects.length;s++){e=this.getIndex(this.objects[s]);for(var i=0;i<e.length;i++)this.nodes[e[i]].insert(this.objects[s])}this.objects=[]}},Quadtree.prototype.retrieve=function(t){var e=this.getIndex(t),s=this.objects;if(this.nodes.length)for(var i=0;i<e.length;i++)s=s.concat(this.nodes[e[i]].retrieve(t));return s=s.filter(function(t,e){return s.indexOf(t)>=e})},Quadtree.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]};class p extends e{constructor(){super(),this.selfCol=null,this.quadTree=null,this.state=i.READY,this._norV3=null,this.speed=.6,this.boom=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner.__type__=l.MAGNET,this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),this.state=i.START,this.boom.visible=!1,Laya.timer.loop(200,this,()=>{this.boom.visible=!0,this.quadTree.check(o.instance.enemyCols,this.selfCol),this.selfCol.bids=[],t.event("Laser_Hide",this.selfCol),Laya.timer.once(100,this,()=>{this.boom.visible=!1})})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class g extends e{constructor(){super(),this.ins=o.instance,this.wing1BPre=null}onEnable(){const t=this.owner;Laya.timer.loop(5e3,this,()=>{const e=this.open("player_wing_1_b",this.wing1BPre);e.getComponent(p).norV3=this.getVec3(0,-1),e.pos(t.x,t.y),this.ins.playerNode.addChild(e)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){}}class u extends e{constructor(){super(),this.selfCol=null,this.quadTree=null,this._norV3=null,this.circle=!0,this.state=i.READY,this.tar=null,this.angle=0,this.xv=1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),this.state=i.START}onDisable(){t.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;let e=1*Laya.timer.delta;if(this.tar&&this.tar.parent)if(this.circle){let s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x)-Math.atan2(-this.norV3.y,this.norV3.x);if(l<0&&(l+=2*Math.PI),l<=.2)this.circle=!1;else{this.angle+=this.xv*e/2;let t=Math.tan(this.angle/180*Math.PI),s=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-t,0),s),this.angle>90&&(s.x=-s.x,s.y=-s.y),this.norV3.x=s.x,this.norV3.y=s.y}}else{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(o.instance.enemyCols,this.selfCol)}}class b extends e{constructor(){super(),this.ins=o.instance,this.wing2BPre=null,this.xv=1}onEnable(){const t=this.owner;Laya.timer.loop(5e3,this,()=>{let e=0;for(let s=0;s<6;s++){let s=Math.floor(89*Math.random()+1),i=Math.tan(s/180*Math.PI),l=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,i,0),l),l.x*=this.xv,e+=Math.floor(251*Math.random()+50),Laya.timer.once(e,this,()=>{const e=this.open("player_wing_2_b",this.wing2BPre),i=e.getComponent(u);i.norV3=l,i.angle=this.xv>0?-s:s+180,i.xv=this.xv,i.tar=this.ins.getMinEnemy(t),e.pos(t.x,t.y),this.ins.playerNode.addChild(e)})}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){}}class f extends e{constructor(){super(),this.ins=o.instance,this.laser=null,this.tar=null,this.deltaX=0,this.deltaY=0}onEnable(){this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER)}onDisable(){}onLateUpdate(){if(this.ins.gameState!=i.START)return;if(!this.tar)return;const t=this.owner;let e=this.tar;t.pos(e.x+this.deltaX,e.y+this.deltaY)}}class C extends e{constructor(){super(),this.ins=o.instance,this.wing3BPre=null,this.xv=1}onEnable(){const t=this.open("player_wing_3_b",this.wing3BPre);let e=this.owner;t.getComponent(f).tar=e,t.pos(e.x,e.y),this.ins.playerNode.addChild(t)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){}}class m extends e{constructor(){super(),this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=i.READY,this.tar=null,this.speed=1.5}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),t.on("Player_1_Skill_Start",this,()=>{this.state=i.START})}onDisable(){t.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;if(this.tar&&this.tar.parent){let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(o.instance.enemyCols,this.selfCol)}}class x extends e{constructor(){super(),this.ins=o.instance,this.wing4BPre=null}onEnable(){const t=this.owner;Laya.timer.loop(150,this,()=>{const e=this.open("player_wing_4_b",this.wing4BPre),s=e.getComponent(m);s.speed=.5,s.state=i.START;let l=this.ins.getMinEnemy(t),n=180;if(l&&l.parent){s.tar=l;let i=this.getVec3(0,-1),a=this.getVec3();Laya.Vector3.subtract(this.getVec3(l.x,l.y),this.getVec3(t.x,t.y),a),Laya.Vector3.normalize(a,i),s.norV3=i,n=e.rotation}t.rotation=n,e.pos(t.x,t.y),this.ins.playerNode.addChild(e)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){}}class V extends e{constructor(){super(),this.selfCol=null,this.quadTree=null,this._norV3=null,this.speed=null,this.state=i.READY}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),this.speed||(this.speed=2.5),this.state=i.START}onDisable(){t.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(o.instance.enemyCols,this.selfCol)}}class L extends e{constructor(){super(),this.ins=o.instance,this.wing5BPre=null,this.xv=1}onEnable(){const t=this.owner,e=[this.getVec3(.03,-1),this.getVec3(.07,-1),this.getVec3(.1,-.99),this.getVec3(.14,-.99),this.getVec3(.17,-.98),this.getVec3(.21,-.98)];let s=0;Laya.timer.loop(50,this,()=>{s>=6&&(s=0);const i=this.open("player_wing_5_b",this.wing5BPre),l=i.getComponent(V);let n=e[s];l.norV3=this.getVec3(n.x*this.xv,n.y),l.speed=1,i.pos(t.x,t.y),this.ins.playerNode.addChild(i),s++})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){}}class w extends e{constructor(){super(),this.state=i.READY,this._norV3=null,this.speed=.2}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner;this.state=i.START}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class _ extends e{constructor(){super(),this.ins=o.instance,this.wing6BPre=null}onEnable(){const t=this.owner;Laya.timer.loop(5e3,this,()=>{const e=this.open("player_wing_6_b",this.wing6BPre);e.getComponent(w).norV3=this.getVec3(0,-1),e.pos(t.x,t.y),this.ins.playerNode.addChild(e)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){}}class S extends e{constructor(){super(),this.qhBtn=null,this.gcBtn=null,this.zzBtn=null,this.fypBtn=null,this.cjbBtn=null,this.jgBtn=null,this.sdBtn=null,this.chddBtn=null,this.ddgBtn=null,this.xzdqBtn=null,this.xzhqBtn=null,this.cbdcBtn=null,this.xzbqBtn=null,this.sdljBtn=null,this.ddljBtn=null,this.jgljBtn=null,this.bpljBtn=null,this.hdljBtn=null,this.zzpljBtn=null,this.bpjqrBtn=null,this.hdjqrBtn=null,this.jgjqrBtn=null}onEnable(){this.setClick(this.qhBtn,this.strengthenArms.bind(this),this),this.setClick(this.gcBtn,this.crossArms.bind(this),this),this.setClick(this.zzBtn,this.trackArms.bind(this),this),this.setClick(this.fypBtn,this.skill1.bind(this),this),this.setClick(this.cjbBtn,this.skill2.bind(this),this),this.setClick(this.jgBtn,this.skill3.bind(this),this),this.setClick(this.sdBtn,this.skill4.bind(this),this),this.setClick(this.chddBtn,this.skill5.bind(this),this),this.setClick(this.xzdqBtn,this.skill6.bind(this),this),this.setClick(this.ddgBtn,this.skill7.bind(this),this),this.setClick(this.xzhqBtn,this.skill8.bind(this),this),this.setClick(this.cbdcBtn,this.skill9.bind(this),this),this.setClick(this.xzbqBtn,this.skill10.bind(this),this),this.setClick(this.sdljBtn,this.wing5.bind(this),this),this.setClick(this.ddljBtn,this.wing2.bind(this),this),this.setClick(this.jgljBtn,this.wing3.bind(this),this),this.setClick(this.bpljBtn,this.wing1.bind(this),this),this.setClick(this.hdljBtn,this.wing6.bind(this),this),this.setClick(this.zzpljBtn,this.wing4.bind(this),this),this.setClick(this.bpjqrBtn,this.robot1.bind(this),this),this.setClick(this.hdjqrBtn,this.robot2.bind(this),this),this.setClick(this.jgjqrBtn,this.robot3.bind(this),this)}strengthenArms(){const t=o.instance;let e=t.plaLassV2.length;if(e>=3)return;let s=t.playerPosV2;for(let e=0;e<t.plaLassV2.length;e++){t.plaLassV2[e].removeSelf()}t.plaLassV2.length=0;let i=h[e];for(let l=0;l<e+1;l++){const e=this.open("player_laser_collision",t.plaLasPre);e.getComponent(c).deltaX=i[l],e.pos(s.x+i[l],s.y),t.playerNode.addChild(e),t.plaLassV2.push(e)}}crossArms(){const e=o.instance;e.playerData.laserSta||(e.playerData.laserSta=1,t.event("Laser_Cross"))}trackArms(){const e=o.instance;2!=e.playerData.laserSta&&(e.playerData.laserSta=2,t.event("Laser_Track"))}skill1(){t.event("Player_1_Skill")}skill2(){t.event("Player_2_Skill")}skill3(){t.event("Player_3_Skill")}skill4(){t.event("Player_4_Skill")}skill5(){t.event("Player_5_Skill")}skill6(){t.event("Player_6_Skill")}skill7(){t.event("Player_7_Skill")}skill8(){t.event("Player_8_Skill")}skill9(){t.event("Player_9_Skill")}skill10(){t.event("Player_10_Skill")}wing5(){const t=o.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=r[e/2];for(let e=0;e<2;e++){const l=this.open("player_wing_5",t.plaWing5Pre),n=l.getComponent(y),a=l.getComponent(L);n.deltaX=i[e].dx,n.deltaY=i[e].dy,a.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}}wing2(){const t=o.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=r[e/2];for(let e=0;e<2;e++){const l=this.open("player_wing_2",t.plaWing2Pre),n=l.getComponent(y),a=l.getComponent(b);n.deltaX=i[e].dx,n.deltaY=i[e].dy,a.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}}wing3(){const t=o.instance;let e=t.plaWingsV2.length;if(e>=6)return;let s=t.playerV2,i=r[e/2];for(let e=0;e<2;e++){const l=this.open("player_wing_3",t.plaWing3Pre),n=l.getComponent(y),a=l.getComponent(C);n.deltaX=i[e].dx,n.deltaY=i[e].dy,a.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}}wing1(){const t=o.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=r[e/2];for(let e=0;e<2;e++){const l=this.open("player_wing_1",t.plaWing1Pre),n=l.getComponent(y);l.getComponent(g);n.deltaX=i[e].dx,n.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}}wing6(){const t=o.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=r[e/2];for(let e=0;e<2;e++){const l=this.open("player_wing_6",t.plaWing6Pre),n=l.getComponent(y);l.getComponent(_);n.deltaX=i[e].dx,n.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}}wing4(){const t=o.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=r[e/2];for(let e=0;e<2;e++){const l=this.open("player_wing_4",t.plaWing4Pre),n=l.getComponent(y);l.getComponent(x);n.deltaX=i[e].dx,n.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}}robot1(){t.event("Player_1_Robot")}robot2(){t.event("Player_2_Robot")}robot3(){t.event("Player_3_Robot")}onDisable(){}}var P,T,k=Laya.Scene,E=Laya.ClassUtils.regClass;!function(t){!function(t){class e extends k{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("battle/BattleScene")}}t.BattleSceneUI=e,E("ui.battle.BattleSceneUI",e)}(t.battle||(t.battle={}))}(P||(P={})),function(t){!function(t){class e extends k{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("lobby/LobbyScene")}}t.LobbySceneUI=e,E("ui.lobby.LobbySceneUI",e)}(t.lobby||(t.lobby={}))}(P||(P={}));class M extends P.lobby.LobbySceneUI{constructor(){super(),M.instance=this}onEnable(){}onDisable(){}}M.instance=null;class A extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}}class v extends Laya.Script{constructor(){super(),this.interactable=!0,this.isChecked=!0,this.checkMark=null,this.clickHandle=null,this.cantHandle=null}onMouseUp(){if(this.interactable){if(this.isChecked=!this.isChecked,this.checkMark&&(this.checkMark.visible=this.isChecked),this.clickHandle&&this.clickHandle(this.isChecked),this.owner&&this.owner.parent&&this.owner.parent.getComponent(A)){let t=this.owner.parent.numChildren,e=this.owner.parent.getChildIndex(this.owner);for(let s=0;s<t;s++){const t=this.owner.parent.getChildAt(s).getComponent(v);if(!t)return;s==e?t.isChecked||(t.isChecked=!0):t.isChecked=!1,t.checkMark&&(t.checkMark.visible=t.isChecked)}}}else this.cantHandle&&this.cantHandle()}onEnable(){this.checkMark&&(this.checkMark.visible=this.isChecked)}onDisable(){}}class D extends e{constructor(){super(),this.startBtn=null,this.chaHorSel=null,this.midNode=null,this.tabIndex=0}onEnable(){let e=this.chaHorSel.numChildren;for(let t=0;t<e;t++){const e=this.chaHorSel.getChildAt(t).getChildAt(0);if(e){let t=!1;Laya.Tween.to(e,{y:10},2e3,null,null,0),Laya.timer.loop(2e3,this,()=>{let s=t?10:0;Laya.Tween.to(e,{y:s},2e3,null,null,0),t=!t})}}let s=!1;this.setClick(this.startBtn,()=>{s||(s=!0,Laya.Scene.open("battle/BattleScene.scene"))},this),t.on(T.OPEN_PAGE,this,this.onOpen)}onOpen(t){const e=this.owner;t==this.tabIndex?(e.visible=!0,this.midNode.x=-360,Laya.Tween.to(this.midNode,{x:360},300)):e.visible=!1}onDisable(){t.off(T.OPEN_PAGE,this,this.onOpen)}onDestroy(){}}!function(t){t.OPEN_PAGE="open_page"}(T||(T={}));class B extends e{constructor(){super(),this.battlePre=null,this.battlePage=null,this.batTog=null}onEnable(){console.log("stage -> ",Laya.stage);const e=this.open("battlePage",this.battlePre);M.instance.content.addChild(e),this.battlePage=e.getComponent(D),this.battlePage.tabIndex=1,this.batTog=M.instance.batTog.getComponent(v),this.batTog.clickHandle=(()=>{t.event(T.OPEN_PAGE,this.battlePage.tabIndex),this.topBotAnim()})}topBotAnim(){M.instance.bottom.y=1178+M.instance.bottom.height,Laya.Tween.to(M.instance.bottom,{y:1178},500,Laya.Ease.quadInOut),M.instance.top.y=0-M.instance.top.height,Laya.Tween.to(M.instance.top,{y:0},500,Laya.Ease.quadInOut)}onDisable(){}}class R extends Laya.Script{constructor(){super(),this.selectIndex=0,this.itemScale=1,this.space=25,this.startY=0,this.selectDistance=0,this.itemX=[],this.dragRegion=null}onEnable(){const t=this.owner;this.startY=t.y;const e=t.getChildAt(0),s=t.x,i=this.space,l=e.width,n=e.x;this.selectDistance=(l+i)/2;let a=this.owner.numChildren;const o=l*a+i*(a-1);t.width=o;for(let e=0;e<a;e++){let a=-e*(l+i)+s;this.itemX[e]=a;const o=t.getChildAt(e);o.x=n+e*(l+i);let h=e==this.selectIndex?1:this.itemScale;o.scaleX=h,o.scaleY=h}this.dragRegion=new Laya.Rectangle(t.x-o+l,t.y,o-l,0),t.on(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.on(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.on(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.on(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd),t.x=this.itemX[this.selectIndex]}onBoxMove(){this.owner.startDrag(this.dragRegion,!1,100)}onBoxMoving(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);let s=1-Math.abs(t.x-this.itemX[0])/100*.15;return e.scaleX=s,void(e.scaleY=s)}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);let s=1-Math.abs(this.itemX[this.itemX.length-1]-t.x)/100*.15;return e.scaleX=s,void(e.scaleY=s)}for(let e=0;e<this.itemX.length;e++){let s=t.getChildAt(e),i=t.getChildAt(e+1),l=this.itemX[e],n=this.itemX[e+1];if(t.x>=n&&t.x<=l){let a=1-Math.abs(t.x-l)/Math.abs(l-n)*(1-this.itemScale),o=this.itemScale+1-a;s.scaleX=a,s.scaleY=a,i.scaleX=o,i.scaleY=o,e++}else s.scaleX=this.itemScale,s.scaleY=this.itemScale}}onBoxMoveEnd(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);return void Laya.Tween.to(e,{scaleX:1,scaleY:1},100)}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);return void Laya.Tween.to(e,{scaleX:1,scaleY:1},100)}for(let e=0;e<this.itemX.length;e++){const s=this.itemX[e];if(t.x!=s&&Math.abs(t.x-s)<=this.selectDistance){Laya.Tween.to(t,{x:s},100),this.selectIndex=e;break}}let e=this.owner.numChildren;for(let s=0;s<e;s++){const e=t.getChildAt(s);let i=s==this.selectIndex?1:this.itemScale;Laya.Tween.to(e,{scaleX:i,scaleY:i},100)}}onDisable(){const t=this.owner;t.off(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.off(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.off(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.off(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd)}onUpdate(){const t=this.owner;t.y!=this.startY&&(t.y=this.startY)}}class I extends Laya.Script{constructor(){super(),this.bg1=null,this.bg2=null}onEnable(){}onDisable(){}onUpdate(){let t=Laya.timer.delta;if(this.bg1&&this.bg2){this.bg1.y>=1920&&(this.bg1.y=this.bg1.y-1920-640),this.bg2.y>=1920&&(this.bg2.y=this.bg2.y-1920-640);let e=.1*t;this.bg1.y+=e,this.bg2.y+=e}}}class Y extends e{constructor(){super(),this.selfCol=null,this.quadTree=null}onEnable(){this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280})}onCollisionEnter(t,e){}onCollisionExit(t,e){}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){this.quadTree.check(o.instance.enemyCols,this.selfCol)}}class U extends e{constructor(){super(),this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=i.READY}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),this.state=i.READY,t.on("Player_2_Skill_Start",this,()=>{this.state=i.START})}onDisable(){t.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;let e=.8*Laya.timer.delta;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(o.instance.enemyCols,this.selfCol)}}class N extends e{constructor(){super(),this.selfCol=null,this.quadTree=null,this._norV3=null,this.angle=0,this.state=i.READY,this.js=!1,this.tar=null,this.pangle=0}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),this.state=i.START}onDisable(){t.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;let e=.5*Laya.timer.delta;if(this.js){if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i),Laya.Vector3.lerp(this.norV3,i,e/50,l),this.norV3=l,e*=2}}else{if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let n=Math.atan2(-i.y,i.x);Laya.Vector3.lerp(this.getVec3(this.pangle),this.getVec3(n),e/100,l),this.pangle=l.x;let a=this.tar.x-t.x,o=this.tar.y-t.y;a*a+o*o<=9e4&&(this.js=!0)}this.angle+=5;let s=Math.atan(Math.cos(this.angle/180*Math.PI)),i=Math.tanh(s)/1,l=new Laya.Vector3(0,0,0),n=this.pangle,a=1*Math.cos(n)+i*Math.sin(n),o=i*Math.cos(n)-1*Math.sin(n);Laya.Vector3.normalize(this.getVec3(a,o),l),this.norV3=l}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(o.instance.enemyCols,this.selfCol)}}class H extends e{constructor(){super(),this.ins=o.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=i.READY,this.angle=0,this.type=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner.__type__=this.type?this.type:l.POISON,this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),this.state=i.START}onDisable(){t.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;let e=Laya.timer.delta/200;this.angle+=e,t.rotation=-180-this.angle/Math.PI*180,t.x=this.ins.playerV2.x+200*Math.cos(this.angle),t.y=this.ins.playerV2.y-200*Math.sin(this.angle),this.quadTree.check(o.instance.enemyCols,this.selfCol)}}class q extends e{constructor(){super(),this.ins=o.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=i.READY,this.move=!0,this.getTar=!1,this.timer=0,this.deltaY=0}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),this.state=i.READY,t.on("Player_7_Skill_Start",this,()=>{this.state=i.START})}onDisable(){t.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;let e=.5*Laya.timer.delta;if(this.move)if(this.deltaY>=200)this.move=!1,this.deltaY=0;else{t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x;let s=e*this.norV3.y;t.y+=s,this.deltaY+=Math.abs(s)}else if(this.timer>=300)this.move=!0,this.getTar=!1,this.timer=0;else{if(!this.getTar){this.getTar=!0;let e=this.ins.getMinEnemy(this.owner);if(e&&e.parent){let s=this.getVec3();Laya.Vector3.subtract(this.getVec3(e.x,e.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,this.norV3)}else this.norV3.x=-this.norV3.x}this.timer+=Laya.timer.delta}(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(o.instance.enemyCols,this.selfCol)}}class X extends e{constructor(){super(),this.ins=o.instance,this._norV3=null,this.speed=.1}get norV3(){return this._norV3}set norV3(t){this._norV3=t}onEnable(){}onDisable(){}onLateUpdate(){if(this.ins.gameState!=i.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class O extends e{constructor(){super(),this.ins=o.instance,this.skill1Pre=null,this.skill2Pre=null,this.skill3Pre=null,this.skill4Pre=null,this.skill5Pre=null,this.skill6Pre=null,this.skill7Pre=null,this.skill8Pre=null,this.skill9Pre=null,this.skill10Pre=null}onEnable(){t.on("Player_1_Skill",this,this.skill),t.on("Player_2_Skill",this,this.skill2),t.on("Player_3_Skill",this,this.skill3),t.on("Player_4_Skill",this,this.skill4),t.on("Player_5_Skill",this,this.skill5),t.on("Player_6_Skill",this,this.skill6),t.on("Player_7_Skill",this,this.skill7),t.on("Player_8_Skill",this,this.skill8),t.on("Player_9_Skill",this,this.skill9),t.on("Player_10_Skill",this,this.skill10),t.on("Player_1_Robot",this,this.robot1),t.on("Player_2_Robot",this,this.robot2),t.on("Player_3_Robot",this,this.robot3)}skill(){const e=this.owner,s=[this.getVec3(0,-1),this.getVec3(.71,-.71),this.getVec3(1,0),this.getVec3(.71,.71),this.getVec3(0,1),this.getVec3(-.71,.71),this.getVec3(-1,0),this.getVec3(-.71,-.71)];Laya.timer.loop(1e4,this,()=>{for(let i=0;i<8;i++){const l=this.open("player_skill_1",this.skill1Pre),n=l.getComponent(m);n.norV3=s[i].clone(),l.pos(e.x,e.y),this.ins.playerNode.addChild(l),Laya.Tween.to(l,{x:e.x+200*s[i].x,y:e.y+200*s[i].y},100,null,Laya.Handler.create(this,()=>{const e=this.getMinEnemy(l);n.tar=e,7==i&&Laya.timer.once(1e3,this,()=>{t.event("Player_1_Skill_Start")})}))}})}skill2(){const e=this.owner,s=[this.getVec3(0,-1),this.getVec3(.17,-.98),this.getVec3(.34,-.94),this.getVec3(.5,-.87),this.getVec3(-.17,-.98),this.getVec3(-.34,-.94),this.getVec3(-.5,-.87)];Laya.timer.loop(5e3,this,()=>{for(let t=0;t<7;t++){const i=this.open("player_skill_2",this.skill2Pre);i.getComponent(U).norV3=s[t].clone(),i.pos(e.x+200*s[t].x,e.y+200*s[t].y),this.ins.playerNode.addChild(i)}Laya.timer.once(1500,this,()=>{t.event("Player_2_Skill_Start")})})}skill3(){const t=this.open("player_skill_3",this.skill3Pre);let e=this.ins.playerV2;t.pos(e.x,e.y),this.ins.playerNode.addChild(t)}skill4(){const t=this.owner,e=[this.getVec3(.05,-1),this.getVec3(.16,-.99),this.getVec3(.26,-.97),this.getVec3(-.05,-1),this.getVec3(-.16,-.99),this.getVec3(-.26,-.97)];Laya.timer.loop(5e3,this,()=>{this.schedule(200,()=>{for(let s=0;s<6;s++){const i=this.open("player_skill_4",this.skill4Pre);i.getComponent(V).norV3=e[s].clone(),i.pos(t.x+0*e[s].x,t.y+0*e[s].y),this.ins.playerNode.addChild(i)}},this,3)})}skill5(){const t=this.owner;Laya.timer.loop(5e3,this,()=>{let e=Math.floor(2*Math.random()+3),s=[];s.push(Math.floor(26*Math.random()+20)/180*Math.PI),s.push(Math.floor(91*Math.random()+45)/180*Math.PI),4==e&&s.push(Math.floor(91*Math.random()+45)/180*Math.PI),s.push(Math.floor(26*Math.random()+135)/180*Math.PI);let i=0;this.schedule(500,()=>{const e=this.open("player_skill_5",this.skill5Pre),l=e.getComponent(N);e.pos(t.x,t.y),l.pangle=s[i],this.ins.playerNode.addChild(e),Laya.timer.once(500,this,()=>{const t=this.getMinEnemy(e);l.tar=t}),i++},this,e)})}skill6(){const t=this.owner,e=[this.getVec3(0,-1),this.getVec3(0,1)];Laya.timer.once(3e3,this,()=>{for(let s=0;s<2;s++){const i=this.open("player_skill_6",this.skill6Pre),l=i.getComponent(H);l.norV3=e[s].clone(),l.angle=s*Math.PI,i.pos(t.x+200*e[s].x,t.y+200*e[s].y),this.ins.playerNode.addChild(i)}})}skill7(){const e=this.owner,s=[this.getVec3(0,-1),this.getVec3(-.71,-.71),this.getVec3(.71,-.71)];Laya.timer.loop(7e3,this,()=>{for(let i=0;i<3;i++){const l=this.open("player_skill_7",this.skill7Pre),n=l.getComponent(q);n.norV3=s[i].clone(),l.pos(e.x,e.y),this.ins.playerNode.addChild(l),Laya.Tween.to(l,{x:e.x+200*s[i].x,y:e.y+200*s[i].y},300,null,Laya.Handler.create(this,()=>{n.norV3.x=-n.norV3.x,2==i&&Laya.timer.once(300,this,()=>{t.event("Player_7_Skill_Start")})}))}})}skill8(){const t=this.owner,e=[this.getVec3(0,-1),this.getVec3(0,1)];Laya.timer.once(3e3,this,()=>{for(let s=0;s<2;s++){const i=this.open("player_skill_8",this.skill8Pre),l=i.getComponent(H);l.norV3=e[s].clone(),l.angle=s*Math.PI,i.pos(t.x+200*e[s].x,t.y+200*e[s].y),this.ins.playerNode.addChild(i)}})}skill9(){const t=this.open("player_skill_9",this.skill9Pre);let e=this.ins.playerV2;t.pos(e.x,e.y),this.ins.playerNode.addChild(t)}skill10(){const t=this.owner,e=[this.getVec3(0,-1),this.getVec3(0,1)];Laya.timer.once(3e3,this,()=>{for(let s=0;s<2;s++){const i=this.open("player_skill_10",this.skill10Pre),n=i.getComponent(H);n.norV3=e[s].clone(),n.angle=s*Math.PI,n.type=l.ICE,i.pos(t.x+200*e[s].x,t.y+200*e[s].y),this.ins.playerNode.addChild(i)}})}robot1(){Laya.timer.loop(5e3,this,()=>{const t=this.open("player_robot_1",this.ins.plaRob1Pre);t.getComponent(X).norV3=this.getVec3(0,-1),t.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(t)})}robot2(){Laya.timer.loop(5e3,this,()=>{const t=this.open("player_robot_2",this.ins.plaRob2Pre);t.getComponent(X).norV3=this.getVec3(0,-1),t.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(t)})}robot3(){Laya.timer.loop(5e3,this,()=>{const t=this.open("player_robot_3",this.ins.plaRob3Pre),e=t.getComponent(X);e.norV3=this.getVec3(0,-1),e.speed=.2,t.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(t)})}getMinEnemy(t){let e=null,s=null;for(let i=0;i<this.ins.enemyCols.length;i++){const l=this.ins.enemyCols[i].owner;if(!l)continue;let n=l.x-t.x,a=l.y-t.y,o=n*n+a*a;(!e||o<e)&&(e=o,s=l)}return s}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){if(this.ins.gameState!=i.START)return;const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),l=this.getVec3();Laya.Vector3.lerp(s,this.ins.playerPosV2,15*e,l),t.pos(l.x,l.y)}}class j extends e{constructor(){super(),this.ins=o.instance,this.line=null}onEnable(){}onDisable(){}onLateUpdate(){if(this.ins.gameState!=i.START)return;const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),l=this.getVec3(this.ins.playerPosV2.x+80,this.ins.playerPosV2.y-80),n=this.getVec3();Laya.Vector3.lerp(s,l,8*e,n),t.pos(n.x,n.y);let a=this.ins.playerV2,o=n.x-a.x,h=n.y-a.y;this.line.height=Math.sqrt(o*o+h*h),this.line.rotation=Math.atan2(o,-h)/Math.PI*180}}class W extends e{constructor(){super()}onEnable(){const t=this.owner;let e=Math.floor(151*Math.random()+50);t.text=`-${e}`,t.color=e>=100?"#ff0300":"#ffffff",t.scale(0,0);let s=Math.floor(6*Math.random()+15),i=Math.floor(16*Math.random()+45),l=Math.floor(6*Math.random()+5),n=Math.floor(6*Math.random()+5);Laya.Tween.to(t,{x:t.x+s,y:t.y-i,scaleX:1,scaleY:1},300,Laya.Ease.quintOut,Laya.Handler.create(this,()=>{Laya.timer.once(100,this,()=>{Laya.Tween.to(t,{x:t.x-l,y:t.y-n,scaleX:0,scaleY:0},100,null,Laya.Handler.create(this,()=>{t.removeSelf()}))})}))}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onUpdate(){}}class z extends e{constructor(){super(),this.selfCol=null,this.quadTree=null,this.target=null,this.startH=1500}onEnable(){const e=o.instance,i=this.owner;i.__type__=l.LASER,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(s),this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.quadTree=new d({x:0,y:0,width:720,height:1280}),this.target=null,i.height=this.startH,i.alpha=1,Laya.timer.loop(6e3,this,()=>{Laya.Tween.to(i,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids()})),Laya.timer.once(3500,this,()=>{Laya.Tween.to(i,{alpha:1},500,null,Laya.Handler.create(this,()=>{if(2==e.playerData.laserSta&&e.playerData.trackBox&&e.playerData.trackBox.owner&&e.playerData.trackBox.owner.parent){const t=e.playerData.trackBox;t.bids.indexOf(this.selfCol.bid)<0&&(t.bids.push(this.selfCol.bid),e.playerData.trackCol.onCollisionEnter(this.selfCol,e.playerData.trackBox))}}))})}),t.on("Laser_Cross",this,()=>{this.target=null,i.height=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2}),t.on("Laser_Track",this,()=>{this.selfCol.bids=[],this.target=null}),t.on("Track_Target",this,()=>{t.event("Laser_Hide",this.selfCol);const s=e.playerData.trackBox;s.bids.indexOf(this.selfCol.bid)<0&&(s.bids.push(this.selfCol.bid),e.playerData.trackCol.onCollisionEnter(this.selfCol,e.playerData.trackBox))})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this),t.event("Laser_Hide",this.selfCol)}clearBids(){const e=this.owner;this.selfCol.bids=[],this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null,e.height=this.startH,t.event("Laser_Hide",this.selfCol)}onCollisionEnter(t,e){const s=t.owner,i=e.owner;if(s&&i&&!o.instance.playerData.laserSta){let t=Math.abs(s.y-i.y);this.selfCol.height2>t&&(i.height=t,this.selfCol.height2=t,this.selfCol.deltaY=-t/2,this.target=s)}}onCollisionExit(t,e){const s=t.owner,i=e.owner;s&&i&&!o.instance.playerData.laserSta&&(this.selfCol.bids.length||(i.height=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null))}onLateUpdate(){const t=this.owner,e=o.instance;if(2==e.playerData.laserSta)if(e.playerData.trackTar){let s=e.playerData.trackTar.x-t.x,i=e.playerData.trackTar.y-t.y;t.height=Math.sqrt(s*s+i*i),t.rotation=Math.atan2(s,-i)/Math.PI*180}else t.rotation=0,t.height=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2;if(2!=e.playerData.laserSta&&t.visible&&t.alpha>=.1&&this.quadTree.check(o.instance.enemyCols,this.selfCol),!e.playerData.laserSta&&this.target){const t=this.owner;let e=Math.abs(this.target.y-t.y);t.height=e,this.selfCol.height2=e,this.selfCol.deltaY=-e/2}}}class F extends e{constructor(){super(),this.selfCol=null,this.quadTree=null}onEnable(){const t=this.owner;t.__type__=l.LASER,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),t.alpha=1,Laya.timer.loop(4e3,this,()=>{Laya.Tween.to(t,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids()})),Laya.timer.once(1500,this,()=>{Laya.Tween.to(t,{alpha:1},500)})})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol.bids.length=0,t.offAllCaller(this),t.event("Laser_Hide",this.selfCol)}clearBids(){this.selfCol.bids=[],t.event("Laser_Hide",this.selfCol)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.owner;t.visible&&t.alpha>=.1&&this.quadTree.check(o.instance.enemyCols,this.selfCol)}}class G extends e{constructor(){super(),this.ins=o.instance,this.selfCol=null,this.quadTree=null,this.state=i.READY}onEnable(){const e=this.owner;e.__type__=l.MAGNET,this.selfCol=this.owner.getComponent(s),this.quadTree=new d({x:0,y:0,width:720,height:1280}),e.visible=!1,this.state=i.START,Laya.timer.loop(5e3,this,()=>{e.visible=!0,this.schedule(500,()=>{this.quadTree.check(o.instance.enemyCols,this.selfCol),this.selfCol.bids=[],t.event("Laser_Hide",this.selfCol)},this,2,null,!0,()=>{e.visible=!1})})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.state!=i.START)return;const t=this.owner;t.x=this.ins.playerV2.x,t.y=this.ins.playerV2.y}}class Q extends e{constructor(){super(),this.ins=o.instance,this.robot1BPre=null}onEnable(){const t=this.owner,e=[this.getVec3(.87,-.5),this.getVec3(1,0),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-1,0),this.getVec3(-.87,.5)];Laya.timer.loop(1e3,this,()=>{for(let s=0;s<6;s++){const i=this.open("player_wing_1_b",this.robot1BPre),l=i.getComponent(p);l.speed=.6,l.norV3=e[s].clone(),i.pos(t.x,t.y),this.ins.playerNode.addChild(i)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){}}class Z extends e{constructor(){super(),this.ins=o.instance,this.robot2BPre=null}onEnable(){const t=this.owner,e=[this.getVec3(.87,-.5),this.getVec3(1,0),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-1,0),this.getVec3(-.87,.5)];Laya.timer.loop(1e3,this,()=>{for(let s=0;s<6;s++){const i=this.open("player_wing_6_b",this.robot2BPre),l=i.getComponent(w);l.speed=.4,l.norV3=e[s].clone(),i.pos(t.x,t.y),this.ins.playerNode.addChild(i)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){}}class J extends e{constructor(){super(),this.ins=o.instance,this.left=null,this.right=null,this.vec=0,this.tar=null,this.im=null}onEnable(){const t=this.owner;this.left.visible=!1,this.right.visible=!1;const e=[this.right,this.left];Laya.timer.loop(300,this,()=>{let s=this.vec-1>=0?this.vec-1:e.length-1;e[s].visible=!1;const i=e[this.vec];if(i){let s=this.ins.getMinEnemy(t),l=this.vec?90:-90,n=1500;if(s&&s.parent){let e=t.x+(i.x-25)-s.x,o=t.y-s.y;n=Math.sqrt(e*e+o*o),l=Math.atan2(e,-o)/Math.PI*180;const h=s.getComponent(a);h.onCollisionEnter(this,h,!0),this.tar=s}i.height=n,i.rotation=l,i.visible=!0,this.im=i,this.vec++,this.vec>=e.length&&(this.vec=0)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),t.offAllCaller(this)}onLateUpdate(){if(this.ins.gameState==i.START&&this.im){const t=this.owner;let e=1500,s=this.vec?90:-90,i=this.tar;if(i&&i.parent){let l=t.x+(this.im.x-25)-i.x,n=t.y-i.y;e=Math.sqrt(l*l+n*n),s=Math.atan2(l,-n)/Math.PI*180}this.im.height=e,this.im.rotation=s}}}class K{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("battle/BattleScene.ts",o),t("battle/SkillDialog.ts",S),t("lobby/LobbySceneUI.ts",M),t("core/component/Toggle.ts",v),t("core/component/ToggleContainer.ts",A),t("lobby/LobbyScene.ts",B),t("lobby/BattlePage.ts",D),t("core/component/HorizontalSelect.ts",R),t("battle/BgNode.ts",I),t("core/utils/BoxCollision.ts",s),t("battle/EnemyCollision.ts",a),t("battle/PlayerCollision.ts",Y),t("battle/player/Player.ts",O),t("battle/player/PlayerHP.ts",j),t("battle/player/PlayerHPTip.ts",W),t("battle/player/PlayerLaser.ts",c),t("battle/PlayerLaserCollision.ts",z),t("battle/bullet/PlayerSkill1.ts",m),t("battle/bullet/PlayerSkill6.ts",H),t("battle/bullet/PlayerSkill2.ts",U),t("battle/bullet/PlayerSkill3.ts",F),t("battle/bullet/PlayerSkill4.ts",V),t("battle/bullet/PlayerSkill5.ts",N),t("battle/bullet/PlayerSkill7.ts",q),t("battle/bullet/PlayerSkill9.ts",G),t("battle/wing/PlayerWing.ts",y),t("battle/wing/PlayerWing1.ts",g),t("battle/bullet/PlayerSkill11.ts",p),t("battle/wing/PlayerWing2.ts",b),t("battle/bullet/PlayerSkill10.ts",u),t("battle/wing/PlayerWing3.ts",C),t("battle/wing/PlayerWingLaser.ts",f),t("battle/wing/PlayerWing4.ts",x),t("battle/wing/PlayerWing5.ts",L),t("battle/wing/PlayerWing6.ts",_),t("battle/bullet/PlayerSkill12.ts",w),t("battle/robot/PlayerRobot.ts",X),t("battle/robot/PlayerRobot1.ts",Q),t("battle/robot/PlayerRobot2.ts",Z),t("battle/robot/PlayerRobot3.ts",J)}}K.width=720,K.height=1280,K.scaleMode="fixedwidth",K.screenMode="none",K.alignV="top",K.alignH="center",K.startScene="lobby/LobbyScene.scene",K.sceneRoot="",K.debug=!1,K.stat=!1,K.physicsDebug=!1,K.exportSceneToJson=!0,K.init();new class{constructor(){window.Laya3D?Laya3D.init(K.width,K.height):Laya.init(K.width,K.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=K.scaleMode,Laya.stage.screenMode=K.screenMode,Laya.stage.alignV=K.alignV,Laya.stage.alignH=K.alignH,Laya.URL.exportSceneToJson=K.exportSceneToJson,(K.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),K.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),K.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.ClassUtils.regClass("laya.effect.ColorFilterSetter",Laya.ColorFilterSetter),Laya.ClassUtils.regClass("laya.effect.GlowFilterSetter",Laya.GlowFilterSetter),Laya.ClassUtils.regClass("laya.effect.BlurFilterSetter",Laya.BlurFilterSetter)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){K.startScene&&Laya.Scene.open(K.startScene)}}}();